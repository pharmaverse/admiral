% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/derive_var_nfrlt.R
\name{derive_var_nfrlt}
\alias{derive_var_nfrlt}
\title{Derive Nominal Relative Time from First Dose (NFRLT)}
\usage{
derive_var_nfrlt(
  dataset,
  new_var = NFRLT,
  tpt_var,
  visit_day,
  first_dose_day = 1,
  treatment_duration = 0,
  range_method = "midpoint"
)
}
\arguments{
\item{dataset}{Input dataset containing timepoint and visit day variables.

\describe{
\item{Permitted values}{A data frame or tibble}
\item{Default value}{none}
}}

\item{new_var}{Name of the new variable to create (unquoted). Default is
\code{NFRLT}.

\describe{
\item{Permitted values}{Unquoted variable name}
\item{Default value}{\code{NFRLT}}
}}

\item{tpt_var}{Timepoint variable containing descriptions like "Pre-dose",
"1H Post-dose", etc. (unquoted).

\describe{
\item{Permitted values}{Unquoted variable name}
\item{Default value}{none}
}}

\item{visit_day}{Visit day variable (unquoted). This should be the planned/
nominal visit day (e.g., \code{VISITDY}).

\describe{
\item{Permitted values}{Unquoted variable name}
\item{Default value}{none}
}}

\item{first_dose_day}{The day number considered as the first dose day.
Default is 1. For multiple-dose studies, this is typically Day 1.

\describe{
\item{Permitted values}{Numeric scalar (positive integer)}
\item{Default value}{\code{1}}
}}

\item{treatment_duration}{Numeric value specifying the duration of treatment
in hours. Passed to \code{convert_xxtpt_to_hours()}. Default is 0 hours (for
instantaneous treatments like oral medications).

\describe{
\item{Permitted values}{Numeric scalar (non-negative)}
\item{Default value}{\code{0}}
}}

\item{range_method}{Method for converting time ranges to single values.
Options are "midpoint" (default), "start", or "end". Passed to
\code{convert_xxtpt_to_hours()}. For example, "0-6h" with midpoint returns 3,
with start returns 0, with end returns 6.

\describe{
\item{Permitted values}{Character scalar ("midpoint", "start", or "end")}
\item{Default value}{\code{"midpoint"}}
}}
}
\value{
The input dataset with the new nominal relative time variable added.
}
\description{
Derives nominal/planned time from first dose in hours by combining visit day
information with timepoint descriptions. The function converts timepoint
strings to hours using \code{convert_xxtpt_to_hours()} and adds them to the
day-based offset.
}
\details{
The nominal relative time is calculated as:

\code{NFRLT = (visit_day - first_dose_day) * 24 + timepoint_hours}

Where:
\itemize{
\item \code{visit_day} is the planned visit day (e.g., 1, 2, 8, 15)
\item \code{first_dose_day} is the day of first dose (typically 1)
\item \code{timepoint_hours} is derived from the timepoint description using
\code{convert_xxtpt_to_hours()}
}

\strong{Common Use Cases:}
\itemize{
\item \strong{Single dose study}: Day 1 only, with samples at various timepoints
(e.g., Pre-dose, 1H, 2H, 4H, 8H, 24H)
\item \strong{Multiple dose study}: Dosing on multiple days (e.g., Day 1, Day 8,
Day 15) with samples around each dose
\item \strong{Steady state study}: Multiple daily doses with sampling on specific
days
\item \strong{Oral medications}: Use default \code{treatment_duration = 0} for
instantaneous absorption
\item \strong{IV infusions}: Specify \code{treatment_duration} as infusion duration in
hours
}

\strong{Important Notes:}
\itemize{
\item The function assumes \code{visit_day} represents the nominal/planned day, not
the actual study day
\item For timepoints that span multiple days (e.g., "24H Post-dose"), ensure
\code{visit_day} is set to the day when the sample was taken. For example, if
dosing occurs on Day 3, a "24H Post-dose" sample taken on Day 4 should
have \code{visit_day = 4}.
\item For crossover studies, consider deriving NFRLT separately per period
\item \code{NA} values in either \code{visit_day} or \code{tpt_var} will result in \code{NA} for
NFRLT
}
}
\examples{
library(dplyr)
library(tibble)

# Single dose study - Day 1 only (oral medication)
adpc <- tribble(
  ~USUBJID, ~VISITDY, ~PCTPT,
  "001",    1,        "Pre-dose",
  "001",    1,        "1H Post-dose",
  "001",    1,        "2H Post-dose",
  "001",    1,        "4H Post-dose",
  "001",    1,        "24H Post-dose"
)

derive_var_nfrlt(
  adpc,
  new_var = NFRLT,
  tpt_var = PCTPT,
  visit_day = VISITDY
)

# Multiple dose study - Days 1, 8, 15
adpc_md <- tribble(
  ~USUBJID, ~VISITDY, ~PCTPT,
  "001",    1,        "Pre-dose",
  "001",    1,        "2H Post-dose",
  "001",    8,        "Pre-dose",
  "001",    8,        "2H Post-dose",
  "001",    15,       "Pre-dose",
  "001",    15,       "2H Post-dose"
)

derive_var_nfrlt(
  adpc_md,
  new_var = NFRLT,
  tpt_var = PCTPT,
  visit_day = VISITDY
)

# IV infusion with 2 hour treatment duration
adpc_inf <- tribble(
  ~USUBJID, ~VISITDY, ~PCTPT,
  "001",    1,        "Pre-dose",
  "001",    1,        "EOI",
  "001",    1,        "1H Post EOI",
  "001",    1,        "10MIN PRE EOI"
)

derive_var_nfrlt(
  adpc_inf,
  new_var = NFRLT,
  tpt_var = PCTPT,
  visit_day = VISITDY,
  treatment_duration = 2
)

# Custom range method (use end of range instead of midpoint)
adpc_range <- tribble(
  ~USUBJID, ~VISITDY, ~PCTPT,
  "001",    1,        "Pre-dose",
  "001",    1,        "0-6h Post-dose"
)

derive_var_nfrlt(
  adpc_range,
  new_var = NFRLT,
  tpt_var = PCTPT,
  visit_day = VISITDY,
  range_method = "end"
)

# Using "Before" and "After" terminology
adpc_alt <- tribble(
  ~USUBJID, ~VISITDY, ~PCTPT,
  "001",    1,        "Before",
  "001",    1,        "1H After",
  "001",    1,        "2H After"
)

derive_var_nfrlt(
  adpc_alt,
  new_var = NFRLT,
  tpt_var = PCTPT,
  visit_day = VISITDY
)

# Custom first dose day (e.g., dose on Day 3)
# Note: 24H Post-dose sample is on Day 4
adpc_custom <- tribble(
  ~USUBJID, ~VISITDY, ~PCTPT,
  "001",    3,        "Pre-dose",
  "001",    3,        "2H Post-dose",
  "001",    3,        "8H Post-dose",
  "001",    4,        "24H Post-dose"
)

derive_var_nfrlt(
  adpc_custom,
  new_var = NFRLT,
  tpt_var = PCTPT,
  visit_day = VISITDY,
  first_dose_day = 3
)
}
\seealso{
\code{\link[=convert_xxtpt_to_hours]{convert_xxtpt_to_hours()}}

BDS-Findings Functions that returns variable appended to dataset:
\code{\link{derive_basetype_records}()},
\code{\link{derive_var_analysis_ratio}()},
\code{\link{derive_var_anrind}()},
\code{\link{derive_var_atoxgr}()},
\code{\link{derive_var_atoxgr_dir}()},
\code{\link{derive_var_base}()},
\code{\link{derive_var_chg}()},
\code{\link{derive_var_ontrtfl}()},
\code{\link{derive_var_pchg}()},
\code{\link{derive_var_shift}()},
\code{\link{derive_vars_crit_flag}()}
}
\concept{der_bds_findings}
\keyword{der_bds_findings}
