name:  verify_templates_experimental

run-name: EXPERIMENTAL

# For GITHUB to recognize `workflow_dispatch`, the yml file  must be `default` branch, OR
# run on pull_request or push.  


# Run when: if branch changes, does all templates
on:
  push:
     branches:  [feedback_template_verification]
#    branches:  [2642_verify_templates_results]
  workflow_dispatch:
  pull_request:

jobs:
  verify_templates:
    runs-on: ubuntu-latest
    env:
        GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}
        R_KEEP_PKG_SOURCE: yes
    steps:
      - name: Set up R
        uses: r-lib/actions/setup-r@v2
        with:
          use-public-rspm: true

      - name: Install R dependencies
        run: |
          Rscript -e 'install.packages(c("admiraldev",
          "dplyr",
          "hms",
          "lubridate",
          "tidyr",
          "tidyselct",
          "pharmaversesdtm"),
            repos = "https://packagemanager.posit.co/cran/__linux__/noble/latest")'

      - name: Checkout repo
        uses: actions/checkout@v4

      - name: source, run the code
        run:  Rscript -e 'source("data-raw/load_run.R")'


      - name: Session info
        run: |
          options(width = 100)
          pkgs <- installed.packages()[, "Package"]
          sessioninfo::session_info(pkgs, include_base = TRUE)
        shell: Rscript {0}

      - name: PR comment with file
        uses: thollander/actions-comment-pull-request@v3
          with:
          file-path: .github/actions/verify_templates_experimental.yml 