<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create dataset of single doses â€” create_single_dose_dataset â€¢ admiral</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create dataset of single doses â€” create_single_dose_dataset"><meta name="description" content="Derives dataset of single dose from aggregate dose information. This may be
necessary when e.g. calculating last dose before an adverse event in ADAE
or deriving a total dose parameter in ADEX when EXDOSFRQ != ONCE."><meta property="og:description" content="Derives dataset of single dose from aggregate dose information. This may be
necessary when e.g. calculating last dose before an adverse event in ADAE
or deriving a total dose parameter in ADEX when EXDOSFRQ != ONCE."><meta property="og:image" content="https://pharmaverse.github.io/admiral/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">admiral</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started"><li><a class="dropdown-item" href="../articles/admiral.html">Get Started</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/pharmaverse/admiral/blob/main/inst/cheatsheet/admiral_cheatsheet.pdf">Cheatsheet</a></li>
    <li><a class="dropdown-item" href="https://pharmaverse.github.io/admiraldiscovery/articles/presentation_archive.html">Presentation Archive</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides"><li><h6 class="dropdown-header" data-toc-skip>General Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/concepts_conventions.html">Programming Concepts and Conventions</a></li>
    <li><a class="dropdown-item" href="../articles/generic.html">Generic Derivations</a></li>
    <li><a class="dropdown-item" href="../articles/higher_order.html">Higher Order Functions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>ADaM Script Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/adsl.html">Creating a Basic ADSL</a></li>
    <li><a class="dropdown-item" href="../articles/occds.html">Creating an OCCDS ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_finding.html">Creating a BDS Findings ADAM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_exposure.html">Creating a BDS Exposure ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_tte.html">Creating a BDS Time-to-Event ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/questionnaires.html">Creating Questionnaire ADaMs</a></li>
    <li><a class="dropdown-item" href="../articles/pk_adnca.html">Creating a PK NCA or Population PK ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/hys_law.html">Hy's Law Implementation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Special Topics Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/imputation.html">Date and Time Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/visits_periods.html">Visit and Period Variables</a></li>
    <li><a class="dropdown-item" href="../articles/queries_dataset.html">Queries Dataset Documentation</a></li>
    <li><a class="dropdown-item" href="../articles/lab_grading.html">Lab Grading</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="https://pharmaverse.github.io/admiraldiscovery/articles/reactable.html">ðŸ”Ž Find my function</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.slack.com/" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/website-versions.html" aria-label="Previous Release Websites"><span class="fa fa-history"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/issues/new/choose" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create dataset of single doses</h1>
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiral/blob/main/R/create_single_dose_dataset.R" class="external-link"><code>R/create_single_dose_dataset.R</code></a></small>
      <div class="d-none name"><code>create_single_dose_dataset.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Derives dataset of single dose from aggregate dose information. This may be
necessary when e.g. calculating last dose before an adverse event in <code>ADAE</code>
or deriving a total dose parameter in <code>ADEX</code> when <code>EXDOSFRQ != ONCE</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">create_single_dose_dataset</span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  dose_freq <span class="op">=</span> <span class="va">EXDOSFRQ</span>,</span>
<span>  start_date <span class="op">=</span> <span class="va">ASTDT</span>,</span>
<span>  start_datetime <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  end_date <span class="op">=</span> <span class="va">AENDT</span>,</span>
<span>  end_datetime <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lookup_table <span class="op">=</span> <span class="va">dose_freq_lookup</span>,</span>
<span>  lookup_column <span class="op">=</span> <span class="va">CDISC_VALUE</span>,</span>
<span>  nominal_time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  keep_source_vars <span class="op">=</span> <span class="fu">expr_c</span><span class="op">(</span><span class="fu"><a href="get_admiral_option.html">get_admiral_option</a></span><span class="op">(</span><span class="st">"subject_keys"</span><span class="op">)</span>, <span class="va">dose_freq</span>, <span class="va">start_date</span>,</span>
<span>    <span class="va">start_datetime</span>, <span class="va">end_date</span>, <span class="va">end_datetime</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dataset">dataset<a class="anchor" aria-label="anchor" href="#arg-dataset"></a></dt>
<dd><p>Input dataset</p>
<p>The variables specified by the <code>dose_freq</code>, <code>start_date</code>, and <code>end_date</code> arguments are expected to be in the dataset.</p></dd>


<dt id="arg-dose-freq">dose_freq<a class="anchor" aria-label="anchor" href="#arg-dose-freq"></a></dt>
<dd><p>The dose frequency</p>
<p>The aggregate dosing frequency used for multiple doses in a row.</p>
<p>Permitted Values: defined by lookup table.</p></dd>


<dt id="arg-start-date">start_date<a class="anchor" aria-label="anchor" href="#arg-start-date"></a></dt>
<dd><p>The start date</p>
<p>A date object is expected. This object cannot contain <code>NA</code> values.</p>
<p>Refer to <code><a href="derive_vars_dt.html">derive_vars_dt()</a></code> to impute and derive a date from a date
character vector to a date object.</p></dd>


<dt id="arg-start-datetime">start_datetime<a class="anchor" aria-label="anchor" href="#arg-start-datetime"></a></dt>
<dd><p>The start date-time</p>
<p>A date-time object is expected. This object cannot contain <code>NA</code> values.</p>
<p>Refer to <code><a href="derive_vars_dtm.html">derive_vars_dtm()</a></code> to impute and derive a date-time from a date
character vector to a date object.</p>
<p>If the input dataset contains frequencies which refer to <code>DOSE_WINDOW</code>
equals <code>"HOUR"</code> or <code>"MINUTE"</code>, the parameter must be specified.</p></dd>


<dt id="arg-end-date">end_date<a class="anchor" aria-label="anchor" href="#arg-end-date"></a></dt>
<dd><p>The end date</p>
<p>A date or date-time object is expected. This object cannot contain <code>NA</code> values.</p>
<p>Refer to <code><a href="derive_vars_dt.html">derive_vars_dt()</a></code> to impute and derive a date from a date
character vector to a date object.</p></dd>


<dt id="arg-end-datetime">end_datetime<a class="anchor" aria-label="anchor" href="#arg-end-datetime"></a></dt>
<dd><p>The end date-time</p>
<p>A date-time object is expected. This object cannot contain <code>NA</code> values.</p>
<p>Refer to <code><a href="derive_vars_dtm.html">derive_vars_dtm()</a></code> to impute and derive a date-time from a date
character vector to a date object.</p>
<p>If the input dataset contains frequencies which refer to <code>DOSE_WINDOW</code>
equals <code>"HOUR"</code> or <code>"MINUTE"</code>, the parameter must be specified.</p></dd>


<dt id="arg-lookup-table">lookup_table<a class="anchor" aria-label="anchor" href="#arg-lookup-table"></a></dt>
<dd><p>The dose frequency value lookup table</p>
<p>The table used to look up <code>dose_freq</code> values and determine the appropriate
multiplier to be used for row generation. If a lookup table other than the
default is used, it must have columns <code>DOSE_WINDOW</code>, <code>DOSE_COUNT</code>, and
<code>CONVERSION_FACTOR</code>. The default table <code>dose_freq_lookup</code> is described in
detail <a href="dose_freq_lookup.html">here</a>.</p>
<p>Permitted Values for <code>DOSE_WINDOW</code>: <code>"MINUTE"</code>, <code>"HOUR"</code>, <code>"DAY"</code>,
<code>"WEEK"</code>, <code>"MONTH"</code>, <code>"YEAR"</code></p></dd>


<dt id="arg-lookup-column">lookup_column<a class="anchor" aria-label="anchor" href="#arg-lookup-column"></a></dt>
<dd><p>The dose frequency value column in the lookup table</p>
<p>The column of <code>lookup_table</code>.</p></dd>


<dt id="arg-nominal-time">nominal_time<a class="anchor" aria-label="anchor" href="#arg-nominal-time"></a></dt>
<dd><p>The nominal relative time from first dose (<code>NFRLT</code>)</p>
<p>Used for PK analysis, this will be in hours and should be 0 for
the first dose.  It can be derived as <code>(VISITDY - 1) * 24</code> for example.
This will be expanded as the single dose dataset is created.  For example
an <code>EXDOFRQ</code> of <code>"QD"</code> will result in the nominal_time being incremented by
24 hours for each expanded record.</p>
<p>The value can be NULL if not needed.</p></dd>


<dt id="arg-keep-source-vars">keep_source_vars<a class="anchor" aria-label="anchor" href="#arg-keep-source-vars"></a></dt>
<dd><p>List of variables to be retained from source dataset</p>
<p>This parameter can be specified if additional information is required in
the output dataset. For example <code>EXTRT</code> for studies with more than one
drug.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The input dataset with a single dose per row.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Each aggregate dose row is split into multiple rows which each
represent a single dose.The number of completed dose periods between
<code>start_date</code> or <code>start_datetime</code> and <code>end_date</code> or <code>end_datetime</code> is
calculated with <code>compute_duration</code> and multiplied by <code>DOSE_COUNT</code>.
For <code>DOSE_WINDOW</code> values of <code>"WEEK"</code>, <code>"MONTH"</code>, and <code>"YEAR"</code>,
<code>CONVERSION_FACTOR</code> is used to convert into days the time object
to be added to <code>start_date</code>.</p>
<p>Observations with dose frequency <code>"ONCE"</code> are copied to the output dataset
unchanged.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Creating auxiliary datasets:
<code><a href="consolidate_metadata.html">consolidate_metadata</a>()</code>,
<code><a href="create_period_dataset.html">create_period_dataset</a>()</code>,
<code><a href="create_query_data.html">create_query_data</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Example with default lookup</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">STUDYID</span>, <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">EXDOSFRQ</span>, <span class="op">~</span><span class="va">ASTDT</span>, <span class="op">~</span><span class="va">ASTDTM</span>, <span class="op">~</span><span class="va">AENDT</span>, <span class="op">~</span><span class="va">AENDTM</span>,</span></span>
<span class="r-in"><span>  <span class="st">"STUDY01"</span>, <span class="st">"P01"</span>, <span class="st">"Q2D"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-01 10:30:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-07"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-07 11:30:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"STUDY01"</span>, <span class="st">"P01"</span>, <span class="st">"Q3D"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-08"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-08 12:00:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-14"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-14 14:00:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"STUDY01"</span>, <span class="st">"P01"</span>, <span class="st">"EVERY 2 WEEKS"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-15"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-15 09:57:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-29"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-29 10:57:00"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">create_single_dose_dataset</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 9 Ã— 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   STUDYID USUBJID EXDOSFRQ ASTDT      AENDT     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> STUDY01 P01     ONCE     2021-01-01 2021-01-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> STUDY01 P01     ONCE     2021-01-03 2021-01-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> STUDY01 P01     ONCE     2021-01-05 2021-01-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> STUDY01 P01     ONCE     2021-01-07 2021-01-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> STUDY01 P01     ONCE     2021-01-08 2021-01-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> STUDY01 P01     ONCE     2021-01-11 2021-01-11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">7</span> STUDY01 P01     ONCE     2021-01-14 2021-01-14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">8</span> STUDY01 P01     ONCE     2021-01-15 2021-01-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">9</span> STUDY01 P01     ONCE     2021-01-29 2021-01-29</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example with custom lookup</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">custom_lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">Value</span>,   <span class="op">~</span><span class="va">DOSE_COUNT</span>, <span class="op">~</span><span class="va">DOSE_WINDOW</span>, <span class="op">~</span><span class="va">CONVERSION_FACTOR</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Q30MIN"</span>, <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">30</span><span class="op">)</span>,    <span class="st">"MINUTE"</span>,                      <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Q90MIN"</span>, <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">90</span><span class="op">)</span>,    <span class="st">"MINUTE"</span>,                      <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">STUDYID</span>, <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">EXDOSFRQ</span>, <span class="op">~</span><span class="va">ASTDT</span>, <span class="op">~</span><span class="va">ASTDTM</span>, <span class="op">~</span><span class="va">AENDT</span>, <span class="op">~</span><span class="va">AENDTM</span>,</span></span>
<span class="r-in"><span>  <span class="st">"STUDY01"</span>, <span class="st">"P01"</span>, <span class="st">"Q30MIN"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-01T06:00:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-01T07:00:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"STUDY02"</span>, <span class="st">"P02"</span>, <span class="st">"Q90MIN"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-01T06:00:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-01T09:00:00"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">create_single_dose_dataset</span><span class="op">(</span><span class="va">data</span>,</span></span>
<span class="r-in"><span>  lookup_table <span class="op">=</span> <span class="va">custom_lookup</span>,</span></span>
<span class="r-in"><span>  lookup_column <span class="op">=</span> <span class="va">Value</span>,</span></span>
<span class="r-in"><span>  start_datetime <span class="op">=</span> <span class="va">ASTDTM</span>,</span></span>
<span class="r-in"><span>  end_datetime <span class="op">=</span> <span class="va">AENDTM</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 Ã— 7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   STUDYID USUBJID EXDOSFRQ ASTDT      ASTDTM              AENDT     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> STUDY01 P01     ONCE     2021-01-01 2021-01-01 <span style="color: #949494;">06:00:00</span> 2021-01-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> STUDY01 P01     ONCE     2021-01-01 2021-01-01 <span style="color: #949494;">06:30:00</span> 2021-01-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> STUDY01 P01     ONCE     2021-01-01 2021-01-01 <span style="color: #949494;">07:00:00</span> 2021-01-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> STUDY02 P02     ONCE     2021-01-01 2021-01-01 <span style="color: #949494;">06:00:00</span> 2021-01-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> STUDY02 P02     ONCE     2021-01-01 2021-01-01 <span style="color: #949494;">07:30:00</span> 2021-01-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> STUDY02 P02     ONCE     2021-01-01 2021-01-01 <span style="color: #949494;">09:00:00</span> 2021-01-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># â„¹ 1 more variable: AENDTM &lt;dttm&gt;</span></span>
<span class="r-in"><span><span class="co"># Example with nominal time</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">STUDYID</span>, <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">EXDOSFRQ</span>, <span class="op">~</span><span class="va">NFRLT</span>, <span class="op">~</span><span class="va">ASTDT</span>, <span class="op">~</span><span class="va">ASTDTM</span>, <span class="op">~</span><span class="va">AENDT</span>, <span class="op">~</span><span class="va">AENDTM</span>,</span></span>
<span class="r-in"><span>  <span class="st">"STUDY01"</span>, <span class="st">"P01"</span>, <span class="st">"BID"</span>, <span class="fl">0</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-01 08:00:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-07"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-07 20:00:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"STUDY01"</span>, <span class="st">"P01"</span>, <span class="st">"BID"</span>, <span class="fl">168</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-08"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-08 08:00:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-14"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-14 20:00:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"STUDY01"</span>, <span class="st">"P01"</span>, <span class="st">"BID"</span>, <span class="fl">336</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-15"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-15 08:00:00"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-01-29"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">"2021-01-29 20:00:00"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">create_single_dose_dataset</span><span class="op">(</span><span class="va">data</span>,</span></span>
<span class="r-in"><span>  dose_freq <span class="op">=</span> <span class="va">EXDOSFRQ</span>,</span></span>
<span class="r-in"><span>  start_date <span class="op">=</span> <span class="va">ASTDT</span>,</span></span>
<span class="r-in"><span>  start_datetime <span class="op">=</span> <span class="va">ASTDTM</span>,</span></span>
<span class="r-in"><span>  end_date <span class="op">=</span> <span class="va">AENDT</span>,</span></span>
<span class="r-in"><span>  end_datetime <span class="op">=</span> <span class="va">AENDTM</span>,</span></span>
<span class="r-in"><span>  lookup_table <span class="op">=</span> <span class="va">dose_freq_lookup</span>,</span></span>
<span class="r-in"><span>  lookup_column <span class="op">=</span> <span class="va">CDISC_VALUE</span>,</span></span>
<span class="r-in"><span>  nominal_time <span class="op">=</span> <span class="va">NFRLT</span>,</span></span>
<span class="r-in"><span>  keep_source_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">USUBJID</span>, <span class="va">EXDOSFRQ</span>, <span class="va">ASTDT</span>, <span class="va">ASTDTM</span>, <span class="va">AENDT</span>, <span class="va">AENDTM</span>, <span class="va">NFRLT</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 58 Ã— 7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    USUBJID EXDOSFRQ ASTDT      ASTDTM              AENDT     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> P01     ONCE     2021-01-01 2021-01-01 <span style="color: #949494;">08:00:00</span> 2021-01-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> P01     ONCE     2021-01-01 2021-01-01 <span style="color: #949494;">20:00:00</span> 2021-01-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> P01     ONCE     2021-01-02 2021-01-02 <span style="color: #949494;">08:00:00</span> 2021-01-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> P01     ONCE     2021-01-02 2021-01-02 <span style="color: #949494;">20:00:00</span> 2021-01-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> P01     ONCE     2021-01-03 2021-01-03 <span style="color: #949494;">08:00:00</span> 2021-01-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> P01     ONCE     2021-01-03 2021-01-03 <span style="color: #949494;">20:00:00</span> 2021-01-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> P01     ONCE     2021-01-04 2021-01-04 <span style="color: #949494;">08:00:00</span> 2021-01-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> P01     ONCE     2021-01-04 2021-01-04 <span style="color: #949494;">20:00:00</span> 2021-01-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> P01     ONCE     2021-01-05 2021-01-05 <span style="color: #949494;">08:00:00</span> 2021-01-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> P01     ONCE     2021-01-05 2021-01-05 <span style="color: #949494;">20:00:00</span> 2021-01-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># â„¹ 48 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># â„¹ 2 more variables: AENDTM &lt;dttm&gt;, NFRLT &lt;dbl&gt;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example - derive a single dose dataset with imputations</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For either single drug administration records, or multiple drug administration</span></span></span>
<span class="r-in"><span><span class="co"># records covering a range of dates, fill-in of missing treatment end datetime</span></span></span>
<span class="r-in"><span><span class="co"># `EXENDTC` by substitution with an acceptable alternate, for example date of</span></span></span>
<span class="r-in"><span><span class="co"># death, date of datacut may be required. This example shows the</span></span></span>
<span class="r-in"><span><span class="co"># maximum possible number of single dose records to be derived. The example</span></span></span>
<span class="r-in"><span><span class="co"># requires the date of datacut `DCUTDT` to be specified correctly, or</span></span></span>
<span class="r-in"><span><span class="co"># if not appropriate to use `DCUTDT` as missing treatment end data and missing</span></span></span>
<span class="r-in"><span><span class="co"># treatment end datetime could set equal to treatment start date and treatment</span></span></span>
<span class="r-in"><span><span class="co"># start datetime. ADSL variables `DTHDT` and `DCUTDT` are preferred for</span></span></span>
<span class="r-in"><span><span class="co"># imputation use.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># All available trial treatments are included, allowing multiple different</span></span></span>
<span class="r-in"><span><span class="co"># last dose variables to be created in for example `use_ad_template("ADAE")`</span></span></span>
<span class="r-in"><span><span class="co"># if required.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">STUDYID</span>, <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">DTHDT</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1211"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2013-01-14"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1083"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2013-08-02"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1445"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2014-11-01"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1015"</span>, <span class="cn">NA</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1023"</span>, <span class="cn">NA</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">STUDYID</span>, <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">EXSEQ</span>, <span class="op">~</span><span class="va">EXTRT</span>, <span class="op">~</span><span class="va">EXDOSE</span>, <span class="op">~</span><span class="va">EXDOSU</span>, <span class="op">~</span><span class="va">EXDOSFRQ</span>, <span class="op">~</span><span class="va">EXSTDTC</span>, <span class="op">~</span><span class="va">EXENDTC</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1015"</span>, <span class="fl">1</span>, <span class="st">"PLAC"</span>, <span class="fl">0</span>, <span class="st">"mg"</span>, <span class="st">"QD"</span>, <span class="st">"2014-01-02"</span>, <span class="st">"2014-01-16"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1015"</span>, <span class="fl">2</span>, <span class="st">"PLAC"</span>, <span class="fl">0</span>, <span class="st">"mg"</span>, <span class="st">"QD"</span>, <span class="st">"2014-06-17"</span>, <span class="st">"2014-06-18"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1015"</span>, <span class="fl">3</span>, <span class="st">"PLAC"</span>, <span class="fl">0</span>, <span class="st">"mg"</span>, <span class="st">"QD"</span>, <span class="st">"2014-06-19"</span>, <span class="cn">NA_character_</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1023"</span>, <span class="fl">1</span>, <span class="st">"PLAC"</span>, <span class="fl">0</span>, <span class="st">"mg"</span>, <span class="st">"QD"</span>, <span class="st">"2012-08-05"</span>, <span class="st">"2012-08-27"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1023"</span>, <span class="fl">2</span>, <span class="st">"PLAC"</span>, <span class="fl">0</span>, <span class="st">"mg"</span>, <span class="st">"QD"</span>, <span class="st">"2012-08-28"</span>, <span class="st">"2012-09-01"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1211"</span>, <span class="fl">1</span>, <span class="st">"XANO"</span>, <span class="fl">54</span>, <span class="st">"mg"</span>, <span class="st">"QD"</span>, <span class="st">"2012-11-15"</span>, <span class="st">"2012-11-28"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1211"</span>, <span class="fl">2</span>, <span class="st">"XANO"</span>, <span class="fl">54</span>, <span class="st">"mg"</span>, <span class="st">"QD"</span>, <span class="st">"2012-11-29"</span>, <span class="cn">NA_character_</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1445"</span>, <span class="fl">1</span>, <span class="st">"PLAC"</span>, <span class="fl">0</span>, <span class="st">"mg"</span>, <span class="st">"QD"</span>, <span class="st">"2014-05-11"</span>, <span class="st">"2014-05-25"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1445"</span>, <span class="fl">2</span>, <span class="st">"PLAC"</span>, <span class="fl">0</span>, <span class="st">"mg"</span>, <span class="st">"QD"</span>, <span class="st">"2014-05-26"</span>, <span class="st">"2014-11-01"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"01"</span>, <span class="st">"1083"</span>, <span class="fl">1</span>, <span class="st">"PLAC"</span>, <span class="fl">0</span>, <span class="st">"mg"</span>, <span class="st">"QD"</span>, <span class="st">"2013-07-22"</span>, <span class="st">"2013-08-01"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">adsl_death</span> <span class="op">&lt;-</span> <span class="va">adsl</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    DTHDTM <span class="op">=</span> <span class="fu"><a href="convert_date_to_dtm.html">convert_date_to_dtm</a></span><span class="op">(</span><span class="va">DTHDT</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="co"># Remove `DCUT` setup line below if ADSL `DCUTDT` is populated.</span></span></span>
<span class="r-in"><span>    DCUTDT <span class="op">=</span> <span class="fu"><a href="convert_dtc_to_dt.html">convert_dtc_to_dt</a></span><span class="op">(</span><span class="st">"2015-03-06"</span><span class="op">)</span>, <span class="co"># Example only, enter date.</span></span></span>
<span class="r-in"><span>    DCUTDTM <span class="op">=</span> <span class="fu"><a href="convert_date_to_dtm.html">convert_date_to_dtm</a></span><span class="op">(</span><span class="va">DCUTDT</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Select valid dose records, non-missing `EXSTDTC` and `EXDOSE`.</span></span></span>
<span class="r-in"><span><span class="va">ex_mod</span> <span class="op">&lt;-</span> <span class="va">ex</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">EXSTDTC</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">EXDOSE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="derive_vars_merged.html">derive_vars_merged</a></span><span class="op">(</span><span class="va">adsl_death</span>, by_vars <span class="op">=</span> <span class="fu"><a href="get_admiral_option.html">get_admiral_option</a></span><span class="op">(</span><span class="st">"subject_keys"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="co"># Example, set up missing `EXDOSFRQ` as QD daily dosing regime.</span></span></span>
<span class="r-in"><span>  <span class="co"># Replace with study dosing regime per trial treatment.</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>EXDOSFRQ <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">EXDOSFRQ</span><span class="op">)</span>, <span class="st">"QD"</span>, <span class="va">EXDOSFRQ</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="co"># Create EXxxDTM variables and replace missing `EXENDTM`.</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="derive_vars_dtm.html">derive_vars_dtm</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    dtc <span class="op">=</span> <span class="va">EXSTDTC</span>,</span></span>
<span class="r-in"><span>    new_vars_prefix <span class="op">=</span> <span class="st">"EXST"</span>,</span></span>
<span class="r-in"><span>    date_imputation <span class="op">=</span> <span class="st">"first"</span>,</span></span>
<span class="r-in"><span>    time_imputation <span class="op">=</span> <span class="st">"first"</span>,</span></span>
<span class="r-in"><span>    flag_imputation <span class="op">=</span> <span class="st">"none"</span>,</span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="derive_vars_dtm_to_dt.html">derive_vars_dtm_to_dt</a></span><span class="op">(</span><span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">EXSTDTM</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="derive_vars_dtm.html">derive_vars_dtm</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    dtc <span class="op">=</span> <span class="va">EXENDTC</span>,</span></span>
<span class="r-in"><span>    new_vars_prefix <span class="op">=</span> <span class="st">"EXEN"</span>,</span></span>
<span class="r-in"><span>    <span class="co"># Maximum imputed treatment end date must not be not greater than</span></span></span>
<span class="r-in"><span>    <span class="co"># date of death or after the datacut date.</span></span></span>
<span class="r-in"><span>    max_dates <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">DTHDTM</span>, <span class="va">DCUTDTM</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    date_imputation <span class="op">=</span> <span class="st">"last"</span>,</span></span>
<span class="r-in"><span>    time_imputation <span class="op">=</span> <span class="st">"last"</span>,</span></span>
<span class="r-in"><span>    flag_imputation <span class="op">=</span> <span class="st">"none"</span>,</span></span>
<span class="r-in"><span>    highest_imputation <span class="op">=</span> <span class="st">"Y"</span>,</span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="derive_vars_dtm_to_dt.html">derive_vars_dtm_to_dt</a></span><span class="op">(</span><span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">EXENDTM</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="co"># Select only unique values.</span></span></span>
<span class="r-in"><span>  <span class="co"># Removes duplicated records before final step.</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">EXTRT</span>, <span class="va">EXDOSE</span>, <span class="va">EXDOSFRQ</span>, <span class="va">DCUTDT</span>, <span class="va">DTHDT</span>, <span class="va">EXSTDT</span>,</span></span>
<span class="r-in"><span>    <span class="va">EXSTDTM</span>, <span class="va">EXENDT</span>, <span class="va">EXENDTM</span>, <span class="va">EXSTDTC</span>, <span class="va">EXENDTC</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">create_single_dose_dataset</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">ex_mod</span>,</span></span>
<span class="r-in"><span>  start_date <span class="op">=</span> <span class="va">EXSTDT</span>,</span></span>
<span class="r-in"><span>  start_datetime <span class="op">=</span> <span class="va">EXSTDTM</span>,</span></span>
<span class="r-in"><span>  end_date <span class="op">=</span> <span class="va">EXENDT</span>,</span></span>
<span class="r-in"><span>  end_datetime <span class="op">=</span> <span class="va">EXENDTM</span>,</span></span>
<span class="r-in"><span>  keep_source_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">EXTRT</span>, <span class="va">EXDOSE</span>, <span class="va">EXDOSFRQ</span>,</span></span>
<span class="r-in"><span>    <span class="va">DCUTDT</span>, <span class="va">EXSTDT</span>, <span class="va">EXSTDTM</span>, <span class="va">EXENDT</span>, <span class="va">EXENDTM</span>, <span class="va">EXSTDTC</span>, <span class="va">EXENDTC</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 553 Ã— 12</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    STUDYID USUBJID EXTRT EXDOSE EXDOSFRQ DCUTDT     EXSTDT    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 01      1015    PLAC       0 ONCE     2015-03-06 2014-01-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 01      1015    PLAC       0 ONCE     2015-03-06 2014-01-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 01      1015    PLAC       0 ONCE     2015-03-06 2014-01-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 01      1015    PLAC       0 ONCE     2015-03-06 2014-01-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 01      1015    PLAC       0 ONCE     2015-03-06 2014-01-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 01      1015    PLAC       0 ONCE     2015-03-06 2014-01-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 01      1015    PLAC       0 ONCE     2015-03-06 2014-01-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 01      1015    PLAC       0 ONCE     2015-03-06 2014-01-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 01      1015    PLAC       0 ONCE     2015-03-06 2014-01-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 01      1015    PLAC       0 ONCE     2015-03-06 2014-01-11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># â„¹ 543 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># â„¹ 5 more variables: EXSTDTM &lt;dttm&gt;, EXENDT &lt;date&gt;, EXENDTM &lt;dttm&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   EXSTDTC &lt;chr&gt;, EXENDTC &lt;chr&gt;</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Straub, Stefan Bundfuss, Jeffrey Dickinson, Ross Farrugia, Fanny Gautier, Dinakar Kulkarni, Edoardo Mancini, Sadchla Mascary, Gordon Miller, Jim Rothstein, Sophie Shapcott, Eric Simms, Daniel Sjoberg, Stefan Thoma, Phillip Webster, Zelos Zhu, F. Hoffmann-La Roche AG, GlaxoSmithKline LLC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

