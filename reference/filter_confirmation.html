<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='The function filters observation using a condition taking subsequent
observations into account. For example, it could select all observations with
AVALC == "Y" and AVALC == "Y" for at least one subsequent observation.
The input dataset is joined with itself to enable conditions taking variables
from both the current observation and the subsequent observations into
account. The suffix ".join" is added to the variables from the subsequent
observations.
An example usage might be checking if a patient received two required
medications within a certain timeframe of each other.
In the oncology setting, for example, we use such processing to check if a
response value can be confirmed by a subsequent assessment. This is commonly
used in endpoints such as best overall response.'><title>Filter Confirmed Observations — filter_confirmation • admiral</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter Confirmed Observations — filter_confirmation"><meta property="og:description" content='The function filters observation using a condition taking subsequent
observations into account. For example, it could select all observations with
AVALC == "Y" and AVALC == "Y" for at least one subsequent observation.
The input dataset is joined with itself to enable conditions taking variables
from both the current observation and the subsequent observations into
account. The suffix ".join" is added to the variables from the subsequent
observations.
An example usage might be checking if a patient received two required
medications within a certain timeframe of each other.
In the oncology setting, for example, we use such processing to check if a
response value can be confirmed by a subsequent assessment. This is commonly
used in endpoints such as best overall response.'><meta property="og:image" content="https://pharmaverse.github.io/admiral/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-574L344W3R"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '{YOUR TRACKING ID}');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">admiral</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/admiral.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>User Guides</h6>
    <a class="dropdown-item" href="../articles/adsl.html">Creating ADSL</a>
    <a class="dropdown-item" href="../articles/occds.html">Creating an OCCDS ADaM</a>
    <a class="dropdown-item" href="../articles/bds_finding.html">Creating a BDS Finding ADaM</a>
    <a class="dropdown-item" href="../articles/bds_exposure.html">Creating a BDS Exposure ADaM</a>
    <a class="dropdown-item" href="../articles/bds_tte.html">Creating a BDS Time-to-Event ADaM</a>
    <a class="dropdown-item" href="../articles/imputation.html">Date and Time Imputation</a>
    <a class="dropdown-item" href="../articles/queries_dataset.html">Queries Dataset Documentation</a>
    <a class="dropdown-item" href="../articles/faq.html">FAQ</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Developer Guides</h6>
    <a class="dropdown-item" href="../articles/contribution_model.html">Contribution to {admiral}</a>
    <a class="dropdown-item" href="../articles/development_process.html">Development Process</a>
    <a class="dropdown-item" href="../articles/programming_strategy.html">Programming Strategy</a>
    <a class="dropdown-item" href="../articles/git_usage.html">Guidance for git and GitHub Usage</a>
    <a class="dropdown-item" href="../articles/writing_vignettes.html">Writing Vignettes</a>
    <a class="dropdown-item" href="../articles/pr_review_guidance.html">Pull Request Review Guidance</a>
    <a class="dropdown-item" href="../articles/unit_test_guidance.html">Unit Test Guidance</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Filter Confirmed Observations</h1>
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiral/blob/main/R/filter_confirmation.R" class="external-link"><code>R/filter_confirmation.R</code></a></small>
      <div class="d-none name"><code>filter_confirmation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function filters observation using a condition taking subsequent
observations into account. For example, it could select all observations with
<code>AVALC == "Y"</code> and <code>AVALC == "Y"</code> for at least one subsequent observation.
The input dataset is joined with itself to enable conditions taking variables
from both the current observation and the subsequent observations into
account. The suffix ".join" is added to the variables from the subsequent
observations.</p>
<p>An example usage might be checking if a patient received two required
medications within a certain timeframe of each other.</p>
<p>In the oncology setting, for example, we use such processing to check if a
response value can be confirmed by a subsequent assessment. This is commonly
used in endpoints such as best overall response.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">filter_confirmation</span><span class="op">(</span>
  <span class="va">dataset</span>,
  <span class="va">by_vars</span>,
  <span class="va">join_vars</span>,
  join_type <span class="op">=</span> <span class="st">"at_after"</span>,
  first_cond <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">order</span>,
  <span class="va">filter</span>,
  check_type <span class="op">=</span> <span class="st">"warning"</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dataset</dt>
<dd><p>Input dataset</p>
<p>The variables specified for <code>by_vars</code>, <code>join_vars</code>, and <code>order</code> are
expected.</p></dd>
<dt>by_vars</dt>
<dd><p>By variables</p>
<p>The specified variables are used as by variables for joining the input
dataset with itself.</p></dd>
<dt>join_vars</dt>
<dd><p>Variables to keep from joined dataset</p>
<p>The variables needed from the subsequent observations should be specified
for this parameter. The specified variables are added to the joined dataset
with suffix ".join". For example to select all observations with <code>AVALC == "Y"</code> and <code>AVALC == "Y"</code> for at least one subsequent visit <code>join_vars = vars(AVALC, AVISITN)</code> and <code>filter = AVALC == "Y" &amp; AVALC.join == "Y" &amp; AVISITN &lt; AVISITN.join</code> could be specified.</p>
<p>The <code>*.join</code> variables are not included in the output dataset.</p></dd>
<dt>join_type</dt>
<dd><p>Observations to keep after joining</p>
<p>The argument determines which of the joined observations are kept with
respect to the original observation. For example, if <code>join_type = "at_after"</code> is specified all observations at and after the original
observations are kept.</p>
<p><em>Default:</em> <code>"at_after"</code></p>
<p><em>Permitted Values:</em> <code>"before"</code>, <code>"at_before"</code>, <code>"at_after"</code>, <code>"after"</code>,
<code>"all"</code></p></dd>
<dt>first_cond</dt>
<dd><p>Condition for selecting range of data</p>
<p>If this argument is specified, the subsequent observations are restricted
up to the first observation where the specified condition is fulfilled. If
the condition is not fulfilled for any of the subsequent observations, all
observations are removed.</p></dd>
<dt>order</dt>
<dd><p>Order</p>
<p>The observations are ordered by the specified order.</p></dd>
<dt>filter</dt>
<dd><p>Condition for selecting observations</p>
<p>The filter is applied to the joined dataset for selecting the confirmed
observations. The condition can include summary functions. The joined
dataset is grouped by the original observations. I.e., the summary function
are applied to all observations up to the confirmation observation. For
example in the oncology setting when using this function for confirmed best
overall response,  <code>filter = AVALC == "CR" &amp; all(AVALC.join %in% c("CR", "NE")) &amp; count_vals(var = AVALC.join, val = "NE") &lt;= 1</code> selects
observations with response "CR" and for all observations up to the
confirmation observation the response is "CR" or "NE" and there is at most
one "NE".</p></dd>
<dt>check_type</dt>
<dd><p>Check uniqueness?</p>
<p>If <code>"warning"</code> or <code>"error"</code> is specified, the specified message is issued
if the observations of the input dataset are not unique with respect to the
by variables and the order.</p>
<p><em>Default:</em> <code>"none"</code></p>
<p><em>Permitted Values:</em> <code>"none"</code>, <code>"warning"</code>, <code>"error"</code></p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A subset of the observations of the input dataset. All variables of
the input dataset are included in the output dataset.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The following steps are performed to produce the output dataset.</p><div class="section">
<h3 id="step-">Step 1<a class="anchor" aria-label="anchor" href="#step-"></a></h3>


<p>The input dataset is joined with itself by the variables specified for
<code>by_vars</code>. From the right hand side of the join only the variables
specified for <code>join_vars</code> are kept. The suffix ".join" is added to these
variables.</p>
<p>For example, for <code>by_vars = USUBJID</code>, <code>join_vars = vars(AVISITN, AVALC)</code> and input dataset</p>
<p></p><div class="sourceCode r"><pre><code># A tibble: 2 x 4
USUBJID AVISITN AVALC  AVAL
&lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1             1 Y         1
1             2 N         0
</code></pre><p></p></div>
<p>the joined dataset is</p>
<p></p><div class="sourceCode r"><pre><code>A tibble: 4 x 6
USUBJID AVISITN AVALC  AVAL AVISITN.join AVALC.join
&lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;
1             1 Y         1            1 Y
1             1 Y         1            2 N
1             2 N         0            1 Y
1             2 N         0            2 N
</code></pre><p></p></div>
</div>

<div class="section">
<h3 id="step--1">Step 2<a class="anchor" aria-label="anchor" href="#step--1"></a></h3>


<p>The joined dataset is restricted to observations with respect to
<code>join_type</code> and <code>order</code>.</p>
<p>The dataset from the example in the previous step with <code>join_type = "at_after"</code> and order = vars(AVISITN)` is restricted to</p>
<p></p><div class="sourceCode r"><pre><code>A tibble: 4 x 6
USUBJID AVISITN AVALC  AVAL AVISITN.join AVALC.join
&lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;
1             1 Y         1            1 Y
1             1 Y         1            2 N
1             2 N         0            2 N
</code></pre><p></p></div>
</div>

<div class="section">
<h3 id="step--2">Step 3<a class="anchor" aria-label="anchor" href="#step--2"></a></h3>


<p>If <code>first_cond</code> is specified, for each observation of the input dataset the
joined dataset is restricted to observations up to the first observation
where <code>first_cond</code> is fulfilled (the observation fulfilling the condition
is included). If for an observation of the input dataset the condition is
not fulfilled, the observation is removed.</p>
</div>

<div class="section">
<h3 id="step--3">Step 4<a class="anchor" aria-label="anchor" href="#step--3"></a></h3>


<p>The joined dataset is grouped by the observations from the input dataset
and restricted to the observations fulfilling the condition specified by
<code>filter</code>.</p>
</div>

<div class="section">
<h3 id="step--4">Step 5<a class="anchor" aria-label="anchor" href="#step--4"></a></h3>


<p>The first observation of each group is selected and the <code>*.join</code> variables
are dropped.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="count_vals.html">count_vals()</a></code>, <code><a href="min_cond.html">min_cond()</a></code>, <code><a href="max_cond.html">max_cond()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Stefan Bundfuss</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pharmaverse.github.io/admiral">admiral</a></span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># filter observations with a duration longer than 30 and</span></span>
<span class="r-in"><span class="co"># on or after 7 days before a COVID AE (ACOVFL == "Y")</span></span>
<span class="r-in"><span class="va">adae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ADY</span>, <span class="op">~</span><span class="va">ACOVFL</span>, <span class="op">~</span><span class="va">ADURN</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,        <span class="fl">10</span>, <span class="st">"N"</span>,          <span class="fl">1</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,        <span class="fl">21</span>, <span class="st">"N"</span>,         <span class="fl">50</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,        <span class="fl">23</span>, <span class="st">"Y"</span>,         <span class="fl">14</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,        <span class="fl">32</span>, <span class="st">"N"</span>,         <span class="fl">31</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,        <span class="fl">42</span>, <span class="st">"N"</span>,         <span class="fl">20</span>,</span>
<span class="r-in">  <span class="st">"2"</span>,        <span class="fl">11</span>, <span class="st">"Y"</span>,         <span class="fl">13</span>,</span>
<span class="r-in">  <span class="st">"2"</span>,        <span class="fl">23</span>, <span class="st">"N"</span>,          <span class="fl">2</span>,</span>
<span class="r-in">  <span class="st">"3"</span>,        <span class="fl">13</span>, <span class="st">"Y"</span>,         <span class="fl">12</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,        <span class="fl">14</span>, <span class="st">"N"</span>,         <span class="fl">32</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,        <span class="fl">21</span>, <span class="st">"N"</span>,         <span class="fl">41</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">filter_confirmation</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">adae</span>,</span>
<span class="r-in">  by_vars <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span class="r-in">  join_vars <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">ACOVFL</span>, <span class="va">ADY</span><span class="op">)</span>,</span>
<span class="r-in">  join_type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span class="r-in">  order <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">ADY</span><span class="op">)</span>,</span>
<span class="r-in">  filter <span class="op">=</span> <span class="va">ADURN</span> <span class="op">&gt;</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">ACOVFL.join</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">ADY</span> <span class="op">&gt;=</span> <span class="va">ADY.join</span> <span class="op">-</span> <span class="fl">7</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;"># A tibble: 2 x 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID   ADY ACOVFL ADURN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">1</span><span> 1          21 N         50</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">2</span><span> 1          32 N         31</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># filter observations with AVALC == "Y" and AVALC == "Y" at a subsequent visit</span></span>
<span class="r-in"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">AVISITN</span>, <span class="op">~</span><span class="va">AVALC</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,      <span class="fl">3</span>,        <span class="st">"Y"</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,      <span class="fl">4</span>,        <span class="st">"N"</span>,</span>
<span class="r-in">  <span class="st">"2"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span>
<span class="r-in">  <span class="st">"2"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span>
<span class="r-in">  <span class="st">"3"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,      <span class="fl">1</span>,        <span class="st">"N"</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">filter_confirmation</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">data</span>,</span>
<span class="r-in">  by_vars <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span class="r-in">  join_vars <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">AVALC</span>, <span class="va">AVISITN</span><span class="op">)</span>,</span>
<span class="r-in">  order <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>,</span>
<span class="r-in">  filter <span class="op">=</span> <span class="va">AVALC</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">AVISITN</span> <span class="op">&lt;</span> <span class="va">AVISITN.join</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;"># A tibble: 1 x 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID AVISITN AVALC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">1</span><span> 1             1 Y    </span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># select observations with AVALC == "CR", AVALC == "CR" at a subsequent visit,</span></span>
<span class="r-in"><span class="co"># only "CR" or "NE" in between, and at most one "NE" in between</span></span>
<span class="r-in"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">AVISITN</span>, <span class="op">~</span><span class="va">AVALC</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,      <span class="fl">1</span>,        <span class="st">"PR"</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,      <span class="fl">2</span>,        <span class="st">"CR"</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,      <span class="fl">3</span>,        <span class="st">"NE"</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,      <span class="fl">4</span>,        <span class="st">"CR"</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,      <span class="fl">5</span>,        <span class="st">"NE"</span>,</span>
<span class="r-in">  <span class="st">"2"</span>,      <span class="fl">1</span>,        <span class="st">"CR"</span>,</span>
<span class="r-in">  <span class="st">"2"</span>,      <span class="fl">2</span>,        <span class="st">"PR"</span>,</span>
<span class="r-in">  <span class="st">"2"</span>,      <span class="fl">3</span>,        <span class="st">"CR"</span>,</span>
<span class="r-in">  <span class="st">"3"</span>,      <span class="fl">1</span>,        <span class="st">"CR"</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,      <span class="fl">1</span>,        <span class="st">"CR"</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,      <span class="fl">2</span>,        <span class="st">"NE"</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,      <span class="fl">3</span>,        <span class="st">"NE"</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,      <span class="fl">4</span>,        <span class="st">"CR"</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,      <span class="fl">5</span>,        <span class="st">"PR"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">filter_confirmation</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">data</span>,</span>
<span class="r-in">  by_vars <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span class="r-in">  join_vars <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">AVALC</span><span class="op">)</span>,</span>
<span class="r-in">  order <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>,</span>
<span class="r-in">  first_cond <span class="op">=</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"CR"</span>,</span>
<span class="r-in">  filter <span class="op">=</span> <span class="va">AVALC</span> <span class="op">==</span> <span class="st">"CR"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">AVALC.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"NE"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span class="r-in">    <span class="fu"><a href="count_vals.html">count_vals</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">AVALC.join</span>, val <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;"># A tibble: 1 x 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID AVISITN AVALC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">1</span><span> 1             2 CR   </span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># select observations with AVALC == "PR", AVALC == "CR" or AVALC == "PR"</span></span>
<span class="r-in"><span class="co"># at a subsequent visit at least 20 days later, only "CR", "PR", or "NE"</span></span>
<span class="r-in"><span class="co"># in between, at most one "NE" in between, and "CR" is not followed by "PR"</span></span>
<span class="r-in"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ADY</span>, <span class="op">~</span><span class="va">AVALC</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,         <span class="fl">6</span>, <span class="st">"PR"</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,        <span class="fl">12</span>, <span class="st">"CR"</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,        <span class="fl">24</span>, <span class="st">"NE"</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,        <span class="fl">32</span>, <span class="st">"CR"</span>,</span>
<span class="r-in">  <span class="st">"1"</span>,        <span class="fl">48</span>, <span class="st">"PR"</span>,</span>
<span class="r-in">  <span class="st">"2"</span>,         <span class="fl">3</span>, <span class="st">"PR"</span>,</span>
<span class="r-in">  <span class="st">"2"</span>,        <span class="fl">21</span>, <span class="st">"CR"</span>,</span>
<span class="r-in">  <span class="st">"2"</span>,        <span class="fl">33</span>, <span class="st">"PR"</span>,</span>
<span class="r-in">  <span class="st">"3"</span>,        <span class="fl">11</span>, <span class="st">"PR"</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,         <span class="fl">7</span>, <span class="st">"PR"</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,        <span class="fl">12</span>, <span class="st">"NE"</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,        <span class="fl">24</span>, <span class="st">"NE"</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,        <span class="fl">32</span>, <span class="st">"PR"</span>,</span>
<span class="r-in">  <span class="st">"4"</span>,        <span class="fl">55</span>, <span class="st">"PR"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">filter_confirmation</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">data</span>,</span>
<span class="r-in">  by_vars <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span class="r-in">  join_vars <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">AVALC</span>, <span class="va">ADY</span><span class="op">)</span>,</span>
<span class="r-in">  order <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">ADY</span><span class="op">)</span>,</span>
<span class="r-in">  first_cond <span class="op">=</span> <span class="va">AVALC.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"PR"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">ADY.join</span> <span class="op">-</span> <span class="va">ADY</span> <span class="op">&gt;=</span> <span class="fl">20</span>,</span>
<span class="r-in">  filter <span class="op">=</span> <span class="va">AVALC</span> <span class="op">==</span> <span class="st">"PR"</span> <span class="op">&amp;</span></span>
<span class="r-in">    <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">AVALC.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"PR"</span>, <span class="st">"NE"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span class="r-in">    <span class="fu"><a href="count_vals.html">count_vals</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">AVALC.join</span>, val <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1</span> <span class="op">&amp;</span></span>
<span class="r-in">    <span class="op">(</span></span>
<span class="r-in">      <span class="fu"><a href="min_cond.html">min_cond</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">ADY.join</span>, cond <span class="op">=</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"CR"</span><span class="op">)</span> <span class="op">&gt;</span></span>
<span class="r-in">        <span class="fu"><a href="max_cond.html">max_cond</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">ADY.join</span>, cond <span class="op">=</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"PR"</span><span class="op">)</span> <span class="op">|</span></span>
<span class="r-in">        <span class="fu"><a href="count_vals.html">count_vals</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">AVALC.join</span>, val <span class="op">=</span> <span class="st">"CR"</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span></span>
<span class="r-in">    <span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;"># A tibble: 2 x 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID   ADY AVALC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">1</span><span> 1           6 PR   </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">2</span><span> 4          32 PR   </span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Thomas Neitmann, Stefan Bundfuss, Ben Straub, Samia Kabi, Gordon Miller, Teckla Akinyi, Andrew Smith, Konstantina Koukourikou, Ross Farrugia, Eric Simms, Annie Yang, Robin Koeger, Sophie Shapcott, Ojesh Upadhyay, Jack McGavigan, Kamila Duniec, Gayatri G, Alana Harris, Mahdi About, Pooja Kumari, Claudia Carlucci, Daniil Stefonishin, F. Hoffmann-La Roche AG, GlaxoSmithKline LLC.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer></div>

  

  

  </body></html>

