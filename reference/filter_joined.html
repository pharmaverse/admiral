<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Filter Observations Taking Other Observations into Account â€” filter_joined â€¢ admiral</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter Observations Taking Other Observations into Account â€” filter_joined"><meta name="description" content='The function filters observation using a condition taking other observations
into account. For example, it could select all observations with AVALC == "Y" and AVALC == "Y" for at least one subsequent observation. The input
dataset is joined with itself to enable conditions taking variables from both
the current observation and the other observations into account. The suffix
".join" is added to the variables from the subsequent observations.
An example usage might be checking if a patient received two required
medications within a certain timeframe of each other.
In the oncology setting, for example, we use such processing to check if a
response value can be confirmed by a subsequent assessment. This is commonly
used in endpoints such as best overall response.'><meta property="og:description" content='The function filters observation using a condition taking other observations
into account. For example, it could select all observations with AVALC == "Y" and AVALC == "Y" for at least one subsequent observation. The input
dataset is joined with itself to enable conditions taking variables from both
the current observation and the other observations into account. The suffix
".join" is added to the variables from the subsequent observations.
An example usage might be checking if a patient received two required
medications within a certain timeframe of each other.
In the oncology setting, for example, we use such processing to check if a
response value can be confirmed by a subsequent assessment. This is commonly
used in endpoints such as best overall response.'><meta property="og:image" content="https://pharmaverse.github.io/admiral/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">admiral</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started"><li><a class="dropdown-item" href="../articles/admiral.html">Get Started</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/pharmaverse/admiral/blob/main/inst/cheatsheet/admiral_cheatsheet.pdf">Cheatsheet</a></li>
    <li><a class="dropdown-item" href="https://pharmaverse.github.io/admiraldiscovery/articles/presentation_archive.html">Presentation Archive</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides"><li><h6 class="dropdown-header" data-toc-skip>General Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/concepts_conventions.html">Programming Concepts and Conventions</a></li>
    <li><a class="dropdown-item" href="../articles/generic.html">Generic Derivations</a></li>
    <li><a class="dropdown-item" href="../articles/higher_order.html">Higher Order Functions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>ADaM Script Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/adsl.html">Creating a Basic ADSL</a></li>
    <li><a class="dropdown-item" href="../articles/occds.html">Creating an OCCDS ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_finding.html">Creating a BDS Findings ADAM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_exposure.html">Creating a BDS Exposure ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_tte.html">Creating a BDS Time-to-Event ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/questionnaires.html">Creating Questionnaire ADaMs</a></li>
    <li><a class="dropdown-item" href="../articles/pk_adnca.html">Creating a PK NCA or Population PK ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/hys_law.html">Hy's Law Implementation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Special Topics Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/imputation.html">Date and Time Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/visits_periods.html">Visit and Period Variables</a></li>
    <li><a class="dropdown-item" href="../articles/queries_dataset.html">Queries Dataset Documentation</a></li>
    <li><a class="dropdown-item" href="../articles/lab_grading.html">Lab Grading</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="https://pharmaverse.github.io/admiraldiscovery/articles/reactable.html">ðŸ”Ž Find my function</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.slack.com/" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/website-versions.html" aria-label="Previous Release Websites"><span class="fa fa-history"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/issues/new/choose" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Filter Observations Taking Other Observations into Account</h1>
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiral/blob/main/R/filter_joined.R" class="external-link"><code>R/filter_joined.R</code></a></small>
      <div class="d-none name"><code>filter_joined.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function filters observation using a condition taking other observations
into account. For example, it could select all observations with <code>AVALC == "Y"</code> and <code>AVALC == "Y"</code> for at least one subsequent observation. The input
dataset is joined with itself to enable conditions taking variables from both
the current observation and the other observations into account. The suffix
".join" is added to the variables from the subsequent observations.</p>
<p>An example usage might be checking if a patient received two required
medications within a certain timeframe of each other.</p>
<p>In the oncology setting, for example, we use such processing to check if a
response value can be confirmed by a subsequent assessment. This is commonly
used in endpoints such as best overall response.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">filter_joined</span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  <span class="va">dataset_add</span>,</span>
<span>  <span class="va">by_vars</span>,</span>
<span>  <span class="va">join_vars</span>,</span>
<span>  <span class="va">join_type</span>,</span>
<span>  first_cond_lower <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  first_cond_upper <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">order</span>,</span>
<span>  tmp_obs_nr_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  filter_add <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">filter_join</span>,</span>
<span>  check_type <span class="op">=</span> <span class="st">"warning"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dataset">dataset<a class="anchor" aria-label="anchor" href="#arg-dataset"></a></dt>
<dd><p>Input dataset</p>
<p>The variables specified by the <code>by_vars</code> and <code>order</code> arguments are expected to be in the dataset.</p></dd>


<dt id="arg-dataset-add">dataset_add<a class="anchor" aria-label="anchor" href="#arg-dataset-add"></a></dt>
<dd><p>Additional dataset</p>
<p>The variables specified for <code>by_vars</code>, <code>join_vars</code>, and <code>order</code> are
expected.</p></dd>


<dt id="arg-by-vars">by_vars<a class="anchor" aria-label="anchor" href="#arg-by-vars"></a></dt>
<dd><p>By variables</p>
<p>The specified variables are used as by variables for joining the input
dataset with itself.</p>
<p><em>Permitted Values</em>: list of variables created by <code><a href="reexport-exprs.html">exprs()</a></code>
e.g. <code>exprs(USUBJID, VISIT)</code></p></dd>


<dt id="arg-join-vars">join_vars<a class="anchor" aria-label="anchor" href="#arg-join-vars"></a></dt>
<dd><p>Variables to keep from joined dataset</p>
<p>The variables needed from the other observations should be specified for
this parameter. The specified variables are added to the joined dataset
with suffix ".join". For example to select all observations with <code>AVALC == "Y"</code> and <code>AVALC == "Y"</code> for at least one subsequent visit <code>join_vars = exprs(AVALC, AVISITN)</code> and <code>filter_join = AVALC == "Y" &amp; AVALC.join == "Y" &amp; AVISITN &lt; AVISITN.join</code> could be specified.</p>
<p>The <code>*.join</code> variables are not included in the output dataset.</p></dd>


<dt id="arg-join-type">join_type<a class="anchor" aria-label="anchor" href="#arg-join-type"></a></dt>
<dd><p>Observations to keep after joining</p>
<p>The argument determines which of the joined observations are kept with
respect to the original observation. For example, if <code>join_type = "after"</code>
is specified all observations after the original observations are kept.</p>
<p>For example for confirmed response or BOR in the oncology setting or
confirmed deterioration in questionnaires the confirmatory assessment must
be after the assessment. Thus <code>join_type = "after"</code> could be used.</p>
<p>Whereas, sometimes you might allow for confirmatory observations to occur
prior to the observation. For example, to identify AEs occurring on or
after seven days before a COVID AE. Thus <code>join_type = "all"</code> could be used.</p>
<p><em>Permitted Values:</em> <code>"before"</code>, <code>"after"</code>, <code>"all"</code></p></dd>


<dt id="arg-first-cond-lower">first_cond_lower<a class="anchor" aria-label="anchor" href="#arg-first-cond-lower"></a></dt>
<dd><p>Condition for selecting range of data (before)</p>
<p>If this argument is specified, the other observations are restricted from
the first observation before the current observation where the specified
condition is fulfilled up to the current observation. If the condition is
not fulfilled for any of the other observations, no observations are
considered, i.e., the observation is not flagged.</p>
<p>This parameter should be specified if <code>filter_join</code> contains summary
functions which should not apply to all observations but only from a
certain observation before the current observation up to the current
observation. For an example see the last example below.</p></dd>


<dt id="arg-first-cond-upper">first_cond_upper<a class="anchor" aria-label="anchor" href="#arg-first-cond-upper"></a></dt>
<dd><p>Condition for selecting range of data (after)</p>
<p>If this argument is specified, the other observations are restricted up to
the first observation where the specified condition is fulfilled. If the
condition is not fulfilled for any of the other observations, no
observations are considered, i.e., the observation is not flagged.</p>
<p>This parameter should be specified if <code>filter_join</code> contains summary
functions which should not apply to all observations but only up to the
confirmation assessment. For an example see the last example below.</p></dd>


<dt id="arg-order">order<a class="anchor" aria-label="anchor" href="#arg-order"></a></dt>
<dd><p>Order</p>
<p>The observations are ordered by the specified order.</p>
<p>For handling of <code>NA</code>s in sorting variables see <a href="../articles/generic.html#sort_order">Sort Order</a>.</p>
<p><em>Permitted Values:</em> list of expressions created by <code><a href="reexport-exprs.html">exprs()</a></code>, e.g.,
<code>exprs(ADT, desc(AVAL))</code></p></dd>


<dt id="arg-tmp-obs-nr-var">tmp_obs_nr_var<a class="anchor" aria-label="anchor" href="#arg-tmp-obs-nr-var"></a></dt>
<dd><p>Temporary observation number</p>
<p>The specified variable is added to the input dataset (<code>dataset</code>) and the
additional dataset (<code>dataset_add</code>). It is set to the observation number
with respect to <code>order</code>. For each by group (<code>by_vars</code>) the observation
number starts with <code>1</code>. The variable can be used in the conditions
(<code>filter_join</code>, <code>first_cond_upper</code>, <code>first_cond_lower</code>). It is not included
in the output dataset. It can also be used to select consecutive
observations or the last observation (see example below).</p></dd>


<dt id="arg-filter-add">filter_add<a class="anchor" aria-label="anchor" href="#arg-filter-add"></a></dt>
<dd><p>Filter for additional dataset (<code>dataset_add</code>)</p>
<p>Only observations from <code>dataset_add</code> fulfilling the specified condition are
joined to the input dataset. If the argument is not specified, all
observations are joined.</p>
<p>Variables created by the <code>order</code> argument can be used in the condition.</p>
<p>The condition can include summary functions. The additional dataset is
grouped by the by variables (<code>by_vars</code>).</p></dd>


<dt id="arg-filter-join">filter_join<a class="anchor" aria-label="anchor" href="#arg-filter-join"></a></dt>
<dd><p>Condition for selecting observations</p>
<p>The filter is applied to the joined dataset for selecting the confirmed
observations. The condition can include summary functions like <code><a href="https://rdrr.io/r/base/all.html" class="external-link">all()</a></code> or
<code><a href="https://rdrr.io/r/base/any.html" class="external-link">any()</a></code>. The joined dataset is grouped by the original observations. I.e.,
the summary function are applied to all observations up to the confirmation
observation. For example in the oncology setting when using this function
for confirmed best overall response,  <code>filter_join = AVALC == "CR" &amp; all(AVALC.join %in% c("CR", "NE")) &amp; count_vals(var = AVALC.join, val = "NE") &lt;= 1</code> selects observations with response "CR" and for all
observations up to the confirmation observation the response is "CR" or
"NE" and there is at most one "NE".</p></dd>


<dt id="arg-check-type">check_type<a class="anchor" aria-label="anchor" href="#arg-check-type"></a></dt>
<dd><p>Check uniqueness?</p>
<p>If <code>"warning"</code> or <code>"error"</code> is specified, the specified message is issued
if the observations of the input dataset are not unique with respect to the
by variables and the order.</p>
<p><em>Permitted Values:</em> <code>"none"</code>, <code>"warning"</code>, <code>"error"</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A subset of the observations of the input dataset. All variables of
the input dataset are included in the output dataset.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The following steps are performed to produce the output dataset.</p><div class="section">
<h3 id="step-">Step 1<a class="anchor" aria-label="anchor" href="#step-"></a></h3>

<ul><li><p>The variables specified by <code>order</code> are added to the additional dataset
(<code>dataset_add</code>).</p></li>
<li><p>The variables specified by <code>join_vars</code> are added to the additional dataset
(<code>dataset_add</code>).</p></li>
<li><p>The records from the additional dataset (<code>dataset_add</code>) are restricted to
those matching the <code>filter_add</code> condition.</p></li>
</ul><p>Then the  input dataset (<code>dataset</code>) is joined with the restricted
additional dataset by the variables specified for <code>by_vars</code>. From the
additional dataset only the variables specified for <code>join_vars</code> are kept.
The suffix ".join" is added to those variables which are also present in
the input dataset.</p>
<p>For example, for <code>by_vars = USUBJID</code>, <code>join_vars = exprs(AVISITN, AVALC)</code>
and input dataset and additional dataset</p>
<p></p><div class="sourceCode r"><pre><code># A tibble: 2 x 4
USUBJID AVISITN AVALC  AVAL
&lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1             1 Y         1
1             2 N         0
</code></pre><p></p></div>
<p>the joined dataset is</p>
<p></p><div class="sourceCode r"><pre><code>A tibble: 4 x 6
USUBJID AVISITN AVALC  AVAL AVISITN.join AVALC.join
&lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;
1             1 Y         1            1 Y
1             1 Y         1            2 N
1             2 N         0            1 Y
1             2 N         0            2 N
</code></pre><p></p></div>
</div>

<div class="section">
<h3 id="step--1">Step 2<a class="anchor" aria-label="anchor" href="#step--1"></a></h3>


<p>The joined dataset is restricted to observations with respect to
<code>join_type</code> and <code>order</code>.</p>
<p>The dataset from the example in the previous step with <code>join_type = "after"</code> and <code>order = exprs(AVISITN)</code> is restricted to</p>
<p></p><div class="sourceCode r"><pre><code>A tibble: 4 x 6
USUBJID AVISITN AVALC  AVAL AVISITN.join AVALC.join
&lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;
1             1 Y         1            2 N
</code></pre><p></p></div>
</div>

<div class="section">
<h3 id="step--2">Step 3<a class="anchor" aria-label="anchor" href="#step--2"></a></h3>


<p>If <code>first_cond_lower</code> is specified, for each observation of the input
dataset the joined dataset is restricted to observations from the first
observation where <code>first_cond_lower</code> is fulfilled (the observation
fulfilling the condition is included) up to the observation of the input
dataset. If for an observation of the input dataset the condition is not
fulfilled, the observation is removed.</p>
<p>If <code>first_cond_upper</code> is specified, for each observation of the input
dataset the joined dataset is restricted to observations up to the first
observation where <code>first_cond_upper</code> is fulfilled (the observation
fulfilling the condition is included). If for an observation of the input
dataset the condition is not fulfilled, the observation is removed.</p>
<p>For an example see the last example in the "Examples" section.</p>
</div>

<div class="section">
<h3 id="step--3">Step 4<a class="anchor" aria-label="anchor" href="#step--3"></a></h3>


<p>The joined dataset is grouped by the observations from the input dataset
and restricted to the observations fulfilling the condition specified by
<code>filter_join</code>.</p>
</div>

<div class="section">
<h3 id="step--4">Step 5<a class="anchor" aria-label="anchor" href="#step--4"></a></h3>


<p>The first observation of each group is selected and the <code>*.join</code> variables
are dropped.</p>
<p><strong>Note:</strong> This function creates temporary datasets which may be much bigger
than the input datasets. If this causes memory issues, please try setting
the admiral option <code>save_memory</code> to <code>TRUE</code> (see <code><a href="set_admiral_options.html">set_admiral_options()</a></code>).
This reduces the memory consumption but increases the run-time.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="count_vals.html">count_vals()</a></code>, <code><a href="min_cond.html">min_cond()</a></code>, <code><a href="max_cond.html">max_cond()</a></code></p>
<p>Utilities for Filtering Observations:
<code><a href="count_vals.html">count_vals</a>()</code>,
<code><a href="filter_exist.html">filter_exist</a>()</code>,
<code><a href="filter_extreme.html">filter_extreme</a>()</code>,
<code><a href="filter_not_exist.html">filter_not_exist</a>()</code>,
<code><a href="filter_relative.html">filter_relative</a>()</code>,
<code><a href="max_cond.html">max_cond</a>()</code>,
<code><a href="min_cond.html">min_cond</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pharmaverse.github.io/admiral/">admiral</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># filter observations with a duration longer than 30 and</span></span></span>
<span class="r-in"><span><span class="co"># on or after 7 days before a COVID AE (ACOVFL == "Y")</span></span></span>
<span class="r-in"><span><span class="va">adae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ADY</span>, <span class="op">~</span><span class="va">ACOVFL</span>, <span class="op">~</span><span class="va">ADURN</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,        <span class="fl">10</span>, <span class="st">"N"</span>,          <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,        <span class="fl">21</span>, <span class="st">"N"</span>,         <span class="fl">50</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,        <span class="fl">23</span>, <span class="st">"Y"</span>,         <span class="fl">14</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,        <span class="fl">32</span>, <span class="st">"N"</span>,         <span class="fl">31</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,        <span class="fl">42</span>, <span class="st">"N"</span>,         <span class="fl">20</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,        <span class="fl">11</span>, <span class="st">"Y"</span>,         <span class="fl">13</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,        <span class="fl">23</span>, <span class="st">"N"</span>,          <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  <span class="st">"3"</span>,        <span class="fl">13</span>, <span class="st">"Y"</span>,         <span class="fl">12</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,        <span class="fl">14</span>, <span class="st">"N"</span>,         <span class="fl">32</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,        <span class="fl">21</span>, <span class="st">"N"</span>,         <span class="fl">41</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">filter_joined</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">adae</span>,</span></span>
<span class="r-in"><span>  dataset_add <span class="op">=</span> <span class="va">adae</span>,</span></span>
<span class="r-in"><span>  by_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ACOVFL</span>, <span class="va">ADY</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_type <span class="op">=</span> <span class="st">"all"</span>,</span></span>
<span class="r-in"><span>  order <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADY</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  filter_join <span class="op">=</span> <span class="va">ADURN</span> <span class="op">&gt;</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">ACOVFL.join</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">ADY</span> <span class="op">&gt;=</span> <span class="va">ADY.join</span> <span class="op">-</span> <span class="fl">7</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 Ã— 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID   ADY ACOVFL ADURN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 1          21 N         50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> 1          32 N         31</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># filter observations with AVALC == "Y" and AVALC == "Y" at a subsequent visit</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">AVISITN</span>, <span class="op">~</span><span class="va">AVALC</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">3</span>,        <span class="st">"Y"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">4</span>,        <span class="st">"N"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"3"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,      <span class="fl">1</span>,        <span class="st">"N"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">filter_joined</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">data</span>,</span></span>
<span class="r-in"><span>  dataset_add <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>  by_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVALC</span>, <span class="va">AVISITN</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span></span>
<span class="r-in"><span>  order <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  filter_join <span class="op">=</span> <span class="va">AVALC</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">AVISITN</span> <span class="op">&lt;</span> <span class="va">AVISITN.join</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 Ã— 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID AVISITN AVALC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 1             1 Y    </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># select observations with AVALC == "CR", AVALC == "CR" at a subsequent visit,</span></span></span>
<span class="r-in"><span><span class="co"># only "CR" or "NE" in between, and at most one "NE" in between</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">AVISITN</span>, <span class="op">~</span><span class="va">AVALC</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">1</span>,        <span class="st">"PR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">2</span>,        <span class="st">"CR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">3</span>,        <span class="st">"NE"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">4</span>,        <span class="st">"CR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">5</span>,        <span class="st">"NE"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">1</span>,        <span class="st">"CR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">2</span>,        <span class="st">"PR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">3</span>,        <span class="st">"CR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"3"</span>,      <span class="fl">1</span>,        <span class="st">"CR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,      <span class="fl">1</span>,        <span class="st">"CR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,      <span class="fl">2</span>,        <span class="st">"NE"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,      <span class="fl">3</span>,        <span class="st">"NE"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,      <span class="fl">4</span>,        <span class="st">"CR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,      <span class="fl">5</span>,        <span class="st">"PR"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">filter_joined</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">data</span>,</span></span>
<span class="r-in"><span>  dataset_add <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>  by_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVALC</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span></span>
<span class="r-in"><span>  order <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  first_cond_upper <span class="op">=</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"CR"</span>,</span></span>
<span class="r-in"><span>  filter_join <span class="op">=</span> <span class="va">AVALC</span> <span class="op">==</span> <span class="st">"CR"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">AVALC.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"NE"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="count_vals.html">count_vals</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">AVALC.join</span>, val <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 Ã— 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID AVISITN AVALC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 1             2 CR   </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># select observations with AVALC == "PR", AVALC == "CR" or AVALC == "PR"</span></span></span>
<span class="r-in"><span><span class="co"># at a subsequent visit at least 20 days later, only "CR", "PR", or "NE"</span></span></span>
<span class="r-in"><span><span class="co"># in between, at most one "NE" in between, and "CR" is not followed by "PR"</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ADY</span>, <span class="op">~</span><span class="va">AVALC</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,         <span class="fl">6</span>, <span class="st">"PR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,        <span class="fl">12</span>, <span class="st">"CR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,        <span class="fl">24</span>, <span class="st">"NE"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,        <span class="fl">32</span>, <span class="st">"CR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,        <span class="fl">48</span>, <span class="st">"PR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,         <span class="fl">3</span>, <span class="st">"PR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,        <span class="fl">21</span>, <span class="st">"CR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,        <span class="fl">33</span>, <span class="st">"PR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"3"</span>,        <span class="fl">11</span>, <span class="st">"PR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,         <span class="fl">7</span>, <span class="st">"PR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,        <span class="fl">12</span>, <span class="st">"NE"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,        <span class="fl">24</span>, <span class="st">"NE"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,        <span class="fl">32</span>, <span class="st">"PR"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,        <span class="fl">55</span>, <span class="st">"PR"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">filter_joined</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">data</span>,</span></span>
<span class="r-in"><span>  dataset_add <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>  by_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVALC</span>, <span class="va">ADY</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span></span>
<span class="r-in"><span>  order <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADY</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  first_cond_upper <span class="op">=</span> <span class="va">AVALC.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"PR"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">ADY.join</span> <span class="op">-</span> <span class="va">ADY</span> <span class="op">&gt;=</span> <span class="fl">20</span>,</span></span>
<span class="r-in"><span>  filter_join <span class="op">=</span> <span class="va">AVALC</span> <span class="op">==</span> <span class="st">"PR"</span> <span class="op">&amp;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">AVALC.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"PR"</span>, <span class="st">"NE"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="count_vals.html">count_vals</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">AVALC.join</span>, val <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1</span> <span class="op">&amp;</span></span></span>
<span class="r-in"><span>    <span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="min_cond.html">min_cond</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">ADY.join</span>, cond <span class="op">=</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"CR"</span><span class="op">)</span> <span class="op">&gt;</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="max_cond.html">max_cond</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">ADY.join</span>, cond <span class="op">=</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"PR"</span><span class="op">)</span> <span class="op">|</span></span></span>
<span class="r-in"><span>        <span class="fu"><a href="count_vals.html">count_vals</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">AVALC.join</span>, val <span class="op">=</span> <span class="st">"CR"</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 Ã— 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID   ADY AVALC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 4          32 PR   </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># select observations with CRIT1FL == "Y" at two consecutive visits or at the last visit</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">AVISITN</span>, <span class="op">~</span><span class="va">CRIT1FL</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">3</span>,        <span class="st">"Y"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">5</span>,        <span class="st">"N"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">3</span>,        <span class="st">"Y"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">5</span>,        <span class="st">"N"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"3"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"4"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">filter_joined</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">data</span>,</span></span>
<span class="r-in"><span>  dataset_add <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>  by_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  tmp_obs_nr_var <span class="op">=</span> <span class="va">tmp_obs_nr</span>,</span></span>
<span class="r-in"><span>  join_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">CRIT1FL</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_type <span class="op">=</span> <span class="st">"all"</span>,</span></span>
<span class="r-in"><span>  order <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  filter_join <span class="op">=</span> <span class="va">CRIT1FL</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">CRIT1FL.join</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span></span></span>
<span class="r-in"><span>    <span class="op">(</span><span class="va">tmp_obs_nr</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">==</span> <span class="va">tmp_obs_nr.join</span> <span class="op">|</span> <span class="va">tmp_obs_nr</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tmp_obs_nr.join</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 Ã— 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID AVISITN CRIT1FL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 2             1 Y      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> 3             1 Y      </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># first_cond_lower and first_cond_upper argument</span></span></span>
<span class="r-in"><span><span class="va">myd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">subj</span>, <span class="op">~</span><span class="va">day</span>, <span class="op">~</span><span class="va">val</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">1</span>, <span class="st">"++"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">2</span>, <span class="st">"-"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">3</span>, <span class="st">"0"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">4</span>, <span class="st">"+"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">5</span>, <span class="st">"++"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="fl">6</span>, <span class="st">"-"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">1</span>, <span class="st">"-"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">2</span>, <span class="st">"++"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">3</span>, <span class="st">"+"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">4</span>, <span class="st">"0"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">5</span>, <span class="st">"-"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="fl">6</span>, <span class="st">"++"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># select "0" where all results from the first "++" before the "0" up to the "0"</span></span></span>
<span class="r-in"><span><span class="co"># (excluding the "0") are "+" or "++"</span></span></span>
<span class="r-in"><span><span class="fu">filter_joined</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">myd</span>,</span></span>
<span class="r-in"><span>  dataset_add <span class="op">=</span> <span class="va">myd</span>,</span></span>
<span class="r-in"><span>  by_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">subj</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  order <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_type <span class="op">=</span> <span class="st">"before"</span>,</span></span>
<span class="r-in"><span>  first_cond_lower <span class="op">=</span> <span class="va">val.join</span> <span class="op">==</span> <span class="st">"++"</span>,</span></span>
<span class="r-in"><span>  filter_join <span class="op">=</span> <span class="va">val</span> <span class="op">==</span> <span class="st">"0"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">val.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="st">"++"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 Ã— 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   subj    day val  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 2         4 0    </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># select "0" where all results from the "0" (excluding the "0") up to the first</span></span></span>
<span class="r-in"><span><span class="co"># "++" after the "0" are "+" or "++"</span></span></span>
<span class="r-in"><span><span class="fu">filter_joined</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">myd</span>,</span></span>
<span class="r-in"><span>  dataset_add <span class="op">=</span> <span class="va">myd</span>,</span></span>
<span class="r-in"><span>  by_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">subj</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  order <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span></span>
<span class="r-in"><span>  first_cond_upper <span class="op">=</span> <span class="va">val.join</span> <span class="op">==</span> <span class="st">"++"</span>,</span></span>
<span class="r-in"><span>  filter_join <span class="op">=</span> <span class="va">val</span> <span class="op">==</span> <span class="st">"0"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">val.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="st">"++"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 Ã— 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   subj    day val  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 1         3 0    </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Straub, Stefan Bundfuss, Jeffrey Dickinson, Ross Farrugia, Fanny Gautier, Dinakar Kulkarni, Edoardo Mancini, Sadchla Mascary, Gordon Miller, Jim Rothstein, Sophie Shapcott, Eric Simms, Daniel Sjoberg, Stefan Thoma, Phillip Webster, Zelos Zhu, F. Hoffmann-La Roche AG, GlaxoSmithKline LLC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

