<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The function adds subperiod, period, or phase variables like P01S1SDT,
P01S2SDT, AP01SDTM, AP02SDTM, TRT01A, TRT02A, PH1SDT, PH2SDT,
... to the input dataset. The values of the variables are defined by a period
reference dataset which has one observations per patient and subperiod,
period, or phase."><title>Add Subperiod, Period, or Phase Variables to ADSL — derive_vars_period • admiral</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add Subperiod, Period, or Phase Variables to ADSL — derive_vars_period"><meta property="og:description" content="The function adds subperiod, period, or phase variables like P01S1SDT,
P01S2SDT, AP01SDTM, AP02SDTM, TRT01A, TRT02A, PH1SDT, PH2SDT,
... to the input dataset. The values of the variables are defined by a period
reference dataset which has one observations per patient and subperiod,
period, or phase."><meta property="og:image" content="https://pharmaverse.github.io/admiral/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">admiral</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/admiral.html">Get Started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-user-guides">User Guides</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-user-guides">
    <a class="dropdown-item" href="../articles/admiral.html">Getting Started</a>
    <a class="dropdown-item" href="../articles/adsl.html">Creating a Basic ADSL</a>
    <a class="dropdown-item" href="../articles/faq.html">FAQ</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Deep Dives on ADaMs</h6>
    <a class="dropdown-item" href="../articles/occds.html">Creating an OCCDS ADaM</a>
    <a class="dropdown-item" href="../articles/bds_finding.html">Creating a BDS Findings ADAM</a>
    <a class="dropdown-item" href="../articles/bds_exposure.html">Creating a BDS Exposure ADaM</a>
    <a class="dropdown-item" href="../articles/bds_tte.html">Creating a BDS Time-to-Event ADaM</a>
    <a class="dropdown-item" href="../articles/questionnaires.html">Creating Questionnaire ADaMs</a>
    <a class="dropdown-item" href="../articles/pk_adnca.html">Creating a PK NCA or Population PK ADaM</a>
    <h6 class="dropdown-header" data-toc-skip>Advanced User Guides</h6>
    <a class="dropdown-item" href="../articles/imputation.html">Date and Time Imputation</a>
    <a class="dropdown-item" href="../articles/visits_periods.html">Visit and Period Variables</a>
    <a class="dropdown-item" href="../articles/generic.html">Generic Functions</a>
    <a class="dropdown-item" href="../articles/higher_order.html">Higher Order Functions</a>
    <a class="dropdown-item" href="../articles/queries_dataset.html">Queries Dataset Documentation</a>
    <a class="dropdown-item" href="../articles/lab_grading.html">Lab Grading</a>
    <a class="dropdown-item" href="../articles/hys_law.html">Hy's Law Implementation</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-community">Community</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-community">
    <a class="dropdown-item" href="../articles/contribution_model.html">Contribute to admiral</a>
    <a class="external-link dropdown-item" href="https://app.slack.com/client/T028PB489D3/C02M8KN8269">Find us on Slack</a>
    <a class="external-link dropdown-item" href="https://pharmaverse.org/">Welcome to the Pharmaverse</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add Subperiod, Period, or Phase Variables to ADSL</h1>
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiral/blob/main/R/period_dataset.R" class="external-link"><code>R/period_dataset.R</code></a></small>
      <div class="d-none name"><code>derive_vars_period.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function adds subperiod, period, or phase variables like <code>P01S1SDT</code>,
<code>P01S2SDT</code>, <code>AP01SDTM</code>, <code>AP02SDTM</code>, <code>TRT01A</code>, <code>TRT02A</code>, <code>PH1SDT</code>, <code>PH2SDT</code>,
... to the input dataset. The values of the variables are defined by a period
reference dataset which has one observations per patient and subperiod,
period, or phase.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">derive_vars_period</span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  <span class="va">dataset_ref</span>,</span>
<span>  <span class="va">new_vars</span>,</span>
<span>  subject_keys <span class="op">=</span> <span class="fu"><a href="get_admiral_option.html">get_admiral_option</a></span><span class="op">(</span><span class="st">"subject_keys"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dataset</dt>
<dd><p>ADSL dataset</p>
<p>The variables specified by <code>subject_keys</code> are expected.</p></dd>


<dt>dataset_ref</dt>
<dd><p>Period reference dataset</p>
<p>The variables specified by <code>new_vars</code> and <code>subject_keys</code> are expected.</p>
<p>If subperiod variables are requested, <code>APERIOD</code> and <code>ASPER</code> are expected.
If period variables are requested. <code>APERIOD</code> is expected. If phase
variables are requested, <code>APHASEN</code> is expected.</p></dd>


<dt>new_vars</dt>
<dd><p>New variables</p>
<p>A named list of variables like <code>exprs(PHwSDT = PHSDT, PHwEDT = PHEDT, APHASEw = APHASE)</code> is expected. The left hand side of the elements defines
a set of variables (in CDISC notation) to be added to the output dataset.
The right hand side defines the source variable from the period reference
dataset.</p>
<p>If the lower case letter "w"  is used it refers to a phase variable, if the
lower case letters "xx" are used it refers to a period variable, and if
both "xx" and "w" are used it refers to a subperiod variable.</p>
<p>Only one type must be used, e.g., all left hand side values must refer to
period variables. It is not allowed to mix for example period and subperiod
variables. If period <em>and</em> subperiod variables are required, separate calls
must be used.</p></dd>


<dt>subject_keys</dt>
<dd><p>Variables to uniquely identify a subject</p>
<p>A list of expressions where the expressions are symbols as returned by
<code><a href="reexport-exprs.html">exprs()</a></code> is expected.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>The input dataset with subperiod/period/phase variables added (see
"Details" section)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For each subperiod/period/phase in the period reference dataset and
each element in <code>new_vars</code> a variable (LHS value of <code>new_vars</code>) is added to
the output dataset and set to the value of the source variable (RHS value
of <code>new_vars</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="create_period_dataset.html">create_period_dataset()</a></code></p>
<p>ADSL Functions that returns variable appended to dataset: 
<code><a href="derive_var_age_years.html">derive_var_age_years</a>()</code>,
<code><a href="derive_var_dthcaus.html">derive_var_dthcaus</a>()</code>,
<code><a href="derive_var_extreme_dtm.html">derive_var_extreme_dtm</a>()</code>,
<code><a href="derive_var_extreme_dt.html">derive_var_extreme_dt</a>()</code>,
<code><a href="derive_vars_aage.html">derive_vars_aage</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>STUDYID <span class="op">=</span> <span class="st">"xyz"</span>, USUBJID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add period variables to ADSL</span></span></span>
<span class="r-in"><span><span class="va">period_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">APERIOD</span>, <span class="op">~</span><span class="va">APERSDT</span>,     <span class="op">~</span><span class="va">APEREDT</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,             <span class="fl">1</span>, <span class="st">"2021-01-04"</span>, <span class="st">"2021-02-06"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,             <span class="fl">2</span>, <span class="st">"2021-02-07"</span>, <span class="st">"2021-03-07"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,             <span class="fl">1</span>, <span class="st">"2021-02-02"</span>, <span class="st">"2021-03-02"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,             <span class="fl">2</span>, <span class="st">"2021-03-03"</span>, <span class="st">"2021-04-01"</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    STUDYID <span class="op">=</span> <span class="st">"xyz"</span>,</span></span>
<span class="r-in"><span>    APERIOD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">APERIOD</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"APER[ES]DT"</span><span class="op">)</span>, <span class="va">ymd</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">derive_vars_period</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">adsl</span>,</span></span>
<span class="r-in"><span>  dataset_ref <span class="op">=</span> <span class="va">period_ref</span>,</span></span>
<span class="r-in"><span>  new_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span>APxxSDT <span class="op">=</span> <span class="va">APERSDT</span>, APxxEDT <span class="op">=</span> <span class="va">APEREDT</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">AP01SDT</span>, <span class="va">AP01EDT</span>, <span class="va">AP02SDT</span>, <span class="va">AP02EDT</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   STUDYID USUBJID AP01SDT    AP01EDT    AP02SDT    AP02EDT   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> xyz     1       2021-01-04 2021-02-06 2021-02-07 2021-03-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> xyz     2       2021-02-02 2021-03-02 2021-03-03 2021-04-01</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add phase variables to ADSL</span></span></span>
<span class="r-in"><span><span class="va">phase_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">APHASEN</span>, <span class="op">~</span><span class="va">PHSDT</span>,       <span class="op">~</span><span class="va">PHEDT</span>,       <span class="op">~</span><span class="va">APHASE</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,             <span class="fl">1</span>, <span class="st">"2021-01-04"</span>, <span class="st">"2021-02-06"</span>, <span class="st">"TREATMENT"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,             <span class="fl">2</span>, <span class="st">"2021-02-07"</span>, <span class="st">"2021-03-07"</span>, <span class="st">"FUP"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,             <span class="fl">1</span>, <span class="st">"2021-02-02"</span>, <span class="st">"2021-03-02"</span>, <span class="st">"TREATMENT"</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    STUDYID <span class="op">=</span> <span class="st">"xyz"</span>,</span></span>
<span class="r-in"><span>    APHASEN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">APHASEN</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"PH[ES]DT"</span><span class="op">)</span>, <span class="va">ymd</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">derive_vars_period</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">adsl</span>,</span></span>
<span class="r-in"><span>  dataset_ref <span class="op">=</span> <span class="va">phase_ref</span>,</span></span>
<span class="r-in"><span>  new_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span>PHwSDT <span class="op">=</span> <span class="va">PHSDT</span>, PHwEDT <span class="op">=</span> <span class="va">PHEDT</span>, APHASEw <span class="op">=</span> <span class="va">APHASE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">PH1SDT</span>, <span class="va">PH1EDT</span>, <span class="va">PH2SDT</span>, <span class="va">PH2EDT</span>, <span class="va">APHASE1</span>, <span class="va">APHASE2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   STUDYID USUBJID PH1SDT     PH1EDT     PH2SDT     PH2EDT     APHASE1   APHASE2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> xyz     1       2021-01-04 2021-02-06 2021-02-07 2021-03-07 TREATMENT FUP    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> xyz     2       2021-02-02 2021-03-02 <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         TREATMENT <span style="color: #BB0000;">NA</span>     </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add subperiod variables to ADSL</span></span></span>
<span class="r-in"><span><span class="va">subperiod_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">APERIOD</span>, <span class="op">~</span><span class="va">ASPER</span>, <span class="op">~</span><span class="va">ASPRSDT</span>,     <span class="op">~</span><span class="va">ASPREDT</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,             <span class="fl">1</span>,      <span class="fl">1</span>, <span class="st">"2021-01-04"</span>, <span class="st">"2021-01-19"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,             <span class="fl">1</span>,      <span class="fl">2</span>, <span class="st">"2021-01-20"</span>, <span class="st">"2021-02-06"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,             <span class="fl">2</span>,      <span class="fl">1</span>, <span class="st">"2021-02-07"</span>, <span class="st">"2021-03-07"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,             <span class="fl">1</span>,      <span class="fl">1</span>, <span class="st">"2021-02-02"</span>, <span class="st">"2021-03-02"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,             <span class="fl">2</span>,      <span class="fl">1</span>, <span class="st">"2021-03-03"</span>, <span class="st">"2021-04-01"</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    STUDYID <span class="op">=</span> <span class="st">"xyz"</span>,</span></span>
<span class="r-in"><span>    APERIOD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">APERIOD</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    ASPER <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">ASPER</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"ASPR[ES]DT"</span><span class="op">)</span>, <span class="va">ymd</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">derive_vars_period</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">adsl</span>,</span></span>
<span class="r-in"><span>  dataset_ref <span class="op">=</span> <span class="va">subperiod_ref</span>,</span></span>
<span class="r-in"><span>  new_vars <span class="op">=</span> <span class="fu"><a href="reexport-exprs.html">exprs</a></span><span class="op">(</span>PxxSwSDT <span class="op">=</span> <span class="va">ASPRSDT</span>, PxxSwEDT <span class="op">=</span> <span class="va">ASPREDT</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">P01S1SDT</span>, <span class="va">P01S1EDT</span>, <span class="va">P01S2SDT</span>, <span class="va">P01S2EDT</span>, <span class="va">P02S1SDT</span>, <span class="va">P02S1EDT</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   STUDYID USUBJID P01S1SDT   P01S1EDT   P01S2SDT   P01S2EDT   P02S1SDT  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> xyz     1       2021-01-04 2021-01-19 2021-01-20 2021-02-06 2021-02-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> xyz     2       2021-02-02 2021-03-02 <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         2021-03-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 1 more variable: P02S1EDT &lt;date&gt;</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ben Straub, Stefan Bundfuss, Jeffrey Dickinson, Ross Farrugia, Adam Forys, Daphne Grasselly, Dinakar Kulkarni, Edoardo Mancini, Sadchla Mascary, Gordon Miller, Sophie Shapcott, Eric Simms, Stefan Thoma, Kangjie Zhang, Zelos Zhu, G Gayatri, Thomas Neitmann, F. Hoffmann-La Roche AG, GlaxoSmithKline LLC.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

