<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Derive treatment emergent analysis flag (e.g., TRTEMFL)."><title>Derive Treatment-emergent Flag — derive_var_trtemfl • admiral</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Derive Treatment-emergent Flag — derive_var_trtemfl"><meta property="og:description" content="Derive treatment emergent analysis flag (e.g., TRTEMFL)."><meta property="og:image" content="https://pharmaverse.github.io/admiral/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">admiral</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/admiral.html">Get Started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-user-guides">User Guides</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-user-guides">
    <a class="dropdown-item" href="../articles/admiral.html">Getting Started</a>
    <a class="dropdown-item" href="../articles/adsl.html">Creating a Basic ADSL</a>
    <a class="dropdown-item" href="../articles/faq.html">FAQ</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Deep Dives on ADaMs</h6>
    <a class="dropdown-item" href="../articles/occds.html">Creating an OCCDS ADaM</a>
    <a class="dropdown-item" href="../articles/bds_finding.html">Creating a BDS Findings ADAM</a>
    <a class="dropdown-item" href="../articles/bds_exposure.html">Creating a BDS Exposure ADaM</a>
    <a class="dropdown-item" href="../articles/bds_tte.html">Creating a BDS Time-to-Event ADaM</a>
    <a class="dropdown-item" href="../articles/questionnaires.html">Creating Questionnaire ADaMs</a>
    <a class="dropdown-item" href="../articles/pk_adnca.html">Creating a PK NCA or Population PK ADaM</a>
    <h6 class="dropdown-header" data-toc-skip>Advanced User Guides</h6>
    <a class="dropdown-item" href="../articles/imputation.html">Date and Time Imputation</a>
    <a class="dropdown-item" href="../articles/visits_periods.html">Visit and Period Variables</a>
    <a class="dropdown-item" href="../articles/generic.html">Generic Functions</a>
    <a class="dropdown-item" href="../articles/higher_order.html">Higher Order Functions</a>
    <a class="dropdown-item" href="../articles/queries_dataset.html">Queries Dataset Documentation</a>
    <a class="dropdown-item" href="../articles/lab_grading.html">Lab Grading</a>
    <a class="dropdown-item" href="../articles/hys_law.html">Hy's Law Implementation</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-community">Community</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-community">
    <a class="dropdown-item" href="../articles/contribution_model.html">Contribute to admiral</a>
    <a class="external-link dropdown-item" href="https://app.slack.com/client/T028PB489D3/C02M8KN8269">Find us on Slack</a>
    <a class="external-link dropdown-item" href="https://pharmaverse.org/">Welcome to the Pharmaverse</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Derive Treatment-emergent Flag</h1>
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiral/blob/main/R/derive_var_trtemfl.R" class="external-link"><code>R/derive_var_trtemfl.R</code></a></small>
      <div class="d-none name"><code>derive_var_trtemfl.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Derive treatment emergent analysis flag (e.g., <code>TRTEMFL</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">derive_var_trtemfl</span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">TRTEMFL</span>,</span>
<span>  start_date <span class="op">=</span> <span class="va">ASTDTM</span>,</span>
<span>  end_date <span class="op">=</span> <span class="va">AENDTM</span>,</span>
<span>  trt_start_date <span class="op">=</span> <span class="va">TRTSDTM</span>,</span>
<span>  trt_end_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  end_window <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ignore_time_for_trt_end <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  initial_intensity <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  intensity <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dataset</dt>
<dd><p>Input dataset</p>
<p>The variables specified by <code>start_date</code>, <code>end_date</code>, <code>trt_start_date</code>,
<code>trt_end_date</code>, <code>initial_intensity</code>, and <code>intensity</code> are expected.</p></dd>


<dt>new_var</dt>
<dd><p>New variable</p></dd>


<dt>start_date</dt>
<dd><p>Event start date</p>
<p><em>Permitted Values:</em> A symbol referring to a date or datetime variable of
the input dataset</p></dd>


<dt>end_date</dt>
<dd><p>Event end date</p>
<p><em>Permitted Values:</em> A symbol referring to a date or datetime variable of
the input dataset</p></dd>


<dt>trt_start_date</dt>
<dd><p>Treatment start date</p>
<p><em>Permitted Values:</em> A symbol referring to a date or datetime variable of
the input dataset</p></dd>


<dt>trt_end_date</dt>
<dd><p>Treatment end date</p>
<p><em>Permitted Values:</em> A symbol referring to a date or datetime variable of
the input dataset or <code>NULL</code></p></dd>


<dt>end_window</dt>
<dd><p>If the argument is specified, events starting more than the specified
number of days after end of treatment, are not flagged.</p>
<p><em>Permitted Values:</em> A non-negative integer or <code>NULL</code></p></dd>


<dt>ignore_time_for_trt_end</dt>
<dd><p>If the argument is set to <code>TRUE</code>, the time part is ignored for checking if
the event occurred more than <code>end_window</code> days after end of treatment.</p>
<p><em>Permitted Values:</em> <code>TRUE</code>, <code>FALSE</code></p></dd>


<dt>initial_intensity</dt>
<dd><p>Initial severity/intensity or toxicity</p>
<p>This derivation assumes AE data collection method as single record per AE
with “initial” and “most extreme” severity/intensity recorded separately.</p>
<p>If the argument is specified, events which start before treatment start and
end after treatment start (or are ongoing) and worsened (i.e., the
intensity is greater than the initial intensity), are flagged.</p>
<p>The values of the specified variable must be comparable with the usual
comparison operators. I.e., if the intensity is greater than the initial
intensity <code>initial_intensity &lt; intensity</code> must evaluate to <code>TRUE</code>.</p>
<p><em>Permitted Values:</em> A symbol referring to a variable of the input dataset
or <code>NULL</code></p></dd>


<dt>intensity</dt>
<dd><p>Severity/intensity or toxicity</p>
<p>If the argument is specified, events which start before treatment start and
end after treatment start (or are ongoing) and worsened (i.e., the
intensity is greater than the initial intensity), are flagged.</p>
<p>The values of the specified variable must be comparable with the usual
comparison operators. I.e., if the intensity is greater than the initial
intensity <code>initial_intensity &lt; intensity</code> must evaluate to <code>TRUE</code>.</p>
<p><em>Permitted Values:</em> A symbol referring to a variable of the input dataset
or <code>NULL</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>The input dataset with the variable specified by <code>new_var</code> added</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For the derivation of the new variable the following cases are
considered in this order. The first case which applies, defines the value
of the variable.</p><ul><li><p><em>not treated</em>: If <code>trt_start_date</code> is <code>NA</code>, it is set to <code>NA_character_</code>.</p></li>
<li><p><em>event before treatment</em>: If <code>end_date</code> is before <code>trt_start_date</code> (and
<code>end_date</code> is not <code>NA</code>), it is set to <code>NA_character_</code>.</p></li>
<li><p><em>no event date</em>: If <code>start_date</code> is <code>NA</code>, it is set to <code>"Y"</code> as in such
cases it is usually considered more conservative to assume the event was
treatment-emergent.</p></li>
<li><p><em>event started during treatment</em>:</p><ul><li><p>if <code>end_window</code> is not specified:
if <code>start_date</code> is on or after <code>trt_start_date</code>, it is set to <code>"Y"</code>,</p></li>
<li><p>if <code>end_window</code> is specified:
if <code>start_date</code> is on or after <code>trt_start_date</code> and <code>start_date</code> is on
or before <code>trt_end_date</code> + <code>end_window</code> days, it is set to <code>"Y"</code>,</p></li>
</ul></li>
<li><p><em>event started before treatment and (possibly) worsened on treatment</em>:</p><ul><li><p>if <code>initial_intensity</code> and <code>intensity</code> is specified: if
<code>initial_intensity &lt; intensity</code> and <code>start_date</code> is before
<code>trt_start_date</code> and <code>end_date</code> is on or after <code>trt_start_date</code> or
<code>end_date</code> is <code>NA</code>, it is set to <code>"Y"</code>.</p></li>
</ul></li>
<li><p>Otherwise it is set to <code>NA_character_</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>OCCDS Functions: 
<code><a href="derive_vars_atc.html">derive_vars_atc</a>()</code>,
<code><a href="derive_vars_query.html">derive_vars_query</a>()</code>,
<code><a href="get_terms_from_db.html">get_terms_from_db</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">adae</span> <span class="op">&lt;-</span> <span class="va">expected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ASTDTM</span>,            <span class="op">~</span><span class="va">AENDTM</span>,            <span class="op">~</span><span class="va">AEITOXGR</span>, <span class="op">~</span><span class="va">AETOXGR</span>,</span></span>
<span class="r-in"><span>  <span class="co"># before treatment</span></span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">"2021-12-13T20:15"</span>, <span class="st">"2021-12-15T12:45"</span>, <span class="st">"1"</span>,       <span class="st">"1"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">"2021-12-14T20:15"</span>, <span class="st">"2021-12-14T22:00"</span>, <span class="st">"1"</span>,       <span class="st">"3"</span>,</span></span>
<span class="r-in"><span>  <span class="co"># starting before treatment and ending during treatment</span></span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">"2021-12-30T20:00"</span>, <span class="st">"2022-01-14T11:00"</span>, <span class="st">"1"</span>,       <span class="st">"3"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">"2021-12-31T20:15"</span>, <span class="st">"2022-01-01T01:23"</span>, <span class="st">"1"</span>,       <span class="st">"1"</span>,</span></span>
<span class="r-in"><span>  <span class="co"># starting during treatment</span></span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">"2022-01-01T12:00"</span>, <span class="st">"2022-01-02T23:25"</span>, <span class="st">"3"</span>,       <span class="st">"4"</span>,</span></span>
<span class="r-in"><span>  <span class="co"># after treatment</span></span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">"2022-05-10T11:00"</span>, <span class="st">"2022-05-10T13:05"</span>, <span class="st">"2"</span>,       <span class="st">"2"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">"2022-05-11T11:00"</span>, <span class="st">"2022-05-11T13:05"</span>, <span class="st">"2"</span>,       <span class="st">"2"</span>,</span></span>
<span class="r-in"><span>  <span class="co"># missing dates</span></span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">""</span>,                 <span class="st">""</span>,                 <span class="st">"3"</span>,       <span class="st">"4"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">"2021-12-30T09:00"</span>, <span class="st">""</span>,                 <span class="st">"3"</span>,       <span class="st">"4"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">"2021-12-30T11:00"</span>, <span class="st">""</span>,                 <span class="st">"3"</span>,       <span class="st">"3"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">""</span>,                 <span class="st">"2022-01-04T09:00"</span>, <span class="st">"3"</span>,       <span class="st">"4"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">""</span>,                 <span class="st">"2021-12-24T19:00"</span>, <span class="st">"3"</span>,       <span class="st">"4"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"1"</span>,      <span class="st">""</span>,                 <span class="st">"2022-06-04T09:00"</span>, <span class="st">"3"</span>,       <span class="st">"4"</span>,</span></span>
<span class="r-in"><span>  <span class="co"># without treatment</span></span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="st">""</span>,                 <span class="st">"2021-12-03T12:00"</span>, <span class="st">"1"</span>,       <span class="st">"2"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="st">"2021-12-01T12:00"</span>, <span class="st">"2021-12-03T12:00"</span>, <span class="st">"1"</span>,       <span class="st">"2"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"2"</span>,      <span class="st">"2021-12-06T18:00"</span>, <span class="st">""</span>,                 <span class="st">"1"</span>,       <span class="st">"2"</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    ASTDTM <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hm</a></span><span class="op">(</span><span class="va">ASTDTM</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    AENDTM <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hm</a></span><span class="op">(</span><span class="va">AENDTM</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    TRTSDTM <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">USUBJID</span> <span class="op">==</span> <span class="st">"1"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hm</a></span><span class="op">(</span><span class="st">"2022-01-01T01:01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    TRTEDTM <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">USUBJID</span> <span class="op">==</span> <span class="st">"1"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hm</a></span><span class="op">(</span><span class="st">"2022-04-30T23:59"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hms</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># derive TRTEMFL without considering treatment end and worsening</span></span></span>
<span class="r-in"><span><span class="fu">derive_var_trtemfl</span><span class="op">(</span><span class="va">adae</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ASTDTM</span>, <span class="va">AENDTM</span>, <span class="va">TRTSDTM</span>, <span class="va">TRTEMFL</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 16 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ASTDTM              AENDTM              TRTSDTM             TRTEMFL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 2021-12-13 <span style="color: #949494;">20:15:00</span> 2021-12-15 <span style="color: #949494;">12:45:00</span> 2022-01-01 <span style="color: #949494;">01:01:00</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 2021-12-14 <span style="color: #949494;">20:15:00</span> 2021-12-14 <span style="color: #949494;">22:00:00</span> 2022-01-01 <span style="color: #949494;">01:01:00</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 2021-12-30 <span style="color: #949494;">20:00:00</span> 2022-01-14 <span style="color: #949494;">11:00:00</span> 2022-01-01 <span style="color: #949494;">01:01:00</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 2021-12-31 <span style="color: #949494;">20:15:00</span> 2022-01-01 <span style="color: #949494;">01:23:00</span> 2022-01-01 <span style="color: #949494;">01:01:00</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 2022-01-01 <span style="color: #949494;">12:00:00</span> 2022-01-02 <span style="color: #949494;">23:25:00</span> 2022-01-01 <span style="color: #949494;">01:01:00</span> Y      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 2022-05-10 <span style="color: #949494;">11:00:00</span> 2022-05-10 <span style="color: #949494;">13:05:00</span> 2022-01-01 <span style="color: #949494;">01:01:00</span> Y      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 2022-05-11 <span style="color: #949494;">11:00:00</span> 2022-05-11 <span style="color: #949494;">13:05:00</span> 2022-01-01 <span style="color: #949494;">01:01:00</span> Y      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                  2022-01-01 <span style="color: #949494;">01:01:00</span> Y      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 2021-12-30 <span style="color: #949494;">09:00:00</span> <span style="color: #BB0000;">NA</span>                  2022-01-01 <span style="color: #949494;">01:01:00</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 2021-12-30 <span style="color: #949494;">11:00:00</span> <span style="color: #BB0000;">NA</span>                  2022-01-01 <span style="color: #949494;">01:01:00</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span> <span style="color: #BB0000;">NA</span>                  2022-01-04 <span style="color: #949494;">09:00:00</span> 2022-01-01 <span style="color: #949494;">01:01:00</span> Y      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span> <span style="color: #BB0000;">NA</span>                  2021-12-24 <span style="color: #949494;">19:00:00</span> 2022-01-01 <span style="color: #949494;">01:01:00</span> <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">13</span> <span style="color: #BB0000;">NA</span>                  2022-06-04 <span style="color: #949494;">09:00:00</span> 2022-01-01 <span style="color: #949494;">01:01:00</span> Y      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">14</span> <span style="color: #BB0000;">NA</span>                  2021-12-03 <span style="color: #949494;">12:00:00</span> <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">15</span> 2021-12-01 <span style="color: #949494;">12:00:00</span> 2021-12-03 <span style="color: #949494;">12:00:00</span> <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">16</span> 2021-12-06 <span style="color: #949494;">18:00:00</span> <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>     </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># derive TRTEM2FL taking treatment end and worsening into account</span></span></span>
<span class="r-in"><span><span class="fu">derive_var_trtemfl</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">adae</span>,</span></span>
<span class="r-in"><span>  new_var <span class="op">=</span> <span class="va">TRTEM2FL</span>,</span></span>
<span class="r-in"><span>  trt_end_date <span class="op">=</span> <span class="va">TRTEDTM</span>,</span></span>
<span class="r-in"><span>  end_window <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>  initial_intensity <span class="op">=</span> <span class="va">AEITOXGR</span>,</span></span>
<span class="r-in"><span>  intensity <span class="op">=</span> <span class="va">AETOXGR</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ASTDTM</span>, <span class="va">AENDTM</span>, <span class="va">AEITOXGR</span>, <span class="va">AETOXGR</span>, <span class="va">TRTEM2FL</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 16 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ASTDTM              AENDTM              AEITOXGR AETOXGR TRTEM2FL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 2021-12-13 <span style="color: #949494;">20:15:00</span> 2021-12-15 <span style="color: #949494;">12:45:00</span> 1        1       <span style="color: #BB0000;">NA</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 2021-12-14 <span style="color: #949494;">20:15:00</span> 2021-12-14 <span style="color: #949494;">22:00:00</span> 1        3       <span style="color: #BB0000;">NA</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 2021-12-30 <span style="color: #949494;">20:00:00</span> 2022-01-14 <span style="color: #949494;">11:00:00</span> 1        3       Y       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 2021-12-31 <span style="color: #949494;">20:15:00</span> 2022-01-01 <span style="color: #949494;">01:23:00</span> 1        1       <span style="color: #BB0000;">NA</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 2022-01-01 <span style="color: #949494;">12:00:00</span> 2022-01-02 <span style="color: #949494;">23:25:00</span> 3        4       Y       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 2022-05-10 <span style="color: #949494;">11:00:00</span> 2022-05-10 <span style="color: #949494;">13:05:00</span> 2        2       Y       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 2022-05-11 <span style="color: #949494;">11:00:00</span> 2022-05-11 <span style="color: #949494;">13:05:00</span> 2        2       <span style="color: #BB0000;">NA</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                  3        4       Y       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 2021-12-30 <span style="color: #949494;">09:00:00</span> <span style="color: #BB0000;">NA</span>                  3        4       Y       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 2021-12-30 <span style="color: #949494;">11:00:00</span> <span style="color: #BB0000;">NA</span>                  3        3       <span style="color: #BB0000;">NA</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span> <span style="color: #BB0000;">NA</span>                  2022-01-04 <span style="color: #949494;">09:00:00</span> 3        4       Y       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span> <span style="color: #BB0000;">NA</span>                  2021-12-24 <span style="color: #949494;">19:00:00</span> 3        4       <span style="color: #BB0000;">NA</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">13</span> <span style="color: #BB0000;">NA</span>                  2022-06-04 <span style="color: #949494;">09:00:00</span> 3        4       Y       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">14</span> <span style="color: #BB0000;">NA</span>                  2021-12-03 <span style="color: #949494;">12:00:00</span> 1        2       <span style="color: #BB0000;">NA</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">15</span> 2021-12-01 <span style="color: #949494;">12:00:00</span> 2021-12-03 <span style="color: #949494;">12:00:00</span> 1        2       <span style="color: #BB0000;">NA</span>      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">16</span> 2021-12-06 <span style="color: #949494;">18:00:00</span> <span style="color: #BB0000;">NA</span>                  1        2       <span style="color: #BB0000;">NA</span>      </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ben Straub, Stefan Bundfuss, Jeffrey Dickinson, Ross Farrugia, Adam Forys, Daphne Grasselly, Dinakar Kulkarni, Edoardo Mancini, Sadchla Mascary, Gordon Miller, Sophie Shapcott, Eric Simms, Stefan Thoma, Kangjie Zhang, Zelos Zhu, G Gayatri, Thomas Neitmann, F. Hoffmann-La Roche AG, GlaxoSmithKline LLC.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

