<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Derive on-treatment flag (ONTRTFL) in an ADaM dataset with a single
assessment date (e.g ADT) or event start and end dates (e.g.
ASTDT/AENDT)."><title>Derive On-Treatment Flag Variable — derive_var_ontrtfl • admiral</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Derive On-Treatment Flag Variable — derive_var_ontrtfl"><meta property="og:description" content="Derive on-treatment flag (ONTRTFL) in an ADaM dataset with a single
assessment date (e.g ADT) or event start and end dates (e.g.
ASTDT/AENDT)."><meta property="og:image" content="https://pharmaverse.github.io/admiral/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-574L344W3R"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '{YOUR TRACKING ID}');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">admiral</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/admiral.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>User Guides</h6>
    <a class="dropdown-item" href="../articles/adsl.html">Creating ADSL</a>
    <a class="dropdown-item" href="../articles/occds.html">Creating an OCCDS ADaM</a>
    <a class="dropdown-item" href="../articles/bds_finding.html">Creating a BDS Finding ADaM</a>
    <a class="dropdown-item" href="../articles/bds_exposure.html">Creating a BDS Exposure ADaM</a>
    <a class="dropdown-item" href="../articles/bds_tte.html">Creating a BDS Time-to-Event ADaM</a>
    <a class="dropdown-item" href="../articles/imputation.html">Date and Time Imputation</a>
    <a class="dropdown-item" href="../articles/queries_dataset.html">Queries Dataset Documentation</a>
    <a class="dropdown-item" href="../articles/faq.html">FAQ</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Developer Guides</h6>
    <a class="dropdown-item" href="../articles/contribution_model.html">Contribution to {admiral}</a>
    <a class="dropdown-item" href="../articles/development_process.html">Development Process</a>
    <a class="dropdown-item" href="../articles/programming_strategy.html">Programming Strategy</a>
    <a class="dropdown-item" href="../articles/git_usage.html">Guidance for git and GitHub Usage</a>
    <a class="dropdown-item" href="../articles/writing_vignettes.html">Writing Vignettes</a>
    <a class="dropdown-item" href="../articles/pr_review_guidance.html">Pull Request Review Guidance</a>
    <a class="dropdown-item" href="../articles/unit_test_guidance.html">Unit Test Guidance</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Derive On-Treatment Flag Variable</h1>
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiral/blob/main/R/derive_var_ontrtfl.R" class="external-link"><code>R/derive_var_ontrtfl.R</code></a></small>
      <div class="d-none name"><code>derive_var_ontrtfl.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Derive on-treatment flag (<code>ONTRTFL</code>) in an ADaM dataset with a single
assessment date (e.g <code>ADT</code>) or event start and end dates (e.g.
<code>ASTDT</code>/<code>AENDT</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">derive_var_ontrtfl</span><span class="op">(</span>
  <span class="va">dataset</span>,
  new_var <span class="op">=</span> <span class="va">ONTRTFL</span>,
  <span class="va">start_date</span>,
  end_date <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">ref_start_date</span>,
  ref_end_date <span class="op">=</span> <span class="cn">NULL</span>,
  ref_end_window <span class="op">=</span> <span class="fl">0</span>,
  filter_pre_timepoint <span class="op">=</span> <span class="cn">NULL</span>,
  span_period <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>dataset</dt>
<dd><p>Input dataset.</p>
<p>Required columns are <code>start_date</code>, <code>end_date</code>, <code>ref_start_date</code> and
<code>ref_end_date</code>.</p></dd>
<dt>new_var</dt>
<dd><p>On-treatment flag variable name to be created.</p>
<p>Default is <code>ONTRTFL</code>.</p></dd>
<dt>start_date</dt>
<dd><p>The start date (e.g. <code>AESDT</code>) or assessment date (e.g.
<code>ADT</code>) Required; A date or date-time object column is expected.</p>
<p>Refer to <code><a href="derive_vars_dt.html">derive_vars_dt()</a></code> to impute and derive a date from a date
character vector to a date object.</p></dd>
<dt>end_date</dt>
<dd><p>The end date of assessment/event (e.g. <code>AENDT</code>) A date or
date-time object column is expected.</p>
<p>Refer to <code><a href="derive_vars_dt.html">derive_vars_dt()</a></code> to impute and derive a date from a date
character vector to a date object.</p>
<p>Optional; Default is null. If the used and date value is missing on an
observation, it is assumed the medication is ongoing and <code>ONTRTFL</code> is set
to <code>"Y"</code>.</p></dd>
<dt>ref_start_date</dt>
<dd><p>The lower bound of the on-treatment period Required; A
date or date-time object column is expected.</p>
<p>Refer to <code><a href="derive_vars_dt.html">derive_vars_dt()</a></code> to impute and derive a date from a date
character vector to a date object.</p></dd>
<dt>ref_end_date</dt>
<dd><p>The upper bound of the on-treatment period A date or
date-time object column is expected.</p>
<p>Refer to <code><a href="derive_vars_dt.html">derive_vars_dt()</a></code> to impute and derive a date from a date
character vector to a date object.</p>
<p>Optional; This can be null and everything after <code>ref_start_date</code> will be
considered on-treatment. Default is <code>NULL</code>.</p></dd>
<dt>ref_end_window</dt>
<dd><p>A window to add to the upper bound <code>ref_end_date</code>
measured in days (e.g. 7 if 7 days should be added to the upper bound)
Optional; default is 0.</p></dd>
<dt>filter_pre_timepoint</dt>
<dd><p>An expression to filter observations as not
on-treatment when <code>date</code> = <code>ref_start_date</code>. For example, if observations
where <code>VSTPT = PRE</code> should not be considered on-treatment when <code>date = ref_start_date</code>, <code>filter_pre_timepoint</code> should be used to denote when the
on-treatment flag should be set to null. Optional; default is <code>NULL</code>.</p></dd>
<dt>span_period</dt>
<dd><p>A <code>"Y"</code> scalar character. If <code>"Y"</code>, events that started
prior to the <code>ref_start_date</code>and are ongoing or end after the
<code>ref_start_date</code> are flagged as <code>"Y"</code>. Optional; default is <code>NULL</code>.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The input dataset with an additional column named <code>ONTRTFL</code> with a
value of <code>"Y"</code> or <code>NA</code></p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>On-Treatment is calculated by determining whether the assessment
date or start/stop dates fall between 2 dates. The following logic is used
to assign on-treatment = <code>"Y"</code>:</p><ol><li><p><code>start_date</code> is missing and <code>ref_start_date</code>is non-missing</p></li>
<li><p>No timepoint filter is provided (<code>filter_pre_timepoint</code>) and both
<code>start_date</code> and <code>ref_start_date</code> are non-missing and <code>start_date</code> =
<code>ref_start_date</code></p></li>
<li><p>A timepoint is provided (<code>filter_pre_timepoint</code>) and both <code>start_date</code>
and <code>ref_start_date</code> are non-missing and <code>start_date = ref_start_date</code> and
the filter provided in <code>filter_pre_timepoint</code> is not true.</p></li>
<li><p><code>ref_end_date</code> is not provided and <code>ref_start_date &lt; start_date</code></p></li>
<li><p><code>ref_end_date</code> is provided and <code>ref_start_date &lt; start_date</code> &lt;=
<code>ref_end_date + ref_end_window</code>.</p></li>
</ol><p>If the <code>end_date</code> is provided and the <code>end_date</code> &lt; ref_start_date then the
<code>ONTRTFL</code> is set to <code>NULL</code>.This would be applicable to cases where the
<code>start_date</code> is missing and <code>ONTRTFL</code> has been assigned as <code>"Y"</code> above.</p>
<p>If the <code>span_period</code> is specified as <code>"Y"</code>, this allows the user to assign
<code>ONTRTFL</code> as <code>"Y"</code> to cases where the record started prior to the
<code>ref_start_date</code> and was ongoing or ended after the <code>ref_start_date</code>.</p>
<p>Any date imputations needed should be done prior to calling this function.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Alice Ehmann, Teckla Akinyi</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://lubridate.tidyverse.org" class="external-link">lubridate</a></span>, warn.conflict <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ADT</span>,              <span class="op">~</span><span class="va">TRTSDT</span>,           <span class="op">~</span><span class="va">TRTEDT</span>,</span>
<span class="r-in">  <span class="st">"P01"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-02-24"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="st">"P02"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="st">"P03"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2019-12-31"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="fu">derive_var_ontrtfl</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">advs</span>,</span>
<span class="r-in">  start_date <span class="op">=</span> <span class="va">ADT</span>,</span>
<span class="r-in">  ref_start_date <span class="op">=</span> <span class="va">TRTSDT</span>,</span>
<span class="r-in">  ref_end_date <span class="op">=</span> <span class="va">TRTEDT</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;"># A tibble: 3 x 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID ADT        TRTSDT     TRTEDT     ONTRTFL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">1</span><span> P01     2020-02-24 2020-01-01 2020-03-01 Y      </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">2</span><span> P02     2020-01-01 2020-01-01 2020-03-01 Y      </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">3</span><span> P03     2019-12-31 2020-01-01 2020-03-01 </span><span style="color: #BB0000;">NA</span><span>     </span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ADT</span>,              <span class="op">~</span><span class="va">TRTSDT</span>,           <span class="op">~</span><span class="va">TRTEDT</span>,</span>
<span class="r-in">  <span class="st">"P01"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-07-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="st">"P02"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-04-30"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="st">"P03"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-15"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="fu">derive_var_ontrtfl</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">advs</span>,</span>
<span class="r-in">  start_date <span class="op">=</span> <span class="va">ADT</span>,</span>
<span class="r-in">  ref_start_date <span class="op">=</span> <span class="va">TRTSDT</span>,</span>
<span class="r-in">  ref_end_date <span class="op">=</span> <span class="va">TRTEDT</span>,</span>
<span class="r-in">  ref_end_window <span class="op">=</span> <span class="fl">60</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;"># A tibble: 3 x 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID ADT        TRTSDT     TRTEDT     ONTRTFL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">1</span><span> P01     2020-07-01 2020-01-01 2020-03-01 </span><span style="color: #BB0000;">NA</span><span>     </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">2</span><span> P02     2020-04-30 2020-01-01 2020-03-01 Y      </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">3</span><span> P03     2020-03-15 2020-01-01 2020-03-01 Y      </span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ADTM</span>,                      <span class="op">~</span><span class="va">TRTSDTM</span>,                   <span class="op">~</span><span class="va">TRTEDTM</span>,</span>
<span class="r-in">  <span class="st">"P01"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hm</a></span><span class="op">(</span><span class="st">"2020-01-02T12:00"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hm</a></span><span class="op">(</span><span class="st">"2020-01-01T12:00"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hm</a></span><span class="op">(</span><span class="st">"2020-03-01T12:00"</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="st">"P02"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>,          <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hm</a></span><span class="op">(</span><span class="st">"2020-01-01T12:00"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hm</a></span><span class="op">(</span><span class="st">"2020-03-01T12:00"</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="st">"P03"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2019-12-31"</span><span class="op">)</span>,          <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hm</a></span><span class="op">(</span><span class="st">"2020-01-01T12:00"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html" class="external-link">ymd_hm</a></span><span class="op">(</span><span class="st">"2020-03-01T12:00"</span><span class="op">)</span>,</span>
<span class="r-in"><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TPT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"PRE"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">derive_var_ontrtfl</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">advs</span>,</span>
<span class="r-in">  start_date <span class="op">=</span> <span class="va">ADTM</span>,</span>
<span class="r-in">  ref_start_date <span class="op">=</span> <span class="va">TRTSDTM</span>,</span>
<span class="r-in">  ref_end_date <span class="op">=</span> <span class="va">TRTEDTM</span>,</span>
<span class="r-in">  filter_pre_timepoint <span class="op">=</span> <span class="va">TPT</span> <span class="op">==</span> <span class="st">"PRE"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;"># A tibble: 3 x 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID ADTM                TRTSDTM             TRTEDTM             TPT  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>              </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>              </span><span style="color: #555555;font-style: italic;">&lt;dttm&gt;</span><span>              </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">1</span><span> P01     2020-01-02 </span><span style="color: #555555;">12:00:00</span><span> 2020-01-01 </span><span style="color: #555555;">12:00:00</span><span> 2020-03-01 </span><span style="color: #555555;">12:00:00</span><span> </span><span style="color: #BB0000;">NA</span><span>   </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">2</span><span> P02     2020-01-01 </span><span style="color: #555555;">00:00:00</span><span> 2020-01-01 </span><span style="color: #555555;">12:00:00</span><span> 2020-03-01 </span><span style="color: #555555;">12:00:00</span><span> PRE  </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">3</span><span> P03     2019-12-31 </span><span style="color: #555555;">00:00:00</span><span> 2020-01-01 </span><span style="color: #555555;">12:00:00</span><span> 2020-03-01 </span><span style="color: #555555;">12:00:00</span><span> </span><span style="color: #BB0000;">NA</span><span>   </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;"># … with 1 more variable: ONTRTFL </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ASTDT</span>,            <span class="op">~</span><span class="va">TRTSDT</span>,           <span class="op">~</span><span class="va">TRTEDT</span>,           <span class="op">~</span><span class="va">AENDT</span>,</span>
<span class="r-in">  <span class="st">"P01"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-15"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-12-01"</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="st">"P02"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2019-04-30"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-15"</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="st">"P03"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2019-04-30"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>, <span class="cn">NA</span>,</span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="fu">derive_var_ontrtfl</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">advs</span>,</span>
<span class="r-in">  start_date <span class="op">=</span> <span class="va">ASTDT</span>,</span>
<span class="r-in">  end_date <span class="op">=</span> <span class="va">AENDT</span>,</span>
<span class="r-in">  ref_start_date <span class="op">=</span> <span class="va">TRTSDT</span>,</span>
<span class="r-in">  ref_end_date <span class="op">=</span> <span class="va">TRTEDT</span>,</span>
<span class="r-in">  ref_end_window <span class="op">=</span> <span class="fl">60</span>,</span>
<span class="r-in">  span_period <span class="op">=</span> <span class="st">"Y"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;"># A tibble: 3 x 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID ASTDT      TRTSDT     TRTEDT     AENDT      ONTRTFL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>  </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">1</span><span> P01     2020-03-15 2020-01-01 2020-03-01 2020-12-01 Y      </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">2</span><span> P02     2019-04-30 2020-01-01 2020-03-01 2020-03-15 Y      </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">3</span><span> P03     2019-04-30 2020-01-01 2020-03-01 </span><span style="color: #BB0000;">NA</span><span>         Y      </span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span class="r-in">  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ASTDT</span>,            <span class="op">~</span><span class="va">AP01SDT</span>,          <span class="op">~</span><span class="va">AP01EDT</span>,          <span class="op">~</span><span class="va">AENDT</span>,</span>
<span class="r-in">  <span class="st">"P01"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-15"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-12-01"</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="st">"P02"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2019-04-30"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-15"</span><span class="op">)</span>,</span>
<span class="r-in">  <span class="st">"P03"</span>,    <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2019-04-30"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>, <span class="cn">NA</span>,</span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="fu">derive_var_ontrtfl</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">advs</span>,</span>
<span class="r-in">  new_var <span class="op">=</span> <span class="va">ONTR01FL</span>,</span>
<span class="r-in">  start_date <span class="op">=</span> <span class="va">ASTDT</span>,</span>
<span class="r-in">  end_date <span class="op">=</span> <span class="va">AENDT</span>,</span>
<span class="r-in">  ref_start_date <span class="op">=</span> <span class="va">AP01SDT</span>,</span>
<span class="r-in">  ref_end_date <span class="op">=</span> <span class="va">AP01EDT</span>,</span>
<span class="r-in">  span_period <span class="op">=</span> <span class="st">"Y"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;"># A tibble: 3 x 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   USUBJID ASTDT      AP01SDT    AP01EDT    AENDT      ONTR01FL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;date&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">1</span><span> P01     2020-03-15 2020-01-01 2020-03-01 2020-12-01 </span><span style="color: #BB0000;">NA</span><span>      </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">2</span><span> P02     2019-04-30 2020-01-01 2020-03-01 2020-03-15 Y       </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">3</span><span> P03     2019-04-30 2020-01-01 2020-03-01 </span><span style="color: #BB0000;">NA</span><span>         Y       </span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Thomas Neitmann, Stefan Bundfuss, Ben Straub, Samia Kabi, Gordon Miller, Teckla Akinyi, Andrew Smith, Konstantina Koukourikou, Ross Farrugia, Eric Simms, Annie Yang, Robin Koeger, Sophie Shapcott, Ojesh Upadhyay, Jack McGavigan, Kamila Duniec, Gayatri G, Alana Harris, Mahdi About, Pooja Kumari, Claudia Carlucci, Daniil Stefonishin, F. Hoffmann-La Roche AG, GlaxoSmithKline LLC.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer></div>

  

  

  </body></html>

