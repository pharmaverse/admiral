<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add a Variable Flagging the First or Last Observation Within Each By Group â€” derive_var_extreme_flag â€¢ admiral</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add a Variable Flagging the First or Last Observation Within Each By Group â€” derive_var_extreme_flag"><meta name="description" content="Add a variable flagging the first or last observation within each by group"><meta property="og:description" content="Add a variable flagging the first or last observation within each by group"><meta property="og:image" content="https:/pharmaverse.github.io/admiral/main/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">admiral</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started"><li><a class="dropdown-item" href="../articles/admiral.html">Get Started</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/pharmaverse/admiral/blob/main/inst/cheatsheet/admiral_cheatsheet.pdf">Cheatsheet</a></li>
    <li><a class="external-link dropdown-item" href="https://pharmaverse.github.io/admiraldiscovery/articles/presentation_archive.html">Presentation Archive</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides"><li><h6 class="dropdown-header" data-toc-skip>General Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/concepts_conventions.html">Programming Concepts and Conventions</a></li>
    <li><a class="dropdown-item" href="../articles/generic.html">Generic Derivations</a></li>
    <li><a class="dropdown-item" href="../articles/higher_order.html">Higher Order Functions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>ADaM Script Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/adsl.html">Creating a Basic ADSL</a></li>
    <li><a class="dropdown-item" href="../articles/occds.html">Creating an OCCDS ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_finding.html">Creating a BDS Findings ADAM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_exposure.html">Creating a BDS Exposure ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_tte.html">Creating a BDS Time-to-Event ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/questionnaires.html">Creating Questionnaire ADaMs</a></li>
    <li><a class="dropdown-item" href="../articles/pk_adnca.html">Creating a PK NCA or Population PK ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/hys_law.html">Hy's Law Implementation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Special Topics Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/imputation.html">Date and Time Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/visits_periods.html">Visit and Period Variables</a></li>
    <li><a class="dropdown-item" href="../articles/queries_dataset.html">Queries Dataset Documentation</a></li>
    <li><a class="dropdown-item" href="../articles/lab_grading.html">Lab Grading</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.github.io/admiraldiscovery/articles/reactable.html">ðŸ”Ž Find my function</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.slack.com/" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/issues/new/choose" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add a Variable Flagging the First or Last Observation Within Each By Group</h1>
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiral/blob/main/R/derive_var_extreme_flag.R" class="external-link"><code>R/derive_var_extreme_flag.R</code></a></small>
      <div class="d-none name"><code>derive_var_extreme_flag.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Add a variable flagging the first or last observation within each by group</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">derive_var_extreme_flag</span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  <span class="va">by_vars</span>,</span>
<span>  <span class="va">order</span>,</span>
<span>  <span class="va">new_var</span>,</span>
<span>  <span class="va">mode</span>,</span>
<span>  true_value <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>  false_value <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>  flag_all <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  check_type <span class="op">=</span> <span class="st">"warning"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dataset">dataset<a class="anchor" aria-label="anchor" href="#arg-dataset"></a></dt>
<dd><p>Input dataset</p>
<p>The variables specified by the <code>by_vars</code> argument are expected to be in the dataset.</p>
<dl><dt>Permitted values</dt>
<dd><p>a dataset, i.e., a <code>data.frame</code> or tibble</p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-by-vars">by_vars<a class="anchor" aria-label="anchor" href="#arg-by-vars"></a></dt>
<dd><p>Grouping variables</p>
<dl><dt>Permitted values</dt>
<dd><p>list of variables created by <code><a href="reexport-exprs.html">exprs()</a></code>, e.g., <code>exprs(USUBJID, VISIT)</code></p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-order">order<a class="anchor" aria-label="anchor" href="#arg-order"></a></dt>
<dd><p>Sort order</p>
<p>The first or last observation is determined with respect to the specified
order.</p>
<p>For handling of <code>NA</code>s in sorting variables see the "Sort Order" section in <code><a href="../articles/generic.html">vignette("generic")</a></code>.</p>
<dl><dt>Permitted values</dt>
<dd><p>list of variables created by <code><a href="reexport-exprs.html">exprs()</a></code>, e.g., <code>exprs(USUBJID, VISIT)</code></p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-new-var">new_var<a class="anchor" aria-label="anchor" href="#arg-new-var"></a></dt>
<dd><p>Variable to add</p>
<p>The specified variable is added to the output dataset. It is set to the value
set in <code>true_value</code> for the first or last observation (depending on the mode) of each by group.</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted symbol, e.g., <code>AVAL</code></p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-mode">mode<a class="anchor" aria-label="anchor" href="#arg-mode"></a></dt>
<dd><p>Flag mode</p>
<p>Determines of the first or last observation is flagged.</p>
<dl><dt>Permitted values</dt>
<dd><p><code>"first"</code>, <code>"last"</code></p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-true-value">true_value<a class="anchor" aria-label="anchor" href="#arg-true-value"></a></dt>
<dd><p>True value</p>
<p>The value for the specified variable <code>new_var</code>, applicable to
the first or last observation (depending on the mode) of each by group.</p>
<dl><dt>Permitted values</dt>
<dd><p>a character scalar, i.e., a character vector of length one</p></dd>

<dt>Default value</dt>
<dd><p><code>"Y"</code></p></dd>


</dl></dd>


<dt id="arg-false-value">false_value<a class="anchor" aria-label="anchor" href="#arg-false-value"></a></dt>
<dd><p>False value</p>
<p>The value for the specified variable <code>new_var</code>, NOT applicable to
the first or last observation (depending on the mode) of each by group.</p>
<dl><dt>Permitted values</dt>
<dd><p>a character scalar, i.e., a character vector of length one</p></dd>

<dt>Default value</dt>
<dd><p><code>NA_character_</code></p></dd>


</dl></dd>


<dt id="arg-flag-all">flag_all<a class="anchor" aria-label="anchor" href="#arg-flag-all"></a></dt>
<dd><p>Flag setting</p>
<p>A logical value where if set to <code>TRUE</code>, all records are flagged
and no error or warning is issued if the first or last record is not unique.</p>
<dl><dt>Permitted values</dt>
<dd><p><code>"TRUE"</code>, <code>"FALSE"</code></p></dd>

<dt>Default value</dt>
<dd><p><code>FALSE</code></p></dd>


</dl></dd>


<dt id="arg-check-type">check_type<a class="anchor" aria-label="anchor" href="#arg-check-type"></a></dt>
<dd><p>Check uniqueness?</p>
<p>If <code>"warning"</code> or <code>"error"</code> is specified, the specified message is issued
if the observations of the input dataset are not unique with respect to the
by variables and the order.</p>
<dl><dt>Permitted values</dt>
<dd><p><code>"none"</code>, <code>"message"</code>, <code>"warning"</code>, <code>"error"</code></p></dd>

<dt>Default value</dt>
<dd><p><code>"warning"</code></p></dd>


</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The input dataset with the new flag variable added</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For each group (with respect to the variables specified for the
<code>by_vars</code> parameter), <code>new_var</code> is set to <code>"Y"</code> for the first or last observation
(with respect to the order specified for the <code>order</code> parameter and the flag mode
specified for the <code>mode</code> parameter). In the case where the user wants to flag multiple records
of a grouping, for example records that all happen on the same visit and time, the argument
<code>flag_all</code> can be set to <code>TRUE</code>.
Otherwise, <code>new_var</code> is set to <code>NA</code>. Thus, the direction of "worst" is considered fixed for
all parameters in the dataset depending on the <code>order</code> and the <code>mode</code>, i.e. for every
parameter the first or last record will be flagged across the whole dataset.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>General Derivation Functions for all ADaMs that returns variable appended to dataset:
<code><a href="derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a>()</code>,
<code><a href="derive_var_merged_ef_msrc.html">derive_var_merged_ef_msrc</a>()</code>,
<code><a href="derive_var_merged_exist_flag.html">derive_var_merged_exist_flag</a>()</code>,
<code><a href="derive_var_merged_summary.html">derive_var_merged_summary</a>()</code>,
<code><a href="derive_var_obs_number.html">derive_var_obs_number</a>()</code>,
<code><a href="derive_var_relative_flag.html">derive_var_relative_flag</a>()</code>,
<code><a href="derive_vars_cat.html">derive_vars_cat</a>()</code>,
<code><a href="derive_vars_computed.html">derive_vars_computed</a>()</code>,
<code><a href="derive_vars_joined.html">derive_vars_joined</a>()</code>,
<code><a href="derive_vars_joined_summary.html">derive_vars_joined_summary</a>()</code>,
<code><a href="derive_vars_merged.html">derive_vars_merged</a>()</code>,
<code><a href="derive_vars_merged_lookup.html">derive_vars_merged_lookup</a>()</code>,
<code><a href="derive_vars_transposed.html">derive_vars_transposed</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>

<div class="section">
<h3 id="data-setup">Data setup<a class="anchor" aria-label="anchor" href="#data-setup"></a></h3>


<p>The following examples use the <code>ADVS</code> and <code>ADAE</code> datasets below as a basis.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">PARAMCD</span>,    <span class="op">~</span><span class="va">AVISIT</span>,          <span class="op">~</span><span class="va">ADT</span>, <span class="op">~</span><span class="va">AVAL</span>,</span>
<span>  <span class="st">"1015"</span>,   <span class="st">"TEMP"</span>,   <span class="st">"BASELINE"</span>,  <span class="st">"2021-04-27"</span>,  <span class="fl">38.0</span>,</span>
<span>  <span class="st">"1015"</span>,   <span class="st">"TEMP"</span>,   <span class="st">"BASELINE"</span>,  <span class="st">"2021-04-25"</span>,  <span class="fl">39.0</span>,</span>
<span>  <span class="st">"1015"</span>,   <span class="st">"TEMP"</span>,   <span class="st">"WEEK 2"</span>,    <span class="st">"2021-05-10"</span>,  <span class="fl">37.5</span>,</span>
<span>  <span class="st">"1015"</span>,   <span class="st">"WEIGHT"</span>, <span class="st">"SCREENING"</span>, <span class="st">"2021-04-19"</span>,  <span class="fl">81.2</span>,</span>
<span>  <span class="st">"1015"</span>,   <span class="st">"WEIGHT"</span>, <span class="st">"BASELINE"</span>,  <span class="st">"2021-04-25"</span>,  <span class="fl">82.7</span>,</span>
<span>  <span class="st">"1015"</span>,   <span class="st">"WEIGHT"</span>, <span class="st">"BASELINE"</span>,  <span class="st">"2021-04-27"</span>,  <span class="fl">84.0</span>,</span>
<span>  <span class="st">"1015"</span>,   <span class="st">"WEIGHT"</span>, <span class="st">"WEEK 2"</span>,    <span class="st">"2021-05-09"</span>,  <span class="fl">82.5</span>,</span>
<span>  <span class="st">"1023"</span>,   <span class="st">"TEMP"</span>,   <span class="st">"SCREENING"</span>, <span class="st">"2021-04-27"</span>,  <span class="fl">38.0</span>,</span>
<span>  <span class="st">"1023"</span>,   <span class="st">"TEMP"</span>,   <span class="st">"BASELINE"</span>,  <span class="st">"2021-04-28"</span>,  <span class="fl">37.5</span>,</span>
<span>  <span class="st">"1023"</span>,   <span class="st">"TEMP"</span>,   <span class="st">"BASELINE"</span>,  <span class="st">"2021-04-29"</span>,  <span class="fl">37.5</span>,</span>
<span>  <span class="st">"1023"</span>,   <span class="st">"TEMP"</span>,   <span class="st">"WEEK 1"</span>,    <span class="st">"2021-05-03"</span>,  <span class="fl">37.0</span>,</span>
<span>  <span class="st">"1023"</span>,   <span class="st">"WEIGHT"</span>, <span class="st">"SCREENING"</span>, <span class="st">"2021-04-27"</span>,  <span class="fl">69.6</span>,</span>
<span>  <span class="st">"1023"</span>,   <span class="st">"WEIGHT"</span>, <span class="st">"BASELINE"</span>,  <span class="st">"2021-04-29"</span>,  <span class="fl">67.2</span>,</span>
<span>  <span class="st">"1023"</span>,   <span class="st">"WEIGHT"</span>, <span class="st">"WEEK 1"</span>,    <span class="st">"2021-05-02"</span>,  <span class="fl">65.9</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  STUDYID <span class="op">=</span> <span class="st">"AB123"</span>,</span>
<span>  ADT <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="va">ADT</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">adae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>,         <span class="op">~</span><span class="va">AEBODSYS</span>,    <span class="op">~</span><span class="va">AEDECOD</span>,   <span class="op">~</span><span class="va">AESEV</span>, <span class="op">~</span><span class="va">AESTDY</span>, <span class="op">~</span><span class="va">AESEQ</span>,</span>
<span>  <span class="st">"1015"</span>, <span class="st">"GENERAL DISORDERS"</span>,  <span class="st">"ERYTHEMA"</span>,   <span class="st">"MILD"</span>,       <span class="fl">2</span>,      <span class="fl">1</span>,</span>
<span>  <span class="st">"1015"</span>, <span class="st">"GENERAL DISORDERS"</span>,  <span class="st">"PRURITUS"</span>,   <span class="st">"MILD"</span>,       <span class="fl">2</span>,      <span class="fl">2</span>,</span>
<span>  <span class="st">"1015"</span>,      <span class="st">"GI DISORDERS"</span>, <span class="st">"DIARRHOEA"</span>,   <span class="st">"MILD"</span>,       <span class="fl">8</span>,      <span class="fl">3</span>,</span>
<span>  <span class="st">"1023"</span>, <span class="st">"CARDIAC DISORDERS"</span>,  <span class="st">"AV BLOCK"</span>,   <span class="st">"MILD"</span>,      <span class="fl">22</span>,      <span class="fl">4</span>,</span>
<span>  <span class="st">"1023"</span>,    <span class="st">"SKIN DISORDERS"</span>,  <span class="st">"ERYTHEMA"</span>,   <span class="st">"MILD"</span>,       <span class="fl">3</span>,      <span class="fl">1</span>,</span>
<span>  <span class="st">"1023"</span>,    <span class="st">"SKIN DISORDERS"</span>,  <span class="st">"ERYTHEMA"</span>, <span class="st">"SEVERE"</span>,       <span class="fl">5</span>,      <span class="fl">2</span>,</span>
<span>  <span class="st">"1023"</span>,    <span class="st">"SKIN DISORDERS"</span>,  <span class="st">"ERYTHEMA"</span>,   <span class="st">"MILD"</span>,       <span class="fl">8</span>,      <span class="fl">3</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>STUDYID <span class="op">=</span> <span class="st">"AB123"</span><span class="op">)</span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="flagging-the-first-last-observation-within-a-by-group-order-mode-">Flagging the first/last observation within a by group (<code>order</code>, <code>mode</code>)<a class="anchor" aria-label="anchor" href="#flagging-the-first-last-observation-within-a-by-group-order-mode-"></a></h3>


<p>A new variable is added for each subject to flag the last observation
within a by group. Within each by group (specified by <code>by_vars</code>), the
<code>order = exprs(ADT)</code> argument specifies we wish to sort the records by analysis
date and then select the last one (<code>mode = "last"</code>). The name of the new
variable is passed through the <code>new_var = LASTFL</code> call.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">advs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/derive_var_extreme_flag.html">derive_var_extreme_flag</a></span><span class="op">(</span></span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>    order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADT</span><span class="op">)</span>,</span>
<span>    new_var <span class="op">=</span> <span class="va">LASTFL</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">PARAMCD</span>, <span class="va">ADT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 14 Ã— 7</span></span>
<span><span class="co">#&gt;    STUDYID USUBJID PARAMCD AVISIT    ADT         AVAL LASTFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 AB123   1015    TEMP    BASELINE  2021-04-25  39   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 AB123   1015    TEMP    BASELINE  2021-04-27  38   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  3 AB123   1015    TEMP    WEEK 2    2021-05-10  37.5 Y</span></span>
<span><span class="co">#&gt;  4 AB123   1015    WEIGHT  SCREENING 2021-04-19  81.2 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  5 AB123   1015    WEIGHT  BASELINE  2021-04-25  82.7 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  6 AB123   1015    WEIGHT  BASELINE  2021-04-27  84   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  7 AB123   1015    WEIGHT  WEEK 2    2021-05-09  82.5 Y</span></span>
<span><span class="co">#&gt;  8 AB123   1023    TEMP    SCREENING 2021-04-27  38   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  9 AB123   1023    TEMP    BASELINE  2021-04-28  37.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 AB123   1023    TEMP    BASELINE  2021-04-29  37.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 AB123   1023    TEMP    WEEK 1    2021-05-03  37   Y</span></span>
<span><span class="co">#&gt; 12 AB123   1023    WEIGHT  SCREENING 2021-04-27  69.6 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13 AB123   1023    WEIGHT  BASELINE  2021-04-29  67.2 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 14 AB123   1023    WEIGHT  WEEK 1    2021-05-02  65.9 Y     </span></span></code></pre><p></p></div>
<p>Note here that a similar <code>FIRSTFL</code> variable could instead be derived
simply by switching to <code>mode = "first"</code>. Alternatively, we could make use
of <code><a href="reexport-desc.html">desc()</a></code> within the sorting specified by <code>order</code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">advs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/derive_var_extreme_flag.html">derive_var_extreme_flag</a></span><span class="op">(</span></span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>    order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="fu"><a href="../reference/reexport-desc.html">desc</a></span><span class="op">(</span><span class="va">ADT</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    new_var <span class="op">=</span> <span class="va">FIRSTFL</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">PARAMCD</span>, <span class="va">ADT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 14 Ã— 7</span></span>
<span><span class="co">#&gt;    STUDYID USUBJID PARAMCD AVISIT    ADT         AVAL FIRSTFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 AB123   1015    TEMP    BASELINE  2021-04-25  39   Y</span></span>
<span><span class="co">#&gt;  2 AB123   1015    TEMP    BASELINE  2021-04-27  38   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  3 AB123   1015    TEMP    WEEK 2    2021-05-10  37.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  4 AB123   1015    WEIGHT  SCREENING 2021-04-19  81.2 Y</span></span>
<span><span class="co">#&gt;  5 AB123   1015    WEIGHT  BASELINE  2021-04-25  82.7 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  6 AB123   1015    WEIGHT  BASELINE  2021-04-27  84   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  7 AB123   1015    WEIGHT  WEEK 2    2021-05-09  82.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 AB123   1023    TEMP    SCREENING 2021-04-27  38   Y</span></span>
<span><span class="co">#&gt;  9 AB123   1023    TEMP    BASELINE  2021-04-28  37.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 AB123   1023    TEMP    BASELINE  2021-04-29  37.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 AB123   1023    TEMP    WEEK 1    2021-05-03  37   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12 AB123   1023    WEIGHT  SCREENING 2021-04-27  69.6 Y</span></span>
<span><span class="co">#&gt; 13 AB123   1023    WEIGHT  BASELINE  2021-04-29  67.2 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 14 AB123   1023    WEIGHT  WEEK 1    2021-05-02  65.9 &lt;NA&gt;   </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="modifying-the-flag-values-true-value-false-value-">Modifying the flag values (<code>true_value</code>, <code>false_value</code>)<a class="anchor" aria-label="anchor" href="#modifying-the-flag-values-true-value-false-value-"></a></h3>


<p>The previous example is now enhanced with custom values for the flag
entries. Records which are flagged are filled with the contents of
<code>true_value</code> and those which are not are filled with the contents of
<code>false_value</code>. Note that these are normally preset to <code>"Y"</code> and <code>NA</code>,
which is why they were not specified in the example above.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">advs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/derive_var_extreme_flag.html">derive_var_extreme_flag</a></span><span class="op">(</span></span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>    order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADT</span><span class="op">)</span>,</span>
<span>    new_var <span class="op">=</span> <span class="va">LASTFL</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>    true_value <span class="op">=</span> <span class="st">"Yes"</span>,</span>
<span>    false_value <span class="op">=</span> <span class="st">"No"</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">PARAMCD</span>, <span class="va">ADT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 14 Ã— 7</span></span>
<span><span class="co">#&gt;    STUDYID USUBJID PARAMCD AVISIT    ADT         AVAL LASTFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 AB123   1015    TEMP    BASELINE  2021-04-25  39   No</span></span>
<span><span class="co">#&gt;  2 AB123   1015    TEMP    BASELINE  2021-04-27  38   No</span></span>
<span><span class="co">#&gt;  3 AB123   1015    TEMP    WEEK 2    2021-05-10  37.5 Yes</span></span>
<span><span class="co">#&gt;  4 AB123   1015    WEIGHT  SCREENING 2021-04-19  81.2 No</span></span>
<span><span class="co">#&gt;  5 AB123   1015    WEIGHT  BASELINE  2021-04-25  82.7 No</span></span>
<span><span class="co">#&gt;  6 AB123   1015    WEIGHT  BASELINE  2021-04-27  84   No</span></span>
<span><span class="co">#&gt;  7 AB123   1015    WEIGHT  WEEK 2    2021-05-09  82.5 Yes</span></span>
<span><span class="co">#&gt;  8 AB123   1023    TEMP    SCREENING 2021-04-27  38   No</span></span>
<span><span class="co">#&gt;  9 AB123   1023    TEMP    BASELINE  2021-04-28  37.5 No</span></span>
<span><span class="co">#&gt; 10 AB123   1023    TEMP    BASELINE  2021-04-29  37.5 No</span></span>
<span><span class="co">#&gt; 11 AB123   1023    TEMP    WEEK 1    2021-05-03  37   Yes</span></span>
<span><span class="co">#&gt; 12 AB123   1023    WEIGHT  SCREENING 2021-04-27  69.6 No</span></span>
<span><span class="co">#&gt; 13 AB123   1023    WEIGHT  BASELINE  2021-04-29  67.2 No</span></span>
<span><span class="co">#&gt; 14 AB123   1023    WEIGHT  WEEK 1    2021-05-02  65.9 Yes   </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="creating-temporary-variables-for-sorting-check-type-">Creating temporary variables for sorting (<code>check_type</code>)<a class="anchor" aria-label="anchor" href="#creating-temporary-variables-for-sorting-check-type-"></a></h3>


<p>In this example we wish to flag the first occurrence of the most
severe AE within each subject. To ensure correct sorting of the
severity values, <code>AESEV</code> must be pre-processed into a numeric variable
<code>TEMP_AESEVN</code> which can then be passed inside <code>order</code>. Once again,
to ensure we only flag the <em>first</em> occurrence, we specify <code>AESTDY</code> and
<code>AESEQ</code> inside <code>order</code> as well.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">adae</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    TEMP_AESEVN <span class="op">=</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">AESEV</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SEVERE"</span>, <span class="st">"MODERATE"</span>, <span class="st">"MILD"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/derive_var_extreme_flag.html">derive_var_extreme_flag</a></span><span class="op">(</span></span>
<span>    new_var <span class="op">=</span> <span class="va">AOCCIFL</span>,</span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>    order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">TEMP_AESEVN</span>, <span class="va">AESTDY</span>, <span class="va">AESEQ</span><span class="op">)</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"first"</span>,</span>
<span>    check_type <span class="op">=</span> <span class="st">"warning"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">AESTDY</span>, <span class="va">AESEQ</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">AEDECOD</span>, <span class="va">AESEV</span>, <span class="va">AESTDY</span>, <span class="va">AESEQ</span>, <span class="va">AOCCIFL</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 Ã— 7</span></span>
<span><span class="co">#&gt;   STUDYID USUBJID AEDECOD   AESEV  AESTDY AESEQ AOCCIFL</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 AB123   1015    ERYTHEMA  MILD        2     1 Y</span></span>
<span><span class="co">#&gt; 2 AB123   1015    PRURITUS  MILD        2     2 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3 AB123   1015    DIARRHOEA MILD        8     3 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4 AB123   1023    ERYTHEMA  MILD        3     1 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5 AB123   1023    ERYTHEMA  SEVERE      5     2 Y</span></span>
<span><span class="co">#&gt; 6 AB123   1023    ERYTHEMA  MILD        8     3 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7 AB123   1023    AV BLOCK  MILD       22     4 &lt;NA&gt;   </span></span></code></pre><p></p></div>
<p>Note here that the presence of <code>AESEQ</code> as a sorting variable inside
the <code>order</code> argument ensures that the combination of <code>by_vars</code> and
<code>order</code> indexes unique records in the dataset. If this had been omitted,
the choice of <code>check_type = "warning"</code> would have ensured that
<code>derive_var_extreme_flag()</code> would throw a warning due to perceived
duplicate records (in this case, the first two AEs for subject <code>"1015"</code>).
If no sorting variables exist, or if these duplicates are acceptable, then
the user can silence the warning with <code>check_type = "none"</code>. Alternatively,
the warning can be upgraded to an error with <code>check_type = "error"</code>.</p>
</div>
<div class="section">
<h3 id="flagging-all-records-if-multiple-are-identified-flag-all-">Flagging all records if multiple are identified (<code>flag_all</code>)<a class="anchor" aria-label="anchor" href="#flagging-all-records-if-multiple-are-identified-flag-all-"></a></h3>


<p>Revisiting the above example, if we instead wish to flag <em>all</em> AEs
of the highest severity occurring on the earliest date, then we can use
<code>flag_all = TRUE</code>. Note that we now also omit <code>AESEQ</code> from the <code>order</code>
argument because we do not need to differentiate between two AEs occurring
on the same day (e.g. for subject <code>"1015"</code>) as they are both flagged.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">adae</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    TEMP_AESEVN <span class="op">=</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">AESEV</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SEVERE"</span>, <span class="st">"MODERATE"</span>, <span class="st">"MILD"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/derive_var_extreme_flag.html">derive_var_extreme_flag</a></span><span class="op">(</span></span>
<span>    new_var <span class="op">=</span> <span class="va">AOCCIFL</span>,</span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>    order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">TEMP_AESEVN</span>, <span class="va">AESTDY</span><span class="op">)</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"first"</span>,</span>
<span>    flag_all <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">AESTDY</span>, <span class="va">AESEQ</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">AEDECOD</span>, <span class="va">AESEV</span>, <span class="va">AESTDY</span>, <span class="va">AESEQ</span>, <span class="va">AOCCIFL</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 Ã— 7</span></span>
<span><span class="co">#&gt;   STUDYID USUBJID AEDECOD   AESEV  AESTDY AESEQ AOCCIFL</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 AB123   1015    ERYTHEMA  MILD        2     1 Y</span></span>
<span><span class="co">#&gt; 2 AB123   1015    PRURITUS  MILD        2     2 Y</span></span>
<span><span class="co">#&gt; 3 AB123   1015    DIARRHOEA MILD        8     3 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4 AB123   1023    ERYTHEMA  MILD        3     1 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5 AB123   1023    ERYTHEMA  SEVERE      5     2 Y</span></span>
<span><span class="co">#&gt; 6 AB123   1023    ERYTHEMA  MILD        8     3 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7 AB123   1023    AV BLOCK  MILD       22     4 &lt;NA&gt;   </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="deriving-a-baseline-flag">Deriving a baseline flag<a class="anchor" aria-label="anchor" href="#deriving-a-baseline-flag"></a></h3>


<p><code>derive_var_extreme_flag()</code> is very often used to derive the baseline
flag <code>ABLFL</code>, so the following section contains various examples of this
in action for the <code>ADVS</code> dataset. Note that for these derivations it is
often convenient to leverage higher order functions such as
<code><a href="restrict_derivation.html">restrict_derivation()</a></code> and <code><a href="slice_derivation.html">slice_derivation()</a></code>. Please read the
<a href="https://pharmaverse.github.io/admiral/articles/higher_order.html" class="external-link">Higher Order Functions</a>
vignette, as well as their specific reference pages, to learn more.</p>
<p>To set the baseline flag for the last observation among those where
<code>AVISIT = "BASELINE"</code>, we can use a similar call to the examples above but
wrapping inside of <code><a href="restrict_derivation.html">restrict_derivation()</a></code> and making use of the <code>filter</code>
argument.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/restrict_derivation.html">restrict_derivation</a></span><span class="op">(</span></span>
<span>  <span class="va">advs</span>,</span>
<span>  derivation <span class="op">=</span> <span class="va">derive_var_extreme_flag</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="../reference/params.html">params</a></span><span class="op">(</span></span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>    order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADT</span><span class="op">)</span>,</span>
<span>    new_var <span class="op">=</span> <span class="va">ABLFL</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"last"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  filter <span class="op">=</span> <span class="va">AVISIT</span> <span class="op">==</span> <span class="st">"BASELINE"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">PARAMCD</span>, <span class="va">ADT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 14 Ã— 7</span></span>
<span><span class="co">#&gt;    STUDYID USUBJID PARAMCD AVISIT    ADT         AVAL ABLFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 AB123   1015    TEMP    BASELINE  2021-04-25  39   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 AB123   1015    TEMP    BASELINE  2021-04-27  38   Y</span></span>
<span><span class="co">#&gt;  3 AB123   1015    TEMP    WEEK 2    2021-05-10  37.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  4 AB123   1015    WEIGHT  SCREENING 2021-04-19  81.2 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  5 AB123   1015    WEIGHT  BASELINE  2021-04-25  82.7 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  6 AB123   1015    WEIGHT  BASELINE  2021-04-27  84   Y</span></span>
<span><span class="co">#&gt;  7 AB123   1015    WEIGHT  WEEK 2    2021-05-09  82.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 AB123   1023    TEMP    SCREENING 2021-04-27  38   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  9 AB123   1023    TEMP    BASELINE  2021-04-28  37.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 AB123   1023    TEMP    BASELINE  2021-04-29  37.5 Y</span></span>
<span><span class="co">#&gt; 11 AB123   1023    TEMP    WEEK 1    2021-05-03  37   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12 AB123   1023    WEIGHT  SCREENING 2021-04-27  69.6 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13 AB123   1023    WEIGHT  BASELINE  2021-04-29  67.2 Y</span></span>
<span><span class="co">#&gt; 14 AB123   1023    WEIGHT  WEEK 1    2021-05-02  65.9 &lt;NA&gt; </span></span></code></pre><p></p></div>
<p>Alternatively, to set baseline as the lowest observation among
those where <code>AVISIT = "BASELINE"</code> (selecting the latest if there are
multiple) we can modify the <code>order</code> argument, ensuring to sort by
descending <code>AVAL</code>  before <code>ADT</code>. Note here the synergy between <code><a href="reexport-desc.html">desc()</a></code>
and <code>mode</code>, because <code>mode = "last"</code> applies to both the ordering
variables <code>AVAL</code> and <code>ADT</code> and so we need to reverse only the ordering
of the former to ensure that the lowest value is selected but also that
the latest one among multiple is preferred. This is relevant for
subject <code>"1023"</code>'s temperature records.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/restrict_derivation.html">restrict_derivation</a></span><span class="op">(</span></span>
<span>  <span class="va">advs</span>,</span>
<span>  derivation <span class="op">=</span> <span class="va">derive_var_extreme_flag</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="../reference/params.html">params</a></span><span class="op">(</span></span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>    order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="fu"><a href="../reference/reexport-desc.html">desc</a></span><span class="op">(</span><span class="va">AVAL</span><span class="op">)</span>, <span class="va">ADT</span><span class="op">)</span>,</span>
<span>    new_var <span class="op">=</span> <span class="va">ABLFL</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"last"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  filter <span class="op">=</span> <span class="va">AVISIT</span> <span class="op">==</span> <span class="st">"BASELINE"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">PARAMCD</span>, <span class="va">ADT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 14 Ã— 7</span></span>
<span><span class="co">#&gt;    STUDYID USUBJID PARAMCD AVISIT    ADT         AVAL ABLFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 AB123   1015    TEMP    BASELINE  2021-04-25  39   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 AB123   1015    TEMP    BASELINE  2021-04-27  38   Y</span></span>
<span><span class="co">#&gt;  3 AB123   1015    TEMP    WEEK 2    2021-05-10  37.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  4 AB123   1015    WEIGHT  SCREENING 2021-04-19  81.2 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  5 AB123   1015    WEIGHT  BASELINE  2021-04-25  82.7 Y</span></span>
<span><span class="co">#&gt;  6 AB123   1015    WEIGHT  BASELINE  2021-04-27  84   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  7 AB123   1015    WEIGHT  WEEK 2    2021-05-09  82.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 AB123   1023    TEMP    SCREENING 2021-04-27  38   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  9 AB123   1023    TEMP    BASELINE  2021-04-28  37.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 AB123   1023    TEMP    BASELINE  2021-04-29  37.5 Y</span></span>
<span><span class="co">#&gt; 11 AB123   1023    TEMP    WEEK 1    2021-05-03  37   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12 AB123   1023    WEIGHT  SCREENING 2021-04-27  69.6 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13 AB123   1023    WEIGHT  BASELINE  2021-04-29  67.2 Y</span></span>
<span><span class="co">#&gt; 14 AB123   1023    WEIGHT  WEEK 1    2021-05-02  65.9 &lt;NA&gt; </span></span></code></pre><p></p></div>
<p>In practice, baseline-setting may vary on a parameter by
parameter basis, in which case <code><a href="slice_derivation.html">slice_derivation()</a></code> could be
used in place of <code><a href="restrict_derivation.html">restrict_derivation()</a></code>. In the example below, we
set the baseline flag as follows: for temperature records, as the
lowest value recorded at a baseline visit; for weight records,
as the highest value recorded at a baseline visit. In both cases,
we again select the latest observation if there are multiple.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/slice_derivation.html">slice_derivation</a></span><span class="op">(</span></span>
<span>  <span class="va">advs</span>,</span>
<span>  derivation <span class="op">=</span> <span class="va">derive_var_extreme_flag</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="../reference/params.html">params</a></span><span class="op">(</span></span>
<span>    by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>    mode <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>    new_var <span class="op">=</span> <span class="va">ABLFL</span>,</span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/derivation_slice.html">derivation_slice</a></span><span class="op">(</span></span>
<span>    filter <span class="op">=</span> <span class="va">AVISIT</span> <span class="op">==</span> <span class="st">"BASELINE"</span> <span class="op">&amp;</span> <span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"TEMP"</span>,</span>
<span>    args <span class="op">=</span> <span class="fu"><a href="../reference/params.html">params</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="fu"><a href="../reference/reexport-desc.html">desc</a></span><span class="op">(</span><span class="va">AVAL</span><span class="op">)</span>, <span class="va">ADT</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/derivation_slice.html">derivation_slice</a></span><span class="op">(</span></span>
<span>    filter <span class="op">=</span> <span class="va">AVISIT</span> <span class="op">==</span> <span class="st">"BASELINE"</span> <span class="op">&amp;</span> <span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"WEIGHT"</span>,</span>
<span>    args <span class="op">=</span> <span class="fu"><a href="../reference/params.html">params</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVAL</span>, <span class="va">ADT</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">PARAMCD</span>, <span class="va">ADT</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 14 Ã— 7</span></span>
<span><span class="co">#&gt;    STUDYID USUBJID PARAMCD AVISIT    ADT         AVAL ABLFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 AB123   1015    TEMP    BASELINE  2021-04-25  39   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 AB123   1015    TEMP    BASELINE  2021-04-27  38   Y</span></span>
<span><span class="co">#&gt;  3 AB123   1015    TEMP    WEEK 2    2021-05-10  37.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  4 AB123   1015    WEIGHT  SCREENING 2021-04-19  81.2 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  5 AB123   1015    WEIGHT  BASELINE  2021-04-25  82.7 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  6 AB123   1015    WEIGHT  BASELINE  2021-04-27  84   Y</span></span>
<span><span class="co">#&gt;  7 AB123   1015    WEIGHT  WEEK 2    2021-05-09  82.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 AB123   1023    TEMP    SCREENING 2021-04-27  38   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  9 AB123   1023    TEMP    BASELINE  2021-04-28  37.5 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 AB123   1023    TEMP    BASELINE  2021-04-29  37.5 Y</span></span>
<span><span class="co">#&gt; 11 AB123   1023    TEMP    WEEK 1    2021-05-03  37   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12 AB123   1023    WEIGHT  SCREENING 2021-04-27  69.6 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13 AB123   1023    WEIGHT  BASELINE  2021-04-29  67.2 Y</span></span>
<span><span class="co">#&gt; 14 AB123   1023    WEIGHT  WEEK 1    2021-05-02  65.9 &lt;NA&gt; </span></span></code></pre><p></p></div>
</div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by F. Hoffmann-La Roche AG, GlaxoSmithKline LLC, Ben Straub, Stefan Bundfuss, Arianna Cascone, Jeffrey Dickinson, Ross Farrugia, Fanny Gautier, G Gayatri, Solveig Holmgaard, Dinakar Kulkarni, Edoardo Mancini, Gordon Miller, Jim Rothstein, Daniel Sjoberg, Stefan Thoma, Junze Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

