<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Summarize Variables from an Additional Dataset Based on Conditions from Both Datasets â€” derive_vars_joined_summary â€¢ admiral</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="â€image/svg+xmlâ€" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Summarize Variables from an Additional Dataset Based on Conditions from Both Datasets â€” derive_vars_joined_summary"><meta name="description" content="The function summarizes variables from an additional dataset and adds the
summarized values as new variables to the input dataset. The selection of the
observations from the additional dataset can depend on variables from both
datasets. For example, all doses before the current observation can be
selected and the sum be added to the input dataset."><meta property="og:description" content="The function summarizes variables from an additional dataset and adds the
summarized values as new variables to the input dataset. The selection of the
observations from the additional dataset can depend on variables from both
datasets. For example, all doses before the current observation can be
selected and the sum be added to the input dataset."><meta property="og:image" content="https:/pharmaverse.github.io/admiral/main/logo.png"><script async src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="2c7249cc-f1dc-4a63-8674-6ecbcb34d95c" data-project-name="admiral" data-project-color="#2c3e50" data-project-logo="https://pharmaverse.github.io/admiral/cran-release/logo.png" data-consent-required="true" data-user-analytics-cookie-enabled="true" data-consent-screen-title="Help us improve our AI assistant" data-consent-screen-disclaimer="By clicking 'Allow tracking', you consent to anonymous user tracking which helps us improve our service. We don't collect any personally identifiable information." data-consent-screen-accept-button-text="Allow tracking" data-consent-screen-reject-button-text="No, thanks" data-modal-example-questions="Tell me a little about the {admiral} package., What are some important {admiral} functions and what do they do?" data-modal-z-index="9999"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">admiral</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1.9019</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started"><li><a class="dropdown-item" href="../articles/admiral.html">Get Started</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/pharmaverse/admiral/blob/main/inst/cheatsheet/admiral_cheatsheet.pdf">Cheatsheet</a></li>
    <li><a class="external-link dropdown-item" href="https://pharmaverse.github.io/admiraldiscovery/articles/presentation_archive.html">Presentation Archive</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides"><li><h6 class="dropdown-header" data-toc-skip>General Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/concepts_conventions.html">Programming Concepts and Conventions</a></li>
    <li><a class="dropdown-item" href="../articles/generic.html">Generic Derivations</a></li>
    <li><a class="dropdown-item" href="../articles/higher_order.html">Higher Order Functions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>ADaM Script Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/adsl.html">Creating a Basic ADSL</a></li>
    <li><a class="dropdown-item" href="../articles/occds.html">Creating an OCCDS ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_finding.html">Creating a BDS Findings ADAM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_exposure.html">Creating a BDS Exposure ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_tte.html">Creating a BDS Time-to-Event ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/questionnaires.html">Creating Questionnaire ADaMs</a></li>
    <li><a class="dropdown-item" href="../articles/pk_adnca.html">Creating a PK NCA or Population PK ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/hys_law.html">Hy's Law Implementation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Special Topics Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/imputation.html">Date and Time Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/visits_periods.html">Visit and Period Variables</a></li>
    <li><a class="dropdown-item" href="../articles/queries_dataset.html">Queries Dataset Documentation</a></li>
    <li><a class="dropdown-item" href="../articles/lab_grading.html">Lab Grading</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.github.io/admiraldiscovery/articles/reactable.html">ðŸ”Ž Find my function</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.slack.com/" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/issues/new/choose" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Summarize Variables from an Additional Dataset Based on Conditions from Both Datasets</h1>
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiral/blob/main/R/derive_vars_joined_summary.R" class="external-link"><code>R/derive_vars_joined_summary.R</code></a></small>
      <div class="d-none name"><code>derive_vars_joined_summary.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function summarizes variables from an additional dataset and adds the
summarized values as new variables to the input dataset. The selection of the
observations from the additional dataset can depend on variables from both
datasets. For example, all doses before the current observation can be
selected and the sum be added to the input dataset.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">derive_vars_joined_summary</span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  <span class="va">dataset_add</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  order <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">new_vars</span>,</span>
<span>  tmp_obs_nr_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">join_type</span>,</span>
<span>  filter_add <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  first_cond_lower <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  first_cond_upper <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  missing_values <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  check_type <span class="op">=</span> <span class="st">"warning"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dataset">dataset<a class="anchor" aria-label="anchor" href="#arg-dataset"></a></dt>
<dd><p>Input dataset</p>
<p>The variables specified by the <code>by_vars</code> argument are expected to be in the dataset.</p>
<dl><dt>Permitted values</dt>
<dd><p>a dataset, i.e., a <code>data.frame</code> or tibble</p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-dataset-add">dataset_add<a class="anchor" aria-label="anchor" href="#arg-dataset-add"></a></dt>
<dd><p>Additional dataset</p>
<p>The variables specified by the <code>by_vars</code>, the <code>new_vars</code>, the <code>join_vars</code>,
and the <code>order</code> argument are expected.</p>
<dl><dt>Permitted values</dt>
<dd><p>a dataset, i.e., a <code>data.frame</code> or tibble</p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-by-vars">by_vars<a class="anchor" aria-label="anchor" href="#arg-by-vars"></a></dt>
<dd><p>Grouping variables</p>
<p>The two datasets are joined by the specified variables.</p>
<p>Variables can be renamed by naming the element, i.e.
<code>by_vars = exprs(&lt;name in input dataset&gt; = &lt;name in additional dataset&gt;)</code>, similar to the <code>dplyr</code> joins.</p>
<dl><dt>Permitted values</dt>
<dd><p>list of (optionally named) variables created by <code><a href="reexport-exprs.html">exprs()</a></code>, e.g., <code>exprs(USUBJID, ADY = ASTDY)</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-order">order<a class="anchor" aria-label="anchor" href="#arg-order"></a></dt>
<dd><p>Sort order</p>
<p>The specified variables are used to determine the order of the records if
<code>first_cond_lower</code> or <code>first_cond_upper</code> is specified or if <code>join_type</code>
equals <code>"before"</code> or <code>"after"</code>.</p>
<p>If an expression is named, e.g., <code>exprs(EXSTDT = convert_dtc_to_dt(EXSTDTC), EXSEQ)</code>, a corresponding variable (<code>EXSTDT</code>) is
added to the additional dataset and can be used in the filter conditions
(<code>filter_add</code>, <code>filter_join</code>) and for <code>join_vars</code> and <code>new_vars</code>. The
variable is not included in the output dataset.</p>
<p>For handling of <code>NA</code>s in sorting variables see the "Sort Order" section in <code><a href="../articles/generic.html">vignette("generic")</a></code>.</p>
<dl><dt>Permitted values</dt>
<dd><p>list of expressions created by <code><a href="reexport-exprs.html">exprs()</a></code>, e.g., <code>exprs(ADT, desc(AVAL))</code> or <code>NULL</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-new-vars">new_vars<a class="anchor" aria-label="anchor" href="#arg-new-vars"></a></dt>
<dd><p>Variables to add</p>
<p>The new variables can be defined by named expressions, i.e., <code>new_vars = exprs(&lt;new variable&gt; = &lt;value&gt;)</code>. The value must be defined such that it
results in a single record per by group, e.g., by using a summary function
like <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code>, <code><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum()</a></code>, ...</p>
<dl><dt>Permitted values</dt>
<dd><p>list of named expressions created by <code><a href="reexport-exprs.html">exprs()</a></code>, e.g., <code>exprs(CUMDOSA = sum(AVAL, na.rm = TRUE), AVALU = "ml")</code></p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-tmp-obs-nr-var">tmp_obs_nr_var<a class="anchor" aria-label="anchor" href="#arg-tmp-obs-nr-var"></a></dt>
<dd><p>Temporary observation number</p>
<p>The specified variable is added to the input dataset (<code>dataset</code>) and the
restricted additional dataset (<code>dataset_add</code> after applying <code>filter_add</code>).
It is set to the observation number with respect to <code>order</code>. For each by
group (<code>by_vars</code>) the observation number starts with <code>1</code>. The variable can
be used in the conditions (<code>filter_join</code>, <code>first_cond_upper</code>,
<code>first_cond_lower</code>). It can also be used to select consecutive observations
or the last observation.</p>
<p>The variable is not included in the output dataset. To include it specify
it for <code>new_vars</code>.</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted symbol, e.g., <code>AVAL</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-join-vars">join_vars<a class="anchor" aria-label="anchor" href="#arg-join-vars"></a></dt>
<dd><p>Variables to use from additional dataset</p>
<p>Any extra variables required from the additional dataset for <code>filter_join</code>
should be specified for this argument. Variables specified for <code>new_vars</code>
do not need to be repeated for <code>join_vars</code>. If a specified variable exists
in both the input dataset and the additional dataset, the suffix ".join" is
added to the variable from the additional dataset.</p>
<p>If an expression is named, e.g., <code>exprs(EXSTDT = convert_dtc_to_dt(EXSTDTC))</code>, a corresponding variable is added to the
additional dataset and can be used in the filter conditions (<code>filter_add</code>,
<code>filter_join</code>) and for <code>new_vars</code>.</p>
<p>The variables are not included in the output dataset.</p>
<dl><dt>Permitted values</dt>
<dd><p>list of variables or named expressions created by <code><a href="reexport-exprs.html">exprs()</a></code>, e.g., <code>exprs(EXSTDY, EXSTDTM = convert_dtc_to_dtm(EXSTDTC))</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-join-type">join_type<a class="anchor" aria-label="anchor" href="#arg-join-type"></a></dt>
<dd><p>Observations to keep after joining</p>
<p>The argument determines which of the joined observations are kept with
respect to the original observation. For example, if <code>join_type = "after"</code>
is specified all observations after the original observations are kept.</p>
<dl><dt>Permitted values</dt>
<dd><p><code>"before"</code>, <code>"after"</code>, <code>"all"</code></p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-filter-add">filter_add<a class="anchor" aria-label="anchor" href="#arg-filter-add"></a></dt>
<dd><p>Filter for additional dataset (<code>dataset_add</code>)</p>
<p>Only observations from <code>dataset_add</code> fulfilling the specified condition are
joined to the input dataset. If the argument is not specified, all
observations are joined.</p>
<p>Variables created by <code>order</code> or <code>new_vars</code> arguments can be used in the
condition.</p>
<p>The condition can include summary functions like <code><a href="https://rdrr.io/r/base/all.html" class="external-link">all()</a></code> or <code><a href="https://rdrr.io/r/base/any.html" class="external-link">any()</a></code>. The
additional dataset is grouped by the by variables (<code>by_vars</code>).</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted condition, e.g., <code>AVISIT == "BASELINE"</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-first-cond-lower">first_cond_lower<a class="anchor" aria-label="anchor" href="#arg-first-cond-lower"></a></dt>
<dd><p>Condition for selecting range of data (before)</p>
<p>If this argument is specified, the other observations are restricted from
the first observation before the current observation where the specified
condition is fulfilled up to the current observation. If the condition is
not fulfilled for any of the other observations, no observations are
considered.</p>
<p>This argument should be specified if <code>filter_join</code> contains summary
functions which should not apply to all observations but only from a
certain observation before the current observation up to the current
observation. For an example see the last example below.</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted condition, e.g., <code>AVISIT == "BASELINE"</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-first-cond-upper">first_cond_upper<a class="anchor" aria-label="anchor" href="#arg-first-cond-upper"></a></dt>
<dd><p>Condition for selecting range of data (after)</p>
<p>If this argument is specified, the other observations are restricted up to
the first observation where the specified condition is fulfilled. If the
condition is not fulfilled for any of the other observations, no
observations are considered.</p>
<p>This argument should be specified if <code>filter_join</code> contains summary
functions which should not apply to all observations but only up to the
confirmation assessment. For an example see the last example below.</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted condition, e.g., <code>AVISIT == "BASELINE"</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-filter-join">filter_join<a class="anchor" aria-label="anchor" href="#arg-filter-join"></a></dt>
<dd><p>Filter for the joined dataset</p>
<p>The specified condition is applied to the joined dataset. Therefore
variables from both datasets <code>dataset</code> and <code>dataset_add</code> can be used.</p>
<p>Variables created by <code>order</code> or <code>new_vars</code> arguments can be used in the
condition.</p>
<p>The condition can include summary functions like <code><a href="https://rdrr.io/r/base/all.html" class="external-link">all()</a></code> or <code><a href="https://rdrr.io/r/base/any.html" class="external-link">any()</a></code>. The
joined dataset is grouped by the original observations.</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted condition, e.g., <code>AVISIT == "BASELINE"</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-missing-values">missing_values<a class="anchor" aria-label="anchor" href="#arg-missing-values"></a></dt>
<dd><p>Values for non-matching observations</p>
<p>For observations of the input dataset (<code>dataset</code>) which do not have a
matching observation in the additional dataset (<code>dataset_add</code>) the values
of the specified variables are set to the specified value. Only variables
specified for <code>new_vars</code> can be specified for <code>missing_values</code>.</p>
<dl><dt>Permitted values</dt>
<dd><p>list of named expressions created by a formula using <code><a href="reexport-exprs.html">exprs()</a></code>, e.g., <code>exprs(AVALC = VSSTRESC, AVAL = yn_to_numeric(AVALC))</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-check-type">check_type<a class="anchor" aria-label="anchor" href="#arg-check-type"></a></dt>
<dd><p>Check uniqueness?</p>
<p>If <code>"message"</code>, <code>"warning"</code> or <code>"error"</code> is specified, the specified
message is issued if the observations of the input dataset (<code>dataset</code>) or
the restricted additional dataset (<code>dataset_add</code> after applying
<code>filter_add</code>) are not unique with respect to the by variables and the
order.</p>
<p>The uniqueness is checked only if <code>tmp_obs_nr_var</code>, <code>first_cond_lower</code>,
or <code>first_cond_upper</code> is specified or <code>join_type</code> equals <code>"before"</code> or
<code>"after"</code>.</p>
<dl><dt>Permitted values</dt>
<dd><p><code>"none"</code>, <code>"message"</code>, <code>"warning"</code>, <code>"error"</code></p></dd>

<dt>Default value</dt>
<dd><p><code>"warning"</code></p></dd>


</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The output dataset contains all observations and variables of the
input dataset and additionally the variables specified for <code>new_vars</code>
derived from the additional dataset (<code>dataset_add</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<ol><li><p>The variables specified by <code>order</code> are added to the additional dataset
(<code>dataset_add</code>).</p></li>
<li><p>The variables specified by <code>join_vars</code> are added to the additional dataset
(<code>dataset_add</code>).</p></li>
<li><p>The records from the additional dataset (<code>dataset_add</code>) are restricted to
those matching the <code>filter_add</code> condition.</p></li>
<li><p>The input dataset and the (restricted) additional dataset are left joined
by the grouping variables (<code>by_vars</code>). If no grouping variables are
specified, a full join is performed.</p></li>
<li><p>If <code>first_cond_lower</code> is specified, for each observation of the input
dataset the joined dataset is restricted to observations from the first
observation where <code>first_cond_lower</code> is fulfilled (the observation fulfilling
the condition is included) up to the observation of the input dataset. If for
an observation of the input dataset the condition is not fulfilled, the
observation is removed.</p>
<p>If <code>first_cond_upper</code> is specified, for each observation of the input
dataset the joined dataset is restricted to observations up to the first
observation where <code>first_cond_upper</code> is fulfilled (the observation
fulfilling the condition is included). If for an observation of the input
dataset the condition is not fulfilled, the observation is removed.</p>
<p>For an example see the last example in the "Examples" section.</p></li>
<li><p>The joined dataset is restricted by the <code>filter_join</code> condition.</p></li>
<li><p>The variables specified for <code>new_vars</code> are created and merged to the input
dataset. I.e., the output dataset contains all observations from the input
dataset. For observations without a matching observation in the joined
dataset the new variables are set as specified by <code>missing_values</code> (or to
<code>NA</code> for variables not in <code>missing_values</code>). Observations in the additional
dataset which have no matching observation in the input dataset are ignored.</p></li>
</ol><p><strong>Note:</strong> This function creates temporary datasets which may be much bigger
than the input datasets. If this causes memory issues, please try setting
the admiral option <code>save_memory</code> to <code>TRUE</code> (see <code><a href="set_admiral_options.html">set_admiral_options()</a></code>).
This reduces the memory consumption but increases the run-time.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="derive_vars_joined.html">derive_vars_joined()</a></code>, <code><a href="derive_vars_merged_summary.html">derive_vars_merged_summary()</a></code>,
<code><a href="derive_var_joined_exist_flag.html">derive_var_joined_exist_flag()</a></code>, <code><a href="filter_joined.html">filter_joined()</a></code></p>
<p>General Derivation Functions for all ADaMs that returns variable appended to dataset:
<code><a href="derive_var_extreme_flag.html">derive_var_extreme_flag</a>()</code>,
<code><a href="derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a>()</code>,
<code><a href="derive_var_merged_ef_msrc.html">derive_var_merged_ef_msrc</a>()</code>,
<code><a href="derive_var_merged_exist_flag.html">derive_var_merged_exist_flag</a>()</code>,
<code><a href="derive_var_obs_number.html">derive_var_obs_number</a>()</code>,
<code><a href="derive_var_relative_flag.html">derive_var_relative_flag</a>()</code>,
<code><a href="derive_vars_cat.html">derive_vars_cat</a>()</code>,
<code><a href="derive_vars_computed.html">derive_vars_computed</a>()</code>,
<code><a href="derive_vars_joined.html">derive_vars_joined</a>()</code>,
<code><a href="derive_vars_merged.html">derive_vars_merged</a>()</code>,
<code><a href="derive_vars_merged_lookup.html">derive_vars_merged_lookup</a>()</code>,
<code><a href="derive_vars_merged_summary.html">derive_vars_merged_summary</a>()</code>,
<code><a href="derive_vars_transposed.html">derive_vars_transposed</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>



<p>The examples focus on the functionality specific to this function. For
examples of functionality common to all "joined" functions like
<code>filter_join</code>, <code>filter_add</code>, <code>join_vars</code>, ... please see the examples
of <code><a href="derive_vars_joined.html">derive_vars_joined()</a></code>.</p><div class="section">
<h3 id="derive-cumulative-dose-before-event-cumdosa-">Derive cumulative dose before event (<code>CUMDOSA</code>)<a class="anchor" aria-label="anchor" href="#derive-cumulative-dose-before-event-cumdosa-"></a></h3>


<p>Deriving the cumulative actual dose up to the day of the adverse event
in the <code>ADAE</code> dataset.</p><ul><li><p><code>USUBJID</code> is specified for <code>by_vars</code> to join the <code>ADAE</code> and the <code>ADEX</code>
dataset by subject.</p></li>
<li><p><code>filter_join</code> is specified to restrict the <code>ADEX</code> dataset to the days up
to the adverse event. <code>ADY.join</code> refers to the study day in <code>ADEX</code>.</p></li>
<li><p>The new variable <code>CUMDOSA</code> is defined by the <code>new_vars</code> argument. It is
set to the sum of <code>AVAL</code>.</p></li>
<li><p>As <code>ADY</code> from <code>ADEX</code> is used in <code>filter_join</code> (but not in <code>new_vars</code>), it
needs to be specified for <code>join_vars</code>.</p></li>
<li><p>The <code>join_type</code> is set to <code>"all"</code> to consider all records in the joined
dataset. <code>join_type = "before"</code> can't by used here because then doses at
the same day as the adverse event would be excluded.</p></li>
</ul><p></p><div class="sourceCode r"><pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ADY</span>, <span class="op">~</span><span class="va">AVAL</span>,</span>
<span>  <span class="st">"1"</span>,         <span class="fl">1</span>,    <span class="fl">10</span>,</span>
<span>  <span class="st">"1"</span>,         <span class="fl">8</span>,    <span class="fl">20</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">15</span>,    <span class="fl">10</span>,</span>
<span>  <span class="st">"2"</span>,         <span class="fl">8</span>,     <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">adae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ADY</span>, <span class="op">~</span><span class="va">AEDECOD</span>,</span>
<span>  <span class="st">"1"</span>,         <span class="fl">2</span>, <span class="st">"Fatigue"</span>,</span>
<span>  <span class="st">"1"</span>,         <span class="fl">9</span>, <span class="st">"Influenza"</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">15</span>, <span class="st">"Theft"</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">15</span>, <span class="st">"Fatigue"</span>,</span>
<span>  <span class="st">"2"</span>,         <span class="fl">4</span>, <span class="st">"Parasomnia"</span>,</span>
<span>  <span class="st">"3"</span>,         <span class="fl">2</span>, <span class="st">"Truancy"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_vars_joined_summary.html">derive_vars_joined_summary</a></span><span class="op">(</span></span>
<span>  dataset <span class="op">=</span> <span class="va">adae</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">adex</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">ADY.join</span> <span class="op">&lt;=</span> <span class="va">ADY</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADY</span><span class="op">)</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>CUMDOSA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">AVAL</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 Ã— 4</span></span>
<span><span class="co">#&gt;   USUBJID   ADY AEDECOD    CUMDOSA</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 1           2 Fatigue         10</span></span>
<span><span class="co">#&gt; 2 1           9 Influenza       30</span></span>
<span><span class="co">#&gt; 3 1          15 Theft           40</span></span>
<span><span class="co">#&gt; 4 1          15 Fatigue         40</span></span>
<span><span class="co">#&gt; 5 2           4 Parasomnia      NA</span></span>
<span><span class="co">#&gt; 6 3           2 Truancy         NA</span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="define-values-for-records-without-records-in-the-additional-dataset-missing-values-">Define values for records without records in the additional dataset (<code>missing_values</code>)<a class="anchor" aria-label="anchor" href="#define-values-for-records-without-records-in-the-additional-dataset-missing-values-"></a></h3>


<p>By default, the new variables are set to <code>NA</code> for records without
matching records in the restricted additional dataset. This can be changed
by specifying the <code>missing_values</code> argument.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/derive_vars_joined_summary.html">derive_vars_joined_summary</a></span><span class="op">(</span></span>
<span>  dataset <span class="op">=</span> <span class="va">adae</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">adex</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">ADY.join</span> <span class="op">&lt;=</span> <span class="va">ADY</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADY</span><span class="op">)</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>CUMDOSE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">AVAL</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  missing_values <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>CUMDOSE <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 Ã— 4</span></span>
<span><span class="co">#&gt;   USUBJID   ADY AEDECOD    CUMDOSE</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 1           2 Fatigue         10</span></span>
<span><span class="co">#&gt; 2 1           9 Influenza       30</span></span>
<span><span class="co">#&gt; 3 1          15 Theft           40</span></span>
<span><span class="co">#&gt; 4 1          15 Fatigue         40</span></span>
<span><span class="co">#&gt; 5 2           4 Parasomnia       0</span></span>
<span><span class="co">#&gt; 6 3           2 Truancy          0</span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="selecting-records-join-type-before-join-type-after-">Selecting records (<code>join_type = "before"</code>, <code>join_type = "after"</code>)<a class="anchor" aria-label="anchor" href="#selecting-records-join-type-before-join-type-after-"></a></h3>


<p>The <code>join_type</code> argument can be used to select records from the
additional dataset. For example, if <code>join_type = "before"</code> is specified,
only records before the current observation are selected. If <code>join_type = "after"</code> is specified, only records after the current observation are
selected.</p>
<p>To illustrate this, a variable (<code>SELECTED_DAYS</code>) is derived which contains
the selected days.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">DAY</span>,</span>
<span>  <span class="fl">1</span>,</span>
<span>  <span class="fl">2</span>,</span>
<span>  <span class="fl">3</span>,</span>
<span>  <span class="fl">4</span>,</span>
<span>  <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_vars_joined_summary.html">derive_vars_joined_summary</a></span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">mydata</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">DAY</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"before"</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>SELECTED_DAYS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">DAY</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 Ã— 2</span></span>
<span><span class="co">#&gt;     DAY SELECTED_DAYS</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2     2 1</span></span>
<span><span class="co">#&gt; 3     3 1, 2</span></span>
<span><span class="co">#&gt; 4     4 1, 2, 3</span></span>
<span><span class="co">#&gt; 5     5 1, 2, 3, 4</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_vars_joined_summary.html">derive_vars_joined_summary</a></span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">mydata</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">DAY</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>SELECTED_DAYS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">DAY</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 Ã— 2</span></span>
<span><span class="co">#&gt;     DAY SELECTED_DAYS</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1 2, 3, 4, 5</span></span>
<span><span class="co">#&gt; 2     2 3, 4, 5</span></span>
<span><span class="co">#&gt; 3     3 4, 5</span></span>
<span><span class="co">#&gt; 4     4 5</span></span>
<span><span class="co">#&gt; 5     5 &lt;NA&gt;         </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="selecting-records-first-cond-lower-first-cond-upper-">Selecting records (<code>first_cond_lower</code>, <code>first_cond_upper</code>)<a class="anchor" aria-label="anchor" href="#selecting-records-first-cond-lower-first-cond-upper-"></a></h3>


<p>The <code>first_cond_lower</code> and <code>first_cond_upper</code> arguments can be used to
restrict the joined dataset to a certain range of records. For example, if
<code>first_cond_lower</code> is specified, the joined dataset is restricted to the
last observation before the current record where the condition is
fulfilled.</p>
<p>Please note:</p><ul><li><p>If the condition is not fulfilled for any of the records, no records are
selected.</p></li>
<li><p>The restriction implied by <code>join_type</code> is applied first.</p></li>
<li><p>If a variable is contained in both <code>dataset</code> and <code>dataset_add</code> like <code>DAY</code>
in the example below, <code>DAY</code> refers to the value from <code>dataset</code> and
<code>DAY.join</code> to the value from <code>dataset_add</code>.</p></li>
</ul><p>To illustrate this, a variable (<code>SELECTED_DAYS</code>) is derived which contains
the selected days.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/derive_vars_joined_summary.html">derive_vars_joined_summary</a></span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">mydata</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">DAY</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"before"</span>,</span>
<span>  first_cond_lower <span class="op">=</span> <span class="va">DAY.join</span> <span class="op">==</span> <span class="fl">2</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>SELECTED_DAYS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">DAY</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 Ã— 2</span></span>
<span><span class="co">#&gt;     DAY SELECTED_DAYS</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2     2 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3     3 2</span></span>
<span><span class="co">#&gt; 4     4 2, 3</span></span>
<span><span class="co">#&gt; 5     5 2, 3, 4</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_vars_joined_summary.html">derive_vars_joined_summary</a></span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">mydata</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">DAY</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span>
<span>  first_cond_upper <span class="op">=</span> <span class="va">DAY.join</span> <span class="op">==</span> <span class="fl">4</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>SELECTED_DAYS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">DAY</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 Ã— 2</span></span>
<span><span class="co">#&gt;     DAY SELECTED_DAYS</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1 2, 3, 4</span></span>
<span><span class="co">#&gt; 2     2 3, 4</span></span>
<span><span class="co">#&gt; 3     3 4</span></span>
<span><span class="co">#&gt; 4     4 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5     5 &lt;NA&gt;</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_vars_joined_summary.html">derive_vars_joined_summary</a></span><span class="op">(</span></span>
<span>  <span class="va">mydata</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">mydata</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">DAY</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  first_cond_lower <span class="op">=</span> <span class="va">DAY.join</span> <span class="op">==</span> <span class="fl">2</span>,</span>
<span>  first_cond_upper <span class="op">=</span> <span class="va">DAY.join</span> <span class="op">==</span> <span class="fl">4</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>SELECTED_DAYS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">DAY</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 Ã— 2</span></span>
<span><span class="co">#&gt;     DAY SELECTED_DAYS</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1     1 2, 3, 4</span></span>
<span><span class="co">#&gt; 2     2 2, 3, 4</span></span>
<span><span class="co">#&gt; 3     3 2, 3, 4</span></span>
<span><span class="co">#&gt; 4     4 2, 3, 4</span></span>
<span><span class="co">#&gt; 5     5 2, 3, 4      </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="derive-weekly-score-if-enough-assessments-are-available">Derive weekly score if enough assessments are available<a class="anchor" aria-label="anchor" href="#derive-weekly-score-if-enough-assessments-are-available"></a></h3>


<p>For each planned visit the average score within the week before the
visit should be derived if at least three assessments are available.</p>
<p>Please note that the condition for the number of assessments is specified
in <code>new_vars</code> and not in <code>filter_join</code>. This is because the number of
assessments within the week before the visit should be counted but not the
number of assessments available for the subject.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">planned_visits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">AVISIT</span>,  <span class="op">~</span><span class="va">ADY</span>,</span>
<span>  <span class="st">"WEEK 1"</span>,    <span class="fl">8</span>,</span>
<span>  <span class="st">"WEEK 4"</span>,   <span class="fl">29</span>,</span>
<span>  <span class="st">"WEEK 8"</span>,   <span class="fl">57</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>USUBJID <span class="op">=</span> <span class="st">"1"</span>, .before <span class="op">=</span> <span class="va">AVISIT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">ADY</span>, <span class="op">~</span><span class="va">AVAL</span>,</span>
<span>     <span class="fl">1</span>,    <span class="fl">10</span>,</span>
<span>     <span class="fl">2</span>,    <span class="fl">12</span>,</span>
<span>     <span class="fl">4</span>,     <span class="fl">9</span>,</span>
<span>     <span class="fl">5</span>,     <span class="fl">9</span>,</span>
<span>     <span class="fl">7</span>,    <span class="fl">10</span>,</span>
<span>    <span class="fl">25</span>,    <span class="fl">11</span>,</span>
<span>    <span class="fl">27</span>,    <span class="fl">10</span>,</span>
<span>    <span class="fl">29</span>,    <span class="fl">10</span>,</span>
<span>    <span class="fl">41</span>,     <span class="fl">8</span>,</span>
<span>    <span class="fl">42</span>,     <span class="fl">9</span>,</span>
<span>    <span class="fl">44</span>,     <span class="fl">5</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>USUBJID <span class="op">=</span> <span class="st">"1"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_vars_joined_summary.html">derive_vars_joined_summary</a></span><span class="op">(</span></span>
<span>  <span class="va">planned_visits</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">adqs</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">ADY</span> <span class="op">-</span> <span class="fl">7</span> <span class="op">&lt;=</span> <span class="va">ADY.join</span> <span class="op">&amp;</span> <span class="va">ADY.join</span> <span class="op">&lt;</span> <span class="va">ADY</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADY</span><span class="op">)</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>AVAL <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">AVAL</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 Ã— 4</span></span>
<span><span class="co">#&gt;   USUBJID AVISIT   ADY  AVAL</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 1       WEEK 1     8    10</span></span>
<span><span class="co">#&gt; 2 1       WEEK 4    29    NA</span></span>
<span><span class="co">#&gt; 3 1       WEEK 8    57    NA</span></span></code></pre><p></p></div>
</div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by F. Hoffmann-La Roche AG, GlaxoSmithKline LLC, Ben Straub, Stefan Bundfuss, Arianna Cascone, Jeffrey Dickinson, Ross Farrugia, Fanny Gautier, G Gayatri, Solveig Holmgaard, Dinakar Kulkarni, Edoardo Mancini, Gordon Miller, Lina Patil, Jim Rothstein, Daniel Sjoberg, Stefan Thoma, Junze Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

