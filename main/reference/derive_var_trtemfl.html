<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Derive Treatment-emergent Flag â€” derive_var_trtemfl â€¢ admiral</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Derive Treatment-emergent Flag â€” derive_var_trtemfl"><meta name="description" content="Derive treatment emergent analysis flag (e.g., TRTEMFL)."><meta property="og:description" content="Derive treatment emergent analysis flag (e.g., TRTEMFL)."><meta property="og:image" content="https:/pharmaverse.github.io/admiral/main/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">admiral</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started"><li><a class="dropdown-item" href="../articles/admiral.html">Get Started</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/pharmaverse/admiral/blob/main/inst/cheatsheet/admiral_cheatsheet.pdf">Cheatsheet</a></li>
    <li><a class="external-link dropdown-item" href="https://pharmaverse.github.io/admiraldiscovery/articles/presentation_archive.html">Presentation Archive</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides"><li><h6 class="dropdown-header" data-toc-skip>General Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/concepts_conventions.html">Programming Concepts and Conventions</a></li>
    <li><a class="dropdown-item" href="../articles/generic.html">Generic Derivations</a></li>
    <li><a class="dropdown-item" href="../articles/higher_order.html">Higher Order Functions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>ADaM Script Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/adsl.html">Creating a Basic ADSL</a></li>
    <li><a class="dropdown-item" href="../articles/occds.html">Creating an OCCDS ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_finding.html">Creating a BDS Findings ADAM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_exposure.html">Creating a BDS Exposure ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_tte.html">Creating a BDS Time-to-Event ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/questionnaires.html">Creating Questionnaire ADaMs</a></li>
    <li><a class="dropdown-item" href="../articles/pk_adnca.html">Creating a PK NCA or Population PK ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/hys_law.html">Hy's Law Implementation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Special Topics Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/imputation.html">Date and Time Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/visits_periods.html">Visit and Period Variables</a></li>
    <li><a class="dropdown-item" href="../articles/queries_dataset.html">Queries Dataset Documentation</a></li>
    <li><a class="dropdown-item" href="../articles/lab_grading.html">Lab Grading</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.github.io/admiraldiscovery/articles/reactable.html">ðŸ”Ž Find my function</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.slack.com/" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/issues/new/choose" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Derive Treatment-emergent Flag</h1>
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiral/blob/main/R/derive_var_trtemfl.R" class="external-link"><code>R/derive_var_trtemfl.R</code></a></small>
      <div class="d-none name"><code>derive_var_trtemfl.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Derive treatment emergent analysis flag (e.g., <code>TRTEMFL</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">derive_var_trtemfl</span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">TRTEMFL</span>,</span>
<span>  start_date <span class="op">=</span> <span class="va">ASTDTM</span>,</span>
<span>  end_date <span class="op">=</span> <span class="va">AENDTM</span>,</span>
<span>  trt_start_date <span class="op">=</span> <span class="va">TRTSDTM</span>,</span>
<span>  trt_end_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  end_window <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ignore_time_for_trt_end <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  initial_intensity <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  intensity <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subject_keys <span class="op">=</span> <span class="fu"><a href="get_admiral_option.html">get_admiral_option</a></span><span class="op">(</span><span class="st">"subject_keys"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dataset">dataset<a class="anchor" aria-label="anchor" href="#arg-dataset"></a></dt>
<dd><p>Input dataset</p>
<p>The variables specified by <code>start_date</code>, <code>end_date</code>, <code>trt_start_date</code>,
<code>trt_end_date</code>, <code>initial_intensity</code>, and <code>intensity</code> are expected.</p>
<dl><dt>Permitted values</dt>
<dd><p>a dataset, i.e., a <code>data.frame</code> or tibble</p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-new-var">new_var<a class="anchor" aria-label="anchor" href="#arg-new-var"></a></dt>
<dd><p>New variable</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted symbol, e.g., <code>AVAL</code></p></dd>

<dt>Default value</dt>
<dd><p><code>TRTEMFL</code></p></dd>


</dl></dd>


<dt id="arg-start-date">start_date<a class="anchor" aria-label="anchor" href="#arg-start-date"></a></dt>
<dd><p>Event start date</p>
<dl><dt>Permitted values</dt>
<dd><p>a date or datetime variable</p></dd>

<dt>Default value</dt>
<dd><p><code>ASTDTM</code></p></dd>


</dl></dd>


<dt id="arg-end-date">end_date<a class="anchor" aria-label="anchor" href="#arg-end-date"></a></dt>
<dd><p>Event end date</p>
<dl><dt>Permitted values</dt>
<dd><p>a date or datetime variable</p></dd>

<dt>Default value</dt>
<dd><p><code>AENDTM</code></p></dd>


</dl></dd>


<dt id="arg-trt-start-date">trt_start_date<a class="anchor" aria-label="anchor" href="#arg-trt-start-date"></a></dt>
<dd><p>Treatment start date</p>
<dl><dt>Permitted values</dt>
<dd><p>a date or datetime variable</p></dd>

<dt>Default value</dt>
<dd><p><code>TRTSDTM</code></p></dd>


</dl></dd>


<dt id="arg-trt-end-date">trt_end_date<a class="anchor" aria-label="anchor" href="#arg-trt-end-date"></a></dt>
<dd><p>Treatment end date</p>
<dl><dt>Permitted values</dt>
<dd><p>a date or datetime variable</p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-end-window">end_window<a class="anchor" aria-label="anchor" href="#arg-end-window"></a></dt>
<dd><p>If the argument is specified (in 'days'), events starting more than the specified
number of days after end of treatment, are not flagged.</p>
<dl><dt>Permitted values</dt>
<dd><p>a positive integer, e.g. <code>2</code> or <code>5</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-ignore-time-for-trt-end">ignore_time_for_trt_end<a class="anchor" aria-label="anchor" href="#arg-ignore-time-for-trt-end"></a></dt>
<dd><p>If the argument is set to <code>TRUE</code>, the time part is ignored for checking if
the event occurred more than <code>end_window</code> days after end of treatment.</p>
<dl><dt>Permitted values</dt>
<dd><p><code>"TRUE"</code>, <code>"FALSE"</code></p></dd>

<dt>Default value</dt>
<dd><p><code>TRUE</code></p></dd>


</dl></dd>


<dt id="arg-initial-intensity">initial_intensity<a class="anchor" aria-label="anchor" href="#arg-initial-intensity"></a></dt>
<dd><p>Initial severity/intensity or toxicity</p>
<p><code>initial_intensity</code> is ignored when <code>group_var</code> is specified.</p>
<p>If this argument is specified and <code>group_var</code> is <code>NULL</code>, events which start
before treatment start and end after treatment start (or are ongoing) and
worsened (i.e., the intensity is greater than the initial intensity), are
flagged.</p>
<p>The values of the specified variable must be comparable with the usual
comparison operators. I.e., if the intensity is greater than the initial
intensity <code>initial_intensity &lt; intensity</code> must evaluate to <code>TRUE</code>.</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted symbol, e.g., <code>AVAL</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-intensity">intensity<a class="anchor" aria-label="anchor" href="#arg-intensity"></a></dt>
<dd><p>Severity/intensity or toxicity</p>
<p>If the argument is specified, events which start before treatment start and
end after treatment start (or are ongoing) and worsened (i.e., the
intensity is greater than the initial intensity), are flagged.</p>
<p>The values of the specified variable must be comparable with the usual
comparison operators. I.e., if the intensity is greater than the initial
intensity <code>initial_intensity &lt; intensity</code> must evaluate to <code>TRUE</code>.</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted symbol, e.g., <code>AVAL</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-group-var">group_var<a class="anchor" aria-label="anchor" href="#arg-group-var"></a></dt>
<dd><p>Grouping variable</p>
<p>If the argument is specified, it assumes that AEs are recorded as one episode
of AE with multiple lines using a grouping variable.</p>
<p>Events starting during treatment or before treatment and worsening afterward
are flagged. Once an AE record in a group is flagged, all subsequent records
in the treatment window are flagged regardless of severity.</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted symbol, e.g., <code>AVAL</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-subject-keys">subject_keys<a class="anchor" aria-label="anchor" href="#arg-subject-keys"></a></dt>
<dd><p>Variables to uniquely identify a subject.</p>
<p>This argument is only used when <code>group_var</code> is specified.</p>
<dl><dt>Permitted values</dt>
<dd><p>list of variables created by <code><a href="reexport-exprs.html">exprs()</a></code>, e.g., <code>exprs(USUBJID, VISIT)</code></p></dd>

<dt>Default value</dt>
<dd><p><code>get_admiral_option("subject_keys")</code></p></dd>


</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The input dataset with the variable specified by <code>new_var</code> added</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For the derivation of the new variable the following cases are
considered in this order. The first case which applies, defines the value
of the variable.</p><ul><li><p><em>not treated</em>: If <code>trt_start_date</code> is <code>NA</code>, it is set to <code>NA_character_</code>.</p></li>
<li><p><em>event before treatment</em>: If <code>end_date</code> is before <code>trt_start_date</code> (and
<code>end_date</code> is not <code>NA</code>), it is set to <code>NA_character_</code>.</p></li>
<li><p><em>no event date</em>: If <code>start_date</code> is <code>NA</code>, it is set to <code>"Y"</code> as in such
cases it is usually considered more conservative to assume the event was
treatment-emergent.</p></li>
<li><p><em>event started during treatment</em>:</p><ul><li><p>if <code>end_window</code> is not specified:
if <code>start_date</code> is on or after <code>trt_start_date</code>, it is set to <code>"Y"</code>,</p></li>
<li><p>if <code>end_window</code> is specified:
if <code>start_date</code> is on or after <code>trt_start_date</code> and <code>start_date</code> is on
or before <code>trt_end_date</code> + <code>end_window</code> days, it is set to <code>"Y"</code>,</p></li>
</ul></li>
<li><p><em>event started before treatment and (possibly) worsened on treatment</em>:</p><ul><li><p>if <code>initial_intensity</code>, <code>intensity</code> is specified and <code>group_var</code> is not specified:
if <code>initial_intensity &lt; intensity</code> and <code>start_date</code> is before <code>trt_start_date</code>
and <code>end_date</code> is on or after <code>trt_start_date</code> or <code>end_date</code> is <code>NA</code>, it
is set to <code>"Y"</code>;</p></li>
<li><p>if <code>group_var</code> is specified:
if <code>intensity</code> at treatment start &lt; <code>intensity</code> and <code>start_date</code> is after
<code>trt_start_date</code> and <code>end_date</code> is on or after <code>trt_start_date</code> or
<code>end_date</code> is <code>NA</code>, it is set to <code>"Y"</code>;</p></li>
</ul></li>
<li><p>Otherwise it is set to <code>NA_character_</code>.</p></li>
</ul><p>The behavior of <code>derive_var_trtemfl()</code> is aligned with the proposed
treatment-emergent AE assignment in the following
<a href="https://phuse.s3.eu-central-1.amazonaws.com/Deliverables/Safety+Analytics/WP-087+Recommended+Definition+of++Treatment-Emergent+Adverse+Events+in+Clinical+Trials+.pdf" class="external-link">PHUSE White Paper</a>.
See the final example in the examples section below.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>OCCDS Functions:
<code><a href="derive_vars_atc.html">derive_vars_atc</a>()</code>,
<code><a href="derive_vars_query.html">derive_vars_query</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>

<div class="section">
<h3 id="basic-treatment-emergent-flag">Basic treatment-emergent flag<a class="anchor" aria-label="anchor" href="#basic-treatment-emergent-flag"></a></h3>


<p>Derive <code>TRTEMFL</code> without considering treatment end and worsening</p><ul><li><p>For this basic example, all we are using are AE start/end dates and
comparing those against treatment start date.</p></li>
<li><p>If the AE started on or after treatment then we flag as treatment-emergent
(e.g. records 5-7).</p></li>
<li><p>If missing AE start date then we flag as treatment-emergent as worst case
(e.g. records 8, 11 and 13), unless we know that the AE end date was before
treatment so we can rule out this being treatment-emergent (e.g. record 12).</p></li>
<li><p>Any not treated subject would not get their AEs flagged as treatment-emergent
(e.g. records 14-16).</p></li>
</ul><p></p><div class="sourceCode r"><pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">adae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ASTDT</span>,            <span class="op">~</span><span class="va">AENDT</span>,            <span class="op">~</span><span class="va">AEITOXGR</span>, <span class="op">~</span><span class="va">AETOXGR</span>,</span>
<span>  <span class="co"># before treatment</span></span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-13"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-15"</span><span class="op">)</span>, <span class="st">"1"</span>,       <span class="st">"1"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-14"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-14"</span><span class="op">)</span>, <span class="st">"1"</span>,       <span class="st">"3"</span>,</span>
<span>  <span class="co"># starting before treatment and ending during treatment</span></span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-30"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-14"</span><span class="op">)</span>, <span class="st">"1"</span>,       <span class="st">"3"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-31"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>, <span class="st">"1"</span>,       <span class="st">"1"</span>,</span>
<span>  <span class="co"># starting during treatment</span></span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-02"</span><span class="op">)</span>, <span class="st">"3"</span>,       <span class="st">"4"</span>,</span>
<span>  <span class="co"># after treatment</span></span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-05-10"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-05-10"</span><span class="op">)</span>, <span class="st">"2"</span>,       <span class="st">"2"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-05-11"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-05-11"</span><span class="op">)</span>, <span class="st">"2"</span>,       <span class="st">"2"</span>,</span>
<span>  <span class="co"># missing dates</span></span>
<span>  <span class="st">"1"</span>,      <span class="cn">NA</span>,                <span class="cn">NA</span>,                <span class="st">"3"</span>,       <span class="st">"4"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-30"</span><span class="op">)</span>, <span class="cn">NA</span>,                <span class="st">"3"</span>,       <span class="st">"4"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-31"</span><span class="op">)</span>, <span class="cn">NA</span>,                <span class="st">"3"</span>,       <span class="st">"3"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="cn">NA</span>,                <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-04"</span><span class="op">)</span>, <span class="st">"3"</span>,       <span class="st">"4"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="cn">NA</span>,                <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-24"</span><span class="op">)</span>, <span class="st">"3"</span>,       <span class="st">"4"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="cn">NA</span>,                <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-06-04"</span><span class="op">)</span>, <span class="st">"3"</span>,       <span class="st">"4"</span>,</span>
<span>  <span class="co"># without treatment</span></span>
<span>  <span class="st">"2"</span>,      <span class="cn">NA</span>,                <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-03"</span><span class="op">)</span>, <span class="st">"1"</span>,       <span class="st">"2"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-03"</span><span class="op">)</span>, <span class="st">"1"</span>,       <span class="st">"2"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-06"</span><span class="op">)</span>, <span class="cn">NA</span>,                <span class="st">"1"</span>,       <span class="st">"2"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    STUDYID <span class="op">=</span> <span class="st">"AB42"</span>,</span>
<span>    TRTSDT <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">USUBJID</span> <span class="op">==</span> <span class="st">"1"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    TRTEDT <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">USUBJID</span> <span class="op">==</span> <span class="st">"1"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-04-30"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_trtemfl.html">derive_var_trtemfl</a></span><span class="op">(</span></span>
<span>  <span class="va">adae</span>,</span>
<span>  start_date <span class="op">=</span> <span class="va">ASTDT</span>,</span>
<span>  end_date <span class="op">=</span> <span class="va">AENDT</span>,</span>
<span>  trt_start_date <span class="op">=</span> <span class="va">TRTSDT</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">TRTSDT</span>, <span class="va">ASTDT</span>, <span class="va">AENDT</span>, <span class="va">TRTEMFL</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 16 Ã— 5</span></span>
<span><span class="co">#&gt;    USUBJID TRTSDT     ASTDT      AENDT      TRTEMFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 1       2022-01-01 2021-12-13 2021-12-15 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 1       2022-01-01 2021-12-14 2021-12-14 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  3 1       2022-01-01 2021-12-30 2022-01-14 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  4 1       2022-01-01 2021-12-31 2022-01-01 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  5 1       2022-01-01 2022-01-01 2022-01-02 Y</span></span>
<span><span class="co">#&gt;  6 1       2022-01-01 2022-05-10 2022-05-10 Y</span></span>
<span><span class="co">#&gt;  7 1       2022-01-01 2022-05-11 2022-05-11 Y</span></span>
<span><span class="co">#&gt;  8 1       2022-01-01 NA         NA         Y</span></span>
<span><span class="co">#&gt;  9 1       2022-01-01 2021-12-30 NA         &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 1       2022-01-01 2021-12-31 NA         &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 1       2022-01-01 NA         2022-01-04 Y</span></span>
<span><span class="co">#&gt; 12 1       2022-01-01 NA         2021-12-24 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13 1       2022-01-01 NA         2022-06-04 Y</span></span>
<span><span class="co">#&gt; 14 2       NA         NA         2021-12-03 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 15 2       NA         2021-12-01 2021-12-03 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 16 2       NA         2021-12-06 NA         &lt;NA&gt;   </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="considering-treatment-end-date-trt-end-date-and-end-window-">Considering treatment end date (<code>trt_end_date</code> and <code>end_window</code>)<a class="anchor" aria-label="anchor" href="#considering-treatment-end-date-trt-end-date-and-end-window-"></a></h3>


<p>Derive <code>TRTEMFL</code> taking a treatment end window into account</p><ul><li><p>In addition to the treatment-emergent checks explained in the above
example, we now supply a treatment end date, <code>trt_end_date = TRTEDT</code> and
an end window, <code>end_window = 10</code>. With these, any AE which started on or
before treatment end date + 10 days is considered as treatment-emergent.
Otherwise, those starting after the treatment end window are no longer
flagged as treatment-emergent (e.g. record 7).</p></li>
</ul><p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/derive_var_trtemfl.html">derive_var_trtemfl</a></span><span class="op">(</span></span>
<span>  <span class="va">adae</span>,</span>
<span>  start_date <span class="op">=</span> <span class="va">ASTDT</span>,</span>
<span>  end_date <span class="op">=</span> <span class="va">AENDT</span>,</span>
<span>  trt_start_date <span class="op">=</span> <span class="va">TRTSDT</span>,</span>
<span>  trt_end_date <span class="op">=</span> <span class="va">TRTEDT</span>,</span>
<span>  end_window <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">TRTSDT</span>, <span class="va">TRTEDT</span>, <span class="va">ASTDT</span>, <span class="va">AENDT</span>, <span class="va">TRTEMFL</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 16 Ã— 6</span></span>
<span><span class="co">#&gt;    USUBJID TRTSDT     TRTEDT     ASTDT      AENDT      TRTEMFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 1       2022-01-01 2022-04-30 2021-12-13 2021-12-15 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 1       2022-01-01 2022-04-30 2021-12-14 2021-12-14 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  3 1       2022-01-01 2022-04-30 2021-12-30 2022-01-14 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  4 1       2022-01-01 2022-04-30 2021-12-31 2022-01-01 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  5 1       2022-01-01 2022-04-30 2022-01-01 2022-01-02 Y</span></span>
<span><span class="co">#&gt;  6 1       2022-01-01 2022-04-30 2022-05-10 2022-05-10 Y</span></span>
<span><span class="co">#&gt;  7 1       2022-01-01 2022-04-30 2022-05-11 2022-05-11 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 1       2022-01-01 2022-04-30 NA         NA         Y</span></span>
<span><span class="co">#&gt;  9 1       2022-01-01 2022-04-30 2021-12-30 NA         &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 1       2022-01-01 2022-04-30 2021-12-31 NA         &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 1       2022-01-01 2022-04-30 NA         2022-01-04 Y</span></span>
<span><span class="co">#&gt; 12 1       2022-01-01 2022-04-30 NA         2021-12-24 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13 1       2022-01-01 2022-04-30 NA         2022-06-04 Y</span></span>
<span><span class="co">#&gt; 14 2       NA         NA         NA         2021-12-03 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 15 2       NA         NA         2021-12-01 2021-12-03 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 16 2       NA         NA         2021-12-06 NA         &lt;NA&gt;   </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="considering-treatment-worsening-initial-intensity-and-intensity-">Considering treatment worsening (<code>initial_intensity</code> and <code>intensity</code>)<a class="anchor" aria-label="anchor" href="#considering-treatment-worsening-initial-intensity-and-intensity-"></a></h3>


<p>Derive a new variable named <code>TRTEM2FL</code> taking worsening after treatment
start into account</p><ul><li><p>We also now start look at changes in intensity following treatment start using
the <code>initial_intensity</code> and <code>intensity</code> arguments. This only impacts AEs
starting before treatment, and ending on or after treatment (or with missing
AE end date). We can additionally consider treatment-emergence for an
AE that was ongoing at the start of treatment which may have worsened
as a result of treatment,  i.e. the most extreme intensity is greater than
the initial intensity (e.g. records 3 and 9).</p></li>
</ul><p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/derive_var_trtemfl.html">derive_var_trtemfl</a></span><span class="op">(</span></span>
<span>  <span class="va">adae</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">TRTEM2FL</span>,</span>
<span>  start_date <span class="op">=</span> <span class="va">ASTDT</span>,</span>
<span>  end_date <span class="op">=</span> <span class="va">AENDT</span>,</span>
<span>  trt_start_date <span class="op">=</span> <span class="va">TRTSDT</span>,</span>
<span>  trt_end_date <span class="op">=</span> <span class="va">TRTEDT</span>,</span>
<span>  end_window <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  initial_intensity <span class="op">=</span> <span class="va">AEITOXGR</span>,</span>
<span>  intensity <span class="op">=</span> <span class="va">AETOXGR</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">TRTSDT</span>, <span class="va">ASTDT</span>, <span class="va">AENDT</span>, <span class="va">AEITOXGR</span>, <span class="va">AETOXGR</span>, <span class="va">TRTEM2FL</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 16 Ã— 7</span></span>
<span><span class="co">#&gt;    USUBJID TRTSDT     ASTDT      AENDT      AEITOXGR AETOXGR TRTEM2FL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 1       2022-01-01 2021-12-13 2021-12-15 1        1       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 1       2022-01-01 2021-12-14 2021-12-14 1        3       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  3 1       2022-01-01 2021-12-30 2022-01-14 1        3       Y</span></span>
<span><span class="co">#&gt;  4 1       2022-01-01 2021-12-31 2022-01-01 1        1       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  5 1       2022-01-01 2022-01-01 2022-01-02 3        4       Y</span></span>
<span><span class="co">#&gt;  6 1       2022-01-01 2022-05-10 2022-05-10 2        2       Y</span></span>
<span><span class="co">#&gt;  7 1       2022-01-01 2022-05-11 2022-05-11 2        2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 1       2022-01-01 NA         NA         3        4       Y</span></span>
<span><span class="co">#&gt;  9 1       2022-01-01 2021-12-30 NA         3        4       Y</span></span>
<span><span class="co">#&gt; 10 1       2022-01-01 2021-12-31 NA         3        3       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 1       2022-01-01 NA         2022-01-04 3        4       Y</span></span>
<span><span class="co">#&gt; 12 1       2022-01-01 NA         2021-12-24 3        4       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13 1       2022-01-01 NA         2022-06-04 3        4       Y</span></span>
<span><span class="co">#&gt; 14 2       NA         NA         2021-12-03 1        2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 15 2       NA         2021-12-01 2021-12-03 1        2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 16 2       NA         2021-12-06 NA         1        2       &lt;NA&gt;    </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="worsening-when-the-same-ae-is-collected-over-multiple-records-intensity-and-group-var-">Worsening when the same AE is collected over multiple records
(<code>intensity</code> and <code>group_var</code>)<a class="anchor" aria-label="anchor" href="#worsening-when-the-same-ae-is-collected-over-multiple-records-intensity-and-group-var-"></a></h3>


<p>Derive <code>TRTEMFL</code> taking worsening after treatment into account within a
grouping variable</p><ul><li><p>Firstly, to understand which records correspond to the same AE, we need
to supply a grouping variable (<code>group_var</code>). Then this example works in a
similar way to the above one, but here we don't have an initial intensity
so we have to use the intensity of the AE at the time of treatment start.
If an ongoing AE increases intensity after treatment start (i.e. worsens),
then from that point on the records are considered treatment-emergent,
unless after the treatment end window (e.g. records 4, 6 and 7).</p></li>
</ul><p></p><div class="sourceCode r"><pre><code><span><span class="va">adae2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ASTDT</span>,            <span class="op">~</span><span class="va">AENDT</span>,            <span class="op">~</span><span class="va">AETOXGR</span>, <span class="op">~</span><span class="va">AEGRPID</span>,</span>
<span>  <span class="co"># ongoing AE where intensity drops after treatment start</span></span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-31"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>, <span class="st">"3"</span>,      <span class="st">"1"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-02"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-11"</span><span class="op">)</span>, <span class="st">"2"</span>,      <span class="st">"1"</span>,</span>
<span>  <span class="co"># ongoing AE where intensity increases after treatment start</span></span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-31"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>, <span class="st">"1"</span>,      <span class="st">"2"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-02"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-11"</span><span class="op">)</span>, <span class="st">"2"</span>,      <span class="st">"2"</span>,</span>
<span>  <span class="co"># ongoing AE where intensity increases after treatment start and then drops</span></span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2021-12-31"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>, <span class="st">"1"</span>,      <span class="st">"3"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-02"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-11"</span><span class="op">)</span>, <span class="st">"2"</span>,      <span class="st">"3"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-12"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-15"</span><span class="op">)</span>, <span class="st">"1"</span>,      <span class="st">"3"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    STUDYID <span class="op">=</span> <span class="st">"AB42"</span>,</span>
<span>    TRTSDT <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">USUBJID</span> <span class="op">==</span> <span class="st">"1"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-01-01"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    TRTEDT <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">USUBJID</span> <span class="op">==</span> <span class="st">"1"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2022-04-30"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_trtemfl.html">derive_var_trtemfl</a></span><span class="op">(</span></span>
<span>  <span class="va">adae2</span>,</span>
<span>  start_date <span class="op">=</span> <span class="va">ASTDT</span>,</span>
<span>  end_date <span class="op">=</span> <span class="va">AENDT</span>,</span>
<span>  trt_start_date <span class="op">=</span> <span class="va">TRTSDT</span>,</span>
<span>  trt_end_date <span class="op">=</span> <span class="va">TRTEDT</span>,</span>
<span>  end_window <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  intensity <span class="op">=</span> <span class="va">AETOXGR</span>,</span>
<span>  group_var <span class="op">=</span> <span class="va">AEGRPID</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">TRTSDT</span>, <span class="va">ASTDT</span>, <span class="va">AENDT</span>, <span class="va">AETOXGR</span>, <span class="va">AEGRPID</span>, <span class="va">TRTEMFL</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 Ã— 7</span></span>
<span><span class="co">#&gt;   USUBJID TRTSDT     ASTDT      AENDT      AETOXGR AEGRPID TRTEMFL</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 1       2022-01-01 2021-12-31 2022-01-01 3       1       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2 1       2022-01-01 2022-01-02 2022-01-11 2       1       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3 1       2022-01-01 2021-12-31 2022-01-01 1       2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4 1       2022-01-01 2022-01-02 2022-01-11 2       2       Y</span></span>
<span><span class="co">#&gt; 5 1       2022-01-01 2021-12-31 2022-01-01 1       3       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6 1       2022-01-01 2022-01-02 2022-01-11 2       3       Y</span></span>
<span><span class="co">#&gt; 7 1       2022-01-01 2022-01-12 2022-01-15 1       3       Y      </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="further-examples-from-phuse-white-paper">Further Examples from PHUSE White Paper<a class="anchor" aria-label="anchor" href="#further-examples-from-phuse-white-paper"></a></h3>


<p>Here we present more cases (some new, some similar to the examples above)
which are aligned one-to-one with the scenarios in the
<a href="https://phuse.s3.eu-central-1.amazonaws.com/Deliverables/Safety+Analytics/WP-087+Recommended+Definition+of++Treatment-Emergent+Adverse+Events+in+Clinical+Trials+.pdf" class="external-link">PHUSE White Paper</a></p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">adae3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">TRTSDTM</span>, <span class="op">~</span><span class="va">TRTEDTM</span>, <span class="op">~</span><span class="va">ASTDTM</span>, <span class="op">~</span><span class="va">AENDTM</span>, <span class="op">~</span><span class="va">AEITOXGR</span>, <span class="op">~</span><span class="va">AETOXGR</span>,</span>
<span>  <span class="co"># Patient 1: Pre-treatment AE</span></span>
<span>  <span class="st">"1"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2020-12-20"</span>, <span class="st">"2020-12-21"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="co"># Patient 2: On-treatment AE</span></span>
<span>  <span class="st">"2"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2021-12-20"</span>, <span class="st">"2021-12-21"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="co"># Patient 3: Pre-treatment AE, then on-treatment AE at same intensity</span></span>
<span>  <span class="st">"3"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2020-12-20"</span>, <span class="st">"2020-12-21"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="st">"3"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2021-12-20"</span>, <span class="st">"2021-12-21"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="co"># Patient 4: Pre-treatment AE, then on-treatment AE at wors. intensity</span></span>
<span>  <span class="st">"4"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2020-12-20"</span>, <span class="st">"2020-12-21"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="st">"4"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2021-12-20"</span>, <span class="st">"2021-12-21"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>,</span>
<span>  <span class="co"># Patient 5: Pre-treatment AE, then on-treatment AE at impr. intensity</span></span>
<span>  <span class="st">"5"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2020-12-20"</span>, <span class="st">"2020-12-21"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="st">"5"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2021-12-20"</span>, <span class="st">"2021-12-21"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>,</span>
<span>  <span class="co"># Patient 6: AE starting pre-treatment, continuing on-treatment, then 2nd AE at same intensity</span></span>
<span>  <span class="st">"6"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2020-12-23"</span>, <span class="st">"2021-01-21"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="st">"6"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2021-12-20"</span>, <span class="st">"2021-12-21"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="co"># Patient 7: AE starting pre-treatment, continuing on-treatment, then 2nd AE at wors. intensity</span></span>
<span>  <span class="st">"7"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2020-12-23"</span>, <span class="st">"2021-01-21"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="st">"7"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2021-12-20"</span>, <span class="st">"2021-12-21"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>,</span>
<span>  <span class="co"># Patient 8: AE starting pre-treatment, continuing on-treatment, then 2nd AE at impr. intensity</span></span>
<span>  <span class="st">"8"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2020-12-23"</span>, <span class="st">"2021-01-21"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="st">"8"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2021-12-20"</span>, <span class="st">"2021-12-21"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>,</span>
<span>  <span class="co"># Patient 9: AE starting pre-treatment, continuing on-treatment, and no change in intensity</span></span>
<span>  <span class="st">"9"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2020-12-23"</span>, <span class="st">"2021-01-21"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="co"># Patient 10: AE starting pre-treatment, continuing on-treatment, and wors. intensity</span></span>
<span>  <span class="st">"10"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2020-12-23"</span>, <span class="st">"2021-01-21"</span>, <span class="st">"2"</span>, <span class="st">"4"</span>,</span>
<span>  <span class="co"># Patient 11: AE starting pre-treatment, continuing on-treatment, and impr. intensity</span></span>
<span>  <span class="st">"11"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2020-12-23"</span>, <span class="st">"2021-01-21"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>,</span>
<span>  <span class="co"># Patient 12: AE starting pre-treatment, worsening, then improving</span></span>
<span>  <span class="st">"12"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2020-12-23"</span>, <span class="st">"2021-01-21"</span>, <span class="st">"3"</span>, <span class="st">"2"</span>,</span>
<span>  <span class="co"># Patient 13: AE starting pre-treatment, improving, then worsening</span></span>
<span>  <span class="st">"13"</span>, <span class="st">"2021-01-01"</span>, <span class="st">"2021-12-31"</span>, <span class="st">"2020-12-23"</span>, <span class="st">"2021-01-21"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>,</span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ASTDTM <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="va">ASTDTM</span><span class="op">)</span>,</span>
<span>    AENDTM <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="va">AENDTM</span><span class="op">)</span>,</span>
<span>    TRTSDTM <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="va">TRTSDTM</span><span class="op">)</span>,</span>
<span>    TRTEDTM <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="va">TRTEDTM</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_trtemfl.html">derive_var_trtemfl</a></span><span class="op">(</span></span>
<span>  <span class="va">adae3</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">TRTEMFL</span>,</span>
<span>  trt_end_date <span class="op">=</span> <span class="va">TRTEDTM</span>,</span>
<span>  end_window <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  initial_intensity <span class="op">=</span> <span class="va">AEITOXGR</span>,</span>
<span>  intensity <span class="op">=</span> <span class="va">AETOXGR</span>,</span>
<span>  subject_keys <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">TRTSDTM</span>, <span class="va">TRTEDTM</span>, <span class="va">ASTDTM</span>, <span class="va">AENDTM</span>, <span class="va">AEITOXGR</span>, <span class="va">AETOXGR</span>, <span class="va">TRTEMFL</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 19 Ã— 8</span></span>
<span><span class="co">#&gt;    USUBJID TRTSDTM    TRTEDTM    ASTDTM     AENDTM     AEITOXGR AETOXGR TRTEMFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 1       2021-01-01 2021-12-31 2020-12-20 2020-12-21 2        2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 2       2021-01-01 2021-12-31 2021-12-20 2021-12-21 2        2       Y</span></span>
<span><span class="co">#&gt;  3 3       2021-01-01 2021-12-31 2020-12-20 2020-12-21 2        2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  4 3       2021-01-01 2021-12-31 2021-12-20 2021-12-21 2        2       Y</span></span>
<span><span class="co">#&gt;  5 4       2021-01-01 2021-12-31 2020-12-20 2020-12-21 2        2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  6 4       2021-01-01 2021-12-31 2021-12-20 2021-12-21 2        3       Y</span></span>
<span><span class="co">#&gt;  7 5       2021-01-01 2021-12-31 2020-12-20 2020-12-21 2        2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 5       2021-01-01 2021-12-31 2021-12-20 2021-12-21 2        1       Y</span></span>
<span><span class="co">#&gt;  9 6       2021-01-01 2021-12-31 2020-12-23 2021-01-21 2        2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 6       2021-01-01 2021-12-31 2021-12-20 2021-12-21 2        2       Y</span></span>
<span><span class="co">#&gt; 11 7       2021-01-01 2021-12-31 2020-12-23 2021-01-21 2        2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12 7       2021-01-01 2021-12-31 2021-12-20 2021-12-21 2        3       Y</span></span>
<span><span class="co">#&gt; 13 8       2021-01-01 2021-12-31 2020-12-23 2021-01-21 2        2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 14 8       2021-01-01 2021-12-31 2021-12-20 2021-12-21 2        1       Y</span></span>
<span><span class="co">#&gt; 15 9       2021-01-01 2021-12-31 2020-12-23 2021-01-21 2        2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 16 10      2021-01-01 2021-12-31 2020-12-23 2021-01-21 2        4       Y</span></span>
<span><span class="co">#&gt; 17 11      2021-01-01 2021-12-31 2020-12-23 2021-01-21 2        1       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 18 12      2021-01-01 2021-12-31 2020-12-23 2021-01-21 3        2       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 19 13      2021-01-01 2021-12-31 2020-12-23 2021-01-21 1        2       Y      </span></span></code></pre><p></p></div>
</div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by F. Hoffmann-La Roche AG, GlaxoSmithKline LLC, Ben Straub, Stefan Bundfuss, Arianna Cascone, Jeffrey Dickinson, Ross Farrugia, Fanny Gautier, G Gayatri, Solveig Holmgaard, Dinakar Kulkarni, Edoardo Mancini, Gordon Miller, Jim Rothstein, Daniel Sjoberg, Stefan Thoma, Junze Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

