<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Derives a Flag Based on an Existing Flag â€” derive_var_joined_exist_flag â€¢ admiral</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Derives a Flag Based on an Existing Flag â€” derive_var_joined_exist_flag"><meta name="description" content="Derive a flag which depends on other observations of the dataset. For
example, flagging events which need to be confirmed by a second event."><meta property="og:description" content="Derive a flag which depends on other observations of the dataset. For
example, flagging events which need to be confirmed by a second event."><meta property="og:image" content="https:/pharmaverse.github.io/admiral/main/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">admiral</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.1.9005</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started"><li><a class="dropdown-item" href="../articles/admiral.html">Get Started</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/pharmaverse/admiral/blob/main/inst/cheatsheet/admiral_cheatsheet.pdf">Cheatsheet</a></li>
    <li><a class="external-link dropdown-item" href="https://pharmaverse.github.io/admiraldiscovery/articles/presentation_archive.html">Presentation Archive</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides"><li><h6 class="dropdown-header" data-toc-skip>General Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/concepts_conventions.html">Programming Concepts and Conventions</a></li>
    <li><a class="dropdown-item" href="../articles/generic.html">Generic Derivations</a></li>
    <li><a class="dropdown-item" href="../articles/higher_order.html">Higher Order Functions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>ADaM Script Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/adsl.html">Creating a Basic ADSL</a></li>
    <li><a class="dropdown-item" href="../articles/occds.html">Creating an OCCDS ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_finding.html">Creating a BDS Findings ADAM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_exposure.html">Creating a BDS Exposure ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_tte.html">Creating a BDS Time-to-Event ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/questionnaires.html">Creating Questionnaire ADaMs</a></li>
    <li><a class="dropdown-item" href="../articles/pk_adnca.html">Creating a PK NCA or Population PK ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/hys_law.html">Hy's Law Implementation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Special Topics Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/imputation.html">Date and Time Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/visits_periods.html">Visit and Period Variables</a></li>
    <li><a class="dropdown-item" href="../articles/queries_dataset.html">Queries Dataset Documentation</a></li>
    <li><a class="dropdown-item" href="../articles/lab_grading.html">Lab Grading</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.github.io/admiraldiscovery/articles/reactable.html">ðŸ”Ž Find my function</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.slack.com/" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/issues/new/choose" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Derives a Flag Based on an Existing Flag</h1>
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiral/blob/main/R/derive_var_joined_exist_flag.R" class="external-link"><code>R/derive_var_joined_exist_flag.R</code></a></small>
      <div class="d-none name"><code>derive_var_joined_exist_flag.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Derive a flag which depends on other observations of the dataset. For
example, flagging events which need to be confirmed by a second event.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">derive_var_joined_exist_flag</span><span class="op">(</span></span>
<span>  <span class="va">dataset</span>,</span>
<span>  <span class="va">dataset_add</span>,</span>
<span>  <span class="va">by_vars</span>,</span>
<span>  order <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">new_var</span>,</span>
<span>  tmp_obs_nr_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">join_vars</span>,</span>
<span>  <span class="va">join_type</span>,</span>
<span>  first_cond_lower <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  first_cond_upper <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  filter_add <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">filter_join</span>,</span>
<span>  true_value <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>  false_value <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>  check_type <span class="op">=</span> <span class="st">"warning"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dataset">dataset<a class="anchor" aria-label="anchor" href="#arg-dataset"></a></dt>
<dd><p>Input dataset</p>
<p>The variables specified by the <code>by_vars</code> and <code>join_vars</code> arguments are expected to be in the dataset.</p>
<dl><dt>Permitted values</dt>
<dd><p>a dataset, i.e., a <code>data.frame</code> or tibble</p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-dataset-add">dataset_add<a class="anchor" aria-label="anchor" href="#arg-dataset-add"></a></dt>
<dd><p>Additional dataset</p>
<p>The variables specified for <code>by_vars</code>, <code>join_vars</code>, and <code>order</code> are
expected.</p>
<dl><dt>Permitted values</dt>
<dd><p>a dataset, i.e., a <code>data.frame</code> or tibble</p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-by-vars">by_vars<a class="anchor" aria-label="anchor" href="#arg-by-vars"></a></dt>
<dd><p>Grouping variables</p>
<p>The specified variables are used for joining the input
dataset (<code>dataset</code>) with the additional dataset (<code>dataset_add</code>).</p>
<dl><dt>Permitted values</dt>
<dd><p>list of variables created by <code><a href="reexport-exprs.html">exprs()</a></code>, e.g., <code>exprs(USUBJID, VISIT)</code></p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-order">order<a class="anchor" aria-label="anchor" href="#arg-order"></a></dt>
<dd><p>Order</p>
<p>The observations are ordered by the specified order if <code>join_type = "after"</code>, <code>join_type = "before"</code>, <code>first_cond_lower</code>, <code>first_cond_upper</code>,
or <code>tmp_obs_nr_var</code> are specified.</p>
<p>For handling of <code>NA</code>s in sorting variables see the "Sort Order" section in <code><a href="../articles/generic.html">vignette("generic")</a></code>.</p>
<dl><dt>Permitted values</dt>
<dd><p>list of variables created by <code><a href="reexport-exprs.html">exprs()</a></code>, e.g., <code>exprs(USUBJID, VISIT)</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-new-var">new_var<a class="anchor" aria-label="anchor" href="#arg-new-var"></a></dt>
<dd><p>New variable</p>
<p>The specified variable is added to the input dataset.</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted symbol, e.g., <code>AVAL</code></p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-tmp-obs-nr-var">tmp_obs_nr_var<a class="anchor" aria-label="anchor" href="#arg-tmp-obs-nr-var"></a></dt>
<dd><p>Temporary observation number</p>
<p>The specified variable is added to the input dataset (<code>dataset</code>) and the
additional dataset (<code>dataset_add</code>). It is set to the observation number
with respect to <code>order</code>. For each by group (<code>by_vars</code>) the observation
number starts with <code>1</code>. If there is more than one record for specific
values for <code>by_vars</code> and <code>order</code>, all records get the same observation
number. By default, a warning (see <code>check_type</code>) is issued in this case.
The variable can be used in the conditions (<code>filter_join</code>,
<code>first_cond_upper</code>, <code>first_cond_lower</code>). It is not included in the output
dataset. It can also be used to flag consecutive observations or the last
observation (see last example below).</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted symbol, e.g., <code>AVAL</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-join-vars">join_vars<a class="anchor" aria-label="anchor" href="#arg-join-vars"></a></dt>
<dd><p>Variables to keep from joined dataset</p>
<p>The variables needed from the other observations should be specified
for this parameter. The specified variables are added to the joined dataset
with suffix ".join". For example to flag all observations with <code>AVALC == "Y"</code> and <code>AVALC == "Y"</code> for at least one subsequent visit <code>join_vars = exprs(AVALC, AVISITN)</code> and <code>filter_join = AVALC == "Y" &amp; AVALC.join == "Y" &amp; AVISITN &lt; AVISITN.join</code> could be specified.</p>
<p>The <code>*.join</code> variables are not included in the output dataset.</p>
<dl><dt>Permitted values</dt>
<dd><p>list of variables created by <code><a href="reexport-exprs.html">exprs()</a></code>, e.g., <code>exprs(USUBJID, VISIT)</code></p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-join-type">join_type<a class="anchor" aria-label="anchor" href="#arg-join-type"></a></dt>
<dd><p>Observations to keep after joining</p>
<p>The argument determines which of the joined observations are kept with
respect to the original observation. For example, if <code>join_type = "after"</code>
is specified all observations after the original observations are kept.</p>
<p>For example for confirmed response or BOR in the oncology setting or
confirmed deterioration in questionnaires the confirmatory assessment must
be after the assessment. Thus <code>join_type = "after"</code> could be used.</p>
<p>Whereas, sometimes you might allow for confirmatory observations to occur
prior to the observation. For example, to identify AEs occurring on or
after seven days before a COVID AE. Thus <code>join_type = "all"</code> could be used.</p>
<dl><dt>Permitted values</dt>
<dd><p><code>"before"</code>, <code>"after"</code>, <code>"all"</code></p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-first-cond-lower">first_cond_lower<a class="anchor" aria-label="anchor" href="#arg-first-cond-lower"></a></dt>
<dd><p>Condition for selecting range of data (before)</p>
<p>If this argument is specified, the other observations are restricted from
the first observation before the current observation where the specified
condition is fulfilled up to the current observation. If the condition is
not fulfilled for any of the other observations, no observations are
considered, i.e., the observation is not flagged.</p>
<p>This parameter should be specified if <code>filter_join</code> contains summary
functions which should not apply to all observations but only from a
certain observation before the current observation up to the current
observation. For an example see the last example below.</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted condition, e.g., <code>AVISIT == "BASELINE"</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-first-cond-upper">first_cond_upper<a class="anchor" aria-label="anchor" href="#arg-first-cond-upper"></a></dt>
<dd><p>Condition for selecting range of data (after)</p>
<p>If this argument is specified, the other observations are restricted up to
the first observation where the specified condition is fulfilled. If the
condition is not fulfilled for any of the other observations, no
observations are considered, i.e., the observation is not flagged.</p>
<p>This parameter should be specified if <code>filter_join</code> contains summary
functions which should not apply to all observations but only up to the
confirmation assessment. For an example see the third example below.</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted condition, e.g., <code>AVISIT == "BASELINE"</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-filter-add">filter_add<a class="anchor" aria-label="anchor" href="#arg-filter-add"></a></dt>
<dd><p>Filter for additional dataset (<code>dataset_add</code>)</p>
<p>Only observations from <code>dataset_add</code> fulfilling the specified condition are
joined to the input dataset. If the argument is not specified, all
observations are joined.</p>
<p>Variables created by <code>order</code> or <code>new_vars</code> arguments can be used in the
condition.</p>
<p>The condition can include summary functions like <code><a href="https://rdrr.io/r/base/all.html" class="external-link">all()</a></code> or <code><a href="https://rdrr.io/r/base/any.html" class="external-link">any()</a></code>. The
additional dataset is grouped by the by variables (<code>by_vars</code>).</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted condition, e.g., <code>AVISIT == "BASELINE"</code></p></dd>

<dt>Default value</dt>
<dd><p><code>NULL</code></p></dd>


</dl></dd>


<dt id="arg-filter-join">filter_join<a class="anchor" aria-label="anchor" href="#arg-filter-join"></a></dt>
<dd><p>Condition for selecting observations</p>
<p>The filter is applied to the joined dataset for flagging the confirmed
observations. The condition can include summary functions like <code><a href="https://rdrr.io/r/base/all.html" class="external-link">all()</a></code> or
<code><a href="https://rdrr.io/r/base/any.html" class="external-link">any()</a></code>. The joined dataset is grouped by the original observations. I.e.,
the summary function are applied to all observations up to the confirmation
observation. For example, <code>filter_join = AVALC == "CR" &amp; all(AVALC.join %in% c("CR", "NE")) &amp; count_vals(var = AVALC.join, val = "NE") &lt;= 1</code>
selects observations with response "CR" and for all observations up to the
confirmation observation the response is "CR" or "NE" and there is at most
one "NE".</p>
<dl><dt>Permitted values</dt>
<dd><p>an unquoted condition, e.g., <code>AVISIT == "BASELINE"</code></p></dd>

<dt>Default value</dt>
<dd><p>none</p></dd>


</dl></dd>


<dt id="arg-true-value">true_value<a class="anchor" aria-label="anchor" href="#arg-true-value"></a></dt>
<dd><p>Value of <code>new_var</code> for flagged observations</p>
<dl><dt>Permitted values</dt>
<dd><p>a character scalar, i.e., a character vector of length one</p></dd>

<dt>Default value</dt>
<dd><p><code>"Y"</code></p></dd>


</dl></dd>


<dt id="arg-false-value">false_value<a class="anchor" aria-label="anchor" href="#arg-false-value"></a></dt>
<dd><p>Value of <code>new_var</code> for observations not flagged</p>
<dl><dt>Permitted values</dt>
<dd><p>a character scalar, i.e., a character vector of length one</p></dd>

<dt>Default value</dt>
<dd><p><code>NA_character_</code></p></dd>


</dl></dd>


<dt id="arg-check-type">check_type<a class="anchor" aria-label="anchor" href="#arg-check-type"></a></dt>
<dd><p>Check uniqueness?</p>
<p>If <code>"message"</code>, <code>"warning"</code>, or <code>"error"</code> is specified, the specified
message is issued if the observations of the input dataset are not unique
with respect to the by variables and the order.</p>
<dl><dt>Permitted values</dt>
<dd><p><code>"none"</code>, <code>"message"</code>, <code>"warning"</code>, <code>"error"</code></p></dd>

<dt>Default value</dt>
<dd><p><code>"warning"</code></p></dd>


</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The input dataset with the variable specified by <code>new_var</code> added.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>An example usage might be flagging if a patient received two required
medications within a certain timeframe of each other.</p>
<p>In the oncology setting, for example, the function could be used to flag if a
response value can be confirmed by an other assessment. This is commonly
used in endpoints such as best overall response.</p>
<p>The following steps are performed to produce the output dataset.</p><div class="section">
<h3 id="step-">Step 1<a class="anchor" aria-label="anchor" href="#step-"></a></h3>

<ul><li><p>The variables specified by <code>order</code> are added to the additional dataset
(<code>dataset_add</code>).</p></li>
<li><p>The variables specified by <code>join_vars</code> are added to the additional dataset
(<code>dataset_add</code>).</p></li>
<li><p>The records from the additional dataset (<code>dataset_add</code>) are restricted to
those matching the <code>filter_add</code> condition.</p></li>
</ul><p>The input dataset (<code>dataset</code>) is joined with the restricted additional
dataset by the variables specified for <code>by_vars</code>. From the additional
dataset only the variables specified for <code>join_vars</code> are kept. The suffix
".join" is added to those variables which also exist in the input dataset.</p>
<p>For example, for <code>by_vars = USUBJID</code>, <code>join_vars = exprs(AVISITN, AVALC)</code>
and input dataset and additional dataset</p>
<p></p><div class="sourceCode r"><pre><code># A tibble: 2 x 4
USUBJID AVISITN AVALC  AVAL
&lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1             1 Y         1
1             2 N         0
</code></pre><p></p></div>
<p>the joined dataset is</p>
<p></p><div class="sourceCode r"><pre><code>A tibble: 4 x 6
USUBJID AVISITN AVALC  AVAL AVISITN.join AVALC.join
&lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;
1             1 Y         1            1 Y
1             1 Y         1            2 N
1             2 N         0            1 Y
1             2 N         0            2 N
</code></pre><p></p></div>
</div>

<div class="section">
<h3 id="step--1">Step 2<a class="anchor" aria-label="anchor" href="#step--1"></a></h3>


<p>The joined dataset is restricted to observations with respect to
<code>join_type</code> and <code>order</code>.</p>
<p>The dataset from the example in the previous step with <code>join_type = "after"</code> and <code>order = exprs(AVISITN)</code> is restricted to</p>
<p></p><div class="sourceCode r"><pre><code>A tibble: 4 x 6
USUBJID AVISITN AVALC  AVAL AVISITN.join AVALC.join
&lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;
1             1 Y         1            2 N
</code></pre><p></p></div>
</div>

<div class="section">
<h3 id="step--2">Step 3<a class="anchor" aria-label="anchor" href="#step--2"></a></h3>


<p>If <code>first_cond_lower</code> is specified, for each observation of the input
dataset the joined dataset is restricted to observations from the first
observation where <code>first_cond_lower</code> is fulfilled (the observation
fulfilling the condition is included) up to the observation of the input
dataset. If for an observation of the input dataset the condition is not
fulfilled, the observation is removed.</p>
<p>If <code>first_cond_upper</code> is specified, for each observation of the input
dataset the joined dataset is restricted to observations up to the first
observation where <code>first_cond_upper</code> is fulfilled (the observation
fulfilling the condition is included). If for an observation of the input
dataset the condition is not fulfilled, the observation is removed.</p>
<p>For examples see the "Examples" section.</p>
</div>

<div class="section">
<h3 id="step--3">Step 4<a class="anchor" aria-label="anchor" href="#step--3"></a></h3>


<p>The joined dataset is grouped by the observations from the input dataset
and restricted to the observations fulfilling the condition specified by
<code>filter_join</code>.</p>
</div>

<div class="section">
<h3 id="step--4">Step 5<a class="anchor" aria-label="anchor" href="#step--4"></a></h3>


<p>The first observation of each group is selected.</p>
</div>

<div class="section">
<h3 id="step--5">Step 6<a class="anchor" aria-label="anchor" href="#step--5"></a></h3>


<p>The variable specified by <code>new_var</code> is added to the input dataset. It is
set to <code>true_value</code> for all observations which were selected in the
previous step. For the other observations it is set to <code>false_value</code>.</p>
<p><strong>Note:</strong> This function creates temporary datasets which may be much bigger
than the input datasets. If this causes memory issues, please try setting
the admiral option <code>save_memory</code> to <code>TRUE</code> (see <code><a href="set_admiral_options.html">set_admiral_options()</a></code>).
This reduces the memory consumption but increases the run-time.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="filter_joined.html">filter_joined()</a></code>, <code><a href="derive_vars_joined.html">derive_vars_joined()</a></code></p>
<p>General Derivation Functions for all ADaMs that returns variable appended to dataset:
<code><a href="derive_var_extreme_flag.html">derive_var_extreme_flag</a>()</code>,
<code><a href="derive_var_merged_ef_msrc.html">derive_var_merged_ef_msrc</a>()</code>,
<code><a href="derive_var_merged_exist_flag.html">derive_var_merged_exist_flag</a>()</code>,
<code><a href="derive_var_merged_summary.html">derive_var_merged_summary</a>()</code>,
<code><a href="derive_var_obs_number.html">derive_var_obs_number</a>()</code>,
<code><a href="derive_var_relative_flag.html">derive_var_relative_flag</a>()</code>,
<code><a href="derive_vars_cat.html">derive_vars_cat</a>()</code>,
<code><a href="derive_vars_computed.html">derive_vars_computed</a>()</code>,
<code><a href="derive_vars_joined.html">derive_vars_joined</a>()</code>,
<code><a href="derive_vars_joined_summary.html">derive_vars_joined_summary</a>()</code>,
<code><a href="derive_vars_merged.html">derive_vars_merged</a>()</code>,
<code><a href="derive_vars_merged_lookup.html">derive_vars_merged_lookup</a>()</code>,
<code><a href="derive_vars_transposed.html">derive_vars_transposed</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>

<div class="section">
<h3 id="flag-records-considering-other-records-filter-join-join-vars-">Flag records considering other records (<code>filter_join</code>, <code>join_vars</code>)<a class="anchor" aria-label="anchor" href="#flag-records-considering-other-records-filter-join-join-vars-"></a></h3>


<p>In this example, records with a duration longer than 30 and where a
COVID AE (<code>ACOVFL == "Y"</code>) occurred before or up to seven days after the
record should be flagged. The condition for flagging the records is
specified by the <code>filter_join</code> argument. Variables from the other records
are referenced by variable names with the suffix <code>.join</code>. These variables
have to be specified for the <code>join_vars</code> argument. As records before <em>and</em>
after the current record should be considered, <code>join_type = "all"</code> is
specified.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">adae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ADY</span>, <span class="op">~</span><span class="va">ACOVFL</span>, <span class="op">~</span><span class="va">ADURN</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">10</span>, <span class="st">"N"</span>,          <span class="fl">1</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">21</span>, <span class="st">"N"</span>,         <span class="fl">50</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">23</span>, <span class="st">"Y"</span>,         <span class="fl">14</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">32</span>, <span class="st">"N"</span>,         <span class="fl">31</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">42</span>, <span class="st">"N"</span>,         <span class="fl">20</span>,</span>
<span>  <span class="st">"2"</span>,        <span class="fl">11</span>, <span class="st">"Y"</span>,         <span class="fl">13</span>,</span>
<span>  <span class="st">"2"</span>,        <span class="fl">23</span>, <span class="st">"N"</span>,          <span class="fl">2</span>,</span>
<span>  <span class="st">"3"</span>,        <span class="fl">13</span>, <span class="st">"Y"</span>,         <span class="fl">12</span>,</span>
<span>  <span class="st">"4"</span>,        <span class="fl">14</span>, <span class="st">"N"</span>,         <span class="fl">32</span>,</span>
<span>  <span class="st">"4"</span>,        <span class="fl">21</span>, <span class="st">"N"</span>,         <span class="fl">41</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">adae</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">adae</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">ALCOVFL</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ACOVFL</span>, <span class="va">ADY</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">ADURN</span> <span class="op">&gt;</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">ACOVFL.join</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">ADY.join</span> <span class="op">&lt;=</span> <span class="va">ADY</span> <span class="op">+</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 Ã— 5</span></span>
<span><span class="co">#&gt;    USUBJID   ADY ACOVFL ADURN ALCOVFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 1          10 N          1 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 1          21 N         50 Y</span></span>
<span><span class="co">#&gt;  3 1          23 Y         14 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  4 1          32 N         31 Y</span></span>
<span><span class="co">#&gt;  5 1          42 N         20 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  6 2          11 Y         13 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  7 2          23 N          2 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 3          13 Y         12 &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  9 4          14 N         32 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 4          21 N         41 &lt;NA&gt;   </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="considering-only-records-after-the-current-one-join-type-after-true-value-false-value-">Considering only records after the current one (<code>join_type = "after"</code>, <code>true_value</code>, <code>false_value</code>)<a class="anchor" aria-label="anchor" href="#considering-only-records-after-the-current-one-join-type-after-true-value-false-value-"></a></h3>


<p>In this example, records with <code>AVALC == "Y"</code> and <code>AVALC == "Y"</code> at a
subsequent visit should be flagged. <code>join_type = "after"</code> is specified to
consider only records after the current one. Please note that the <code>order</code>
argument must be specified, as otherwise it is not possible to determine
which records are after the current record.</p>
<p>Please note that a numeric flag is created here by specifying the
<code>true_value</code> and the <code>false_value</code> argument.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">AVISITN</span>, <span class="op">~</span><span class="va">AVALC</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">3</span>,        <span class="st">"Y"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">4</span>,        <span class="st">"N"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span>
<span>  <span class="st">"3"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span>
<span>  <span class="st">"4"</span>,      <span class="fl">1</span>,        <span class="st">"N"</span>,</span>
<span>  <span class="st">"4"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">data</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">CONFFLN</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVALC</span>, <span class="va">AVISITN</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">AVALC</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"Y"</span>,</span>
<span>  true_value <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  false_value <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 9 Ã— 4</span></span>
<span><span class="co">#&gt;   USUBJID AVISITN AVALC CONFFLN</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 1             1 Y           1</span></span>
<span><span class="co">#&gt; 2 1             2 N           0</span></span>
<span><span class="co">#&gt; 3 1             3 Y           0</span></span>
<span><span class="co">#&gt; 4 1             4 N           0</span></span>
<span><span class="co">#&gt; 5 2             1 Y           0</span></span>
<span><span class="co">#&gt; 6 2             2 N           0</span></span>
<span><span class="co">#&gt; 7 3             1 Y           0</span></span>
<span><span class="co">#&gt; 8 4             1 N           0</span></span>
<span><span class="co">#&gt; 9 4             2 N           0</span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="considering-a-range-of-records-only-first-cond-lower-first-cond-upper-">Considering a range of records only (<code>first_cond_lower</code>, <code>first_cond_upper</code>)<a class="anchor" aria-label="anchor" href="#considering-a-range-of-records-only-first-cond-lower-first-cond-upper-"></a></h3>


<p>Consider the following data.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">myd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">subj</span>, <span class="op">~</span><span class="va">day</span>, <span class="op">~</span><span class="va">val</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">1</span>, <span class="st">"++"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">2</span>, <span class="st">"-"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">3</span>, <span class="st">"0"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">4</span>, <span class="st">"+"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">5</span>, <span class="st">"++"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">6</span>, <span class="st">"-"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">1</span>, <span class="st">"-"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">2</span>, <span class="st">"++"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">3</span>, <span class="st">"+"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">4</span>, <span class="st">"0"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">5</span>, <span class="st">"-"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">6</span>, <span class="st">"++"</span></span>
<span><span class="op">)</span></span></code></pre><p></p></div>
<p>To flag <code>"0"</code> where all results from the first <code>"++"</code> before the <code>"0"</code>
up to the <code>"0"</code> (excluding the <code>"0"</code>) are <code>"+"</code> or <code>"++"</code> the
<code>first_cond_lower</code> argument and <code>join_type = "before"</code> are specified.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">myd</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">myd</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">subj</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">flag</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"before"</span>,</span>
<span>  first_cond_lower <span class="op">=</span> <span class="va">val.join</span> <span class="op">==</span> <span class="st">"++"</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">val</span> <span class="op">==</span> <span class="st">"0"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">val.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="st">"++"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 12 Ã— 4</span></span>
<span><span class="co">#&gt;    subj    day val   flag</span></span>
<span><span class="co">#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 1         1 ++    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 1         2 -     &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  3 1         3 0     &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  4 1         4 +     &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  5 1         5 ++    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  6 1         6 -     &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  7 2         1 -     &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 2         2 ++    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  9 2         3 +     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 2         4 0     Y</span></span>
<span><span class="co">#&gt; 11 2         5 -     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12 2         6 ++    &lt;NA&gt; </span></span></code></pre><p></p></div>
<p>To flag <code>"0"</code> where all results from the <code>"0"</code> (excluding the <code>"0"</code>) up
to the first <code>"++"</code> after the <code>"0"</code> are <code>"+"</code> or <code>"++"</code> the
<code>first_cond_upper</code> argument and <code>join_type = "after"</code> are specified.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">myd</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">myd</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">subj</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">flag</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span>
<span>  first_cond_upper <span class="op">=</span> <span class="va">val.join</span> <span class="op">==</span> <span class="st">"++"</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">val</span> <span class="op">==</span> <span class="st">"0"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">val.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="st">"++"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 12 Ã— 4</span></span>
<span><span class="co">#&gt;    subj    day val   flag</span></span>
<span><span class="co">#&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 1         1 ++    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 1         2 -     &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  3 1         3 0     Y</span></span>
<span><span class="co">#&gt;  4 1         4 +     &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  5 1         5 ++    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  6 1         6 -     &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  7 2         1 -     &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 2         2 ++    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  9 2         3 +     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 2         4 0     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 2         5 -     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12 2         6 ++    &lt;NA&gt; </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="considering-only-records-up-to-a-condition-first-cond-upper-">Considering only records up to a condition (<code>first_cond_upper</code>)<a class="anchor" aria-label="anchor" href="#considering-only-records-up-to-a-condition-first-cond-upper-"></a></h3>


<p>In this example from deriving confirmed response in oncology, the
records with</p><ul><li><p><code>AVALC == "CR"</code>,</p></li>
<li><p><code>AVALC == "CR"</code> at a subsequent visit,</p></li>
<li><p>only <code>"CR"</code> or <code>"NE"</code> in between, and</p></li>
<li><p>at most one <code>"NE"</code> in between</p></li>
</ul><p>should be flagged. The other records to be considered are restricted to those
up to the first occurrence of <code>"CR"</code> by specifying the <code>first_cond_upper</code>
argument. The <code><a href="count_vals.html">count_vals()</a></code> function is used to count the <code>"NE"</code>s for the
last condition.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">AVISITN</span>, <span class="op">~</span><span class="va">AVALC</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">1</span>,        <span class="st">"PR"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">2</span>,        <span class="st">"CR"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">3</span>,        <span class="st">"NE"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">4</span>,        <span class="st">"CR"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">5</span>,        <span class="st">"NE"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">1</span>,        <span class="st">"CR"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">2</span>,        <span class="st">"PR"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">3</span>,        <span class="st">"CR"</span>,</span>
<span>  <span class="st">"3"</span>,      <span class="fl">1</span>,        <span class="st">"CR"</span>,</span>
<span>  <span class="st">"4"</span>,      <span class="fl">1</span>,        <span class="st">"CR"</span>,</span>
<span>  <span class="st">"4"</span>,      <span class="fl">2</span>,        <span class="st">"NE"</span>,</span>
<span>  <span class="st">"4"</span>,      <span class="fl">3</span>,        <span class="st">"NE"</span>,</span>
<span>  <span class="st">"4"</span>,      <span class="fl">4</span>,        <span class="st">"CR"</span>,</span>
<span>  <span class="st">"4"</span>,      <span class="fl">5</span>,        <span class="st">"PR"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">data</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVALC</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">CONFFL</span>,</span>
<span>  first_cond_upper <span class="op">=</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"CR"</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">AVALC</span> <span class="op">==</span> <span class="st">"CR"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">AVALC.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"NE"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu"><a href="../reference/count_vals.html">count_vals</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">AVALC.join</span>, val <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 14 Ã— 4</span></span>
<span><span class="co">#&gt;    USUBJID AVISITN AVALC CONFFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 1             1 PR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 1             2 CR    Y</span></span>
<span><span class="co">#&gt;  3 1             3 NE    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  4 1             4 CR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  5 1             5 NE    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  6 2             1 CR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  7 2             2 PR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 2             3 CR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  9 3             1 CR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 4             1 CR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 4             2 NE    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12 4             3 NE    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13 4             4 CR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 14 4             5 PR    &lt;NA&gt;  </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="considering-order-of-values-min-cond-max-cond-">Considering order of values (<code><a href="min_cond.html">min_cond()</a></code>, <code><a href="max_cond.html">max_cond()</a></code>)<a class="anchor" aria-label="anchor" href="#considering-order-of-values-min-cond-max-cond-"></a></h3>


<p>In this example from deriving confirmed response in oncology, records
with</p><ul><li><p><code>AVALC == "PR"</code>,</p></li>
<li><p><code>AVALC == "CR"</code> or <code>AVALC == "PR"</code> at a subsequent visit at least 20 days later,</p></li>
<li><p>only <code>"CR"</code>, <code>"PR"</code>, or <code>"NE"</code> in between,</p></li>
<li><p>at most one <code>"NE"</code> in between, and</p></li>
<li><p><code>"CR"</code> is
not followed by <code>"PR"</code></p></li>
</ul><p>should be flagged. The last condition is realized by using <code><a href="min_cond.html">min_cond()</a></code> and
<code><a href="max_cond.html">max_cond()</a></code>, ensuring that the first occurrence of <code>"CR"</code> is after the last
occurrence of <code>"PR"</code>. The second call to <code><a href="count_vals.html">count_vals()</a></code> in the condition is
required to cover the case of no <code>"CR"</code>s (the <code><a href="min_cond.html">min_cond()</a></code> call returns <code>NA</code>
then).</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ADY</span>, <span class="op">~</span><span class="va">AVALC</span>,</span>
<span>  <span class="st">"1"</span>,         <span class="fl">6</span>, <span class="st">"PR"</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">12</span>, <span class="st">"CR"</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">24</span>, <span class="st">"NE"</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">32</span>, <span class="st">"CR"</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">48</span>, <span class="st">"PR"</span>,</span>
<span>  <span class="st">"2"</span>,         <span class="fl">3</span>, <span class="st">"PR"</span>,</span>
<span>  <span class="st">"2"</span>,        <span class="fl">21</span>, <span class="st">"CR"</span>,</span>
<span>  <span class="st">"2"</span>,        <span class="fl">33</span>, <span class="st">"PR"</span>,</span>
<span>  <span class="st">"3"</span>,        <span class="fl">11</span>, <span class="st">"PR"</span>,</span>
<span>  <span class="st">"4"</span>,         <span class="fl">7</span>, <span class="st">"PR"</span>,</span>
<span>  <span class="st">"4"</span>,        <span class="fl">12</span>, <span class="st">"NE"</span>,</span>
<span>  <span class="st">"4"</span>,        <span class="fl">24</span>, <span class="st">"NE"</span>,</span>
<span>  <span class="st">"4"</span>,        <span class="fl">32</span>, <span class="st">"PR"</span>,</span>
<span>  <span class="st">"4"</span>,        <span class="fl">55</span>, <span class="st">"PR"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">data</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVALC</span>, <span class="va">ADY</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADY</span><span class="op">)</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">CONFFL</span>,</span>
<span>  first_cond_upper <span class="op">=</span> <span class="va">AVALC.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"PR"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">ADY.join</span> <span class="op">-</span> <span class="va">ADY</span> <span class="op">&gt;=</span> <span class="fl">20</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">AVALC</span> <span class="op">==</span> <span class="st">"PR"</span> <span class="op">&amp;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">AVALC.join</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR"</span>, <span class="st">"PR"</span>, <span class="st">"NE"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu"><a href="../reference/count_vals.html">count_vals</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">AVALC.join</span>, val <span class="op">=</span> <span class="st">"NE"</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">1</span> <span class="op">&amp;</span></span>
<span>    <span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/min_cond.html">min_cond</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">ADY.join</span>, cond <span class="op">=</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"CR"</span><span class="op">)</span> <span class="op">&gt;</span></span>
<span>        <span class="fu"><a href="../reference/max_cond.html">max_cond</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">ADY.join</span>, cond <span class="op">=</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"PR"</span><span class="op">)</span> <span class="op">|</span></span>
<span>        <span class="fu"><a href="../reference/count_vals.html">count_vals</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">AVALC.join</span>, val <span class="op">=</span> <span class="st">"CR"</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 14 Ã— 4</span></span>
<span><span class="co">#&gt;    USUBJID   ADY AVALC CONFFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 1           6 PR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 1          12 CR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  3 1          24 NE    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  4 1          32 CR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  5 1          48 PR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  6 2           3 PR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  7 2          21 CR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 2          33 PR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  9 3          11 PR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 4           7 PR    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 11 4          12 NE    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 12 4          24 NE    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 13 4          32 PR    Y</span></span>
<span><span class="co">#&gt; 14 4          55 PR    &lt;NA&gt;  </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="considering-the-order-of-records-tmp-obs-nr-var-">Considering the order of records (<code>tmp_obs_nr_var</code>)<a class="anchor" aria-label="anchor" href="#considering-the-order-of-records-tmp-obs-nr-var-"></a></h3>


<p>In this example, the records with <code>CRIT1FL == "Y"</code> at two consecutive
visits or at the last visit should be flagged. A temporary order variable
is created by specifying the <code>tmp_obs_nr_var</code> argument. Then it is used in
<code>filter_join</code>. The temporary variable doesn't need to be specified for
<code>join_vars</code>.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">AVISITN</span>, <span class="op">~</span><span class="va">CRIT1FL</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">3</span>,        <span class="st">"Y"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">5</span>,        <span class="st">"N"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">3</span>,        <span class="st">"Y"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">5</span>,        <span class="st">"N"</span>,</span>
<span>  <span class="st">"3"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span>
<span>  <span class="st">"4"</span>,      <span class="fl">1</span>,        <span class="st">"Y"</span>,</span>
<span>  <span class="st">"4"</span>,      <span class="fl">2</span>,        <span class="st">"N"</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">data</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">CONFFL</span>,</span>
<span>  tmp_obs_nr_var <span class="op">=</span> <span class="va">tmp_obs_nr</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">CRIT1FL</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">CRIT1FL</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">CRIT1FL.join</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span></span>
<span>    <span class="op">(</span><span class="va">tmp_obs_nr</span> <span class="op">+</span> <span class="fl">1</span> <span class="op">==</span> <span class="va">tmp_obs_nr.join</span> <span class="op">|</span> <span class="va">tmp_obs_nr</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">tmp_obs_nr.join</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 Ã— 4</span></span>
<span><span class="co">#&gt;    USUBJID AVISITN CRIT1FL CONFFL</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 1             1 Y       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  2 1             2 N       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  3 1             3 Y       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  4 1             5 N       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  5 2             1 Y       Y</span></span>
<span><span class="co">#&gt;  6 2             3 Y       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  7 2             5 N       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;  8 3             1 Y       Y</span></span>
<span><span class="co">#&gt;  9 4             1 Y       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10 4             2 N       &lt;NA&gt;  </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="flag-each-dose-which-is-lower-than-the-previous-dose-tmp-obs-nr-var-">Flag each dose which is lower than the previous dose
(<code>tmp_obs_nr_var</code>)<a class="anchor" aria-label="anchor" href="#flag-each-dose-which-is-lower-than-the-previous-dose-tmp-obs-nr-var-"></a></h3>


<p></p><div class="sourceCode r"><pre><code><span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">EXSTDTM</span>,           <span class="op">~</span><span class="va">EXDOSE</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"2024-01-01T08:00"</span>,       <span class="fl">2</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"2024-01-02T08:00"</span>,       <span class="fl">4</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"2024-01-01T08:30"</span>,       <span class="fl">1</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"2024-01-02T08:30"</span>,       <span class="fl">4</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"2024-01-03T08:30"</span>,       <span class="fl">3</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"2024-01-04T08:30"</span>,       <span class="fl">2</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"2024-01-05T08:30"</span>,       <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">ex</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">ex</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">EXSTDTM</span><span class="op">)</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">DOSREDFL</span>,</span>
<span>  tmp_obs_nr_var <span class="op">=</span> <span class="va">tmp_dose_nr</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">EXDOSE</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"before"</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="op">(</span></span>
<span>    <span class="va">tmp_dose_nr</span> <span class="op">==</span> <span class="va">tmp_dose_nr.join</span> <span class="op">+</span> <span class="fl">1</span> <span class="co"># Look only at adjacent doses</span></span>
<span>    <span class="op">&amp;</span> <span class="va">EXDOSE</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">EXDOSE.join</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="co"># Both doses are valid</span></span>
<span>    <span class="op">&amp;</span> <span class="va">EXDOSE</span> <span class="op">&lt;</span> <span class="va">EXDOSE.join</span> <span class="co"># Dose is lower than previous</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 Ã— 4</span></span>
<span><span class="co">#&gt;   USUBJID EXSTDTM          EXDOSE DOSREDFL</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 1       2024-01-01T08:00      2 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2 1       2024-01-02T08:00      4 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3 2       2024-01-01T08:30      1 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4 2       2024-01-02T08:30      4 &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5 2       2024-01-03T08:30      3 Y</span></span>
<span><span class="co">#&gt; 6 2       2024-01-04T08:30      2 Y</span></span>
<span><span class="co">#&gt; 7 2       2024-01-05T08:30      2 &lt;NA&gt;    </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="derive-definitive-deterioration-flag">Derive definitive deterioration flag<a class="anchor" aria-label="anchor" href="#derive-definitive-deterioration-flag"></a></h3>


<p>In this example a definitive deterioration flag should be derived as
any deterioration (<code>CHGCAT1 = "Worsened"</code>) by parameter that is not
followed by a non-deterioration. Please note that <code>join_type = "after"</code>
can't by used here, as otherwise the last record wouldn't be flagged.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">adqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">PARAMCD</span>, <span class="op">~</span><span class="va">ADY</span>, <span class="op">~</span><span class="va">CHGCAT1</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"QS1"</span>,      <span class="fl">10</span>, <span class="st">"Improved"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"QS1"</span>,      <span class="fl">21</span>, <span class="st">"Improved"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"QS1"</span>,      <span class="fl">23</span>, <span class="st">"Improved"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"QS2"</span>,      <span class="fl">32</span>, <span class="st">"Worsened"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"QS2"</span>,      <span class="fl">42</span>, <span class="st">"Improved"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"QS1"</span>,      <span class="fl">11</span>, <span class="st">"Worsened"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"QS1"</span>,      <span class="fl">24</span>, <span class="st">"Worsened"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">adqs</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">adqs</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">DDETERFL</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">CHGCAT1</span>, <span class="va">ADY</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">CHGCAT1.join</span> <span class="op">==</span> <span class="st">"Worsened"</span> <span class="op">|</span> <span class="va">ADY</span> <span class="op">&gt;</span> <span class="va">ADY.join</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 Ã— 5</span></span>
<span><span class="co">#&gt;   USUBJID PARAMCD   ADY CHGCAT1  DDETERFL</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 1       QS1        10 Improved &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2 1       QS1        21 Improved &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3 1       QS1        23 Improved &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4 1       QS2        32 Worsened &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5 1       QS2        42 Improved &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6 2       QS1        11 Worsened Y</span></span>
<span><span class="co">#&gt; 7 2       QS1        24 Worsened Y       </span></span></code></pre><p></p></div>
</div>
<div class="section">
<h3 id="handling-duplicates-check-type-">Handling duplicates (<code>check_type</code>)<a class="anchor" aria-label="anchor" href="#handling-duplicates-check-type-"></a></h3>


<p>If the <code>order</code> argument is used, it is checked if the records are
unique with respect to <code>by_vars</code> and <code>order</code>. Consider for example the
derivation of <code>CONFFL</code> which flags records with <code>AVALC == "Y"</code> which are
confirmed at a subsequent visit.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">AVISITN</span>, <span class="op">~</span><span class="va">ADY</span>, <span class="op">~</span><span class="va">AVALC</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">1</span>,           <span class="fl">1</span>, <span class="st">"Y"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">2</span>,           <span class="fl">8</span>, <span class="st">"N"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">3</span>,          <span class="fl">15</span>, <span class="st">"Y"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="fl">4</span>,          <span class="fl">22</span>, <span class="st">"N"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">1</span>,           <span class="fl">1</span>, <span class="st">"Y"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">2</span>,           <span class="fl">8</span>, <span class="st">"Y"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="fl">2</span>,          <span class="fl">10</span>, <span class="st">"Y"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">data</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">CONFFL</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVALC</span>, <span class="va">AVISITN</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">AVALC</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"Y"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 Ã— 5</span></span>
<span><span class="co">#&gt;   USUBJID AVISITN   ADY AVALC CONFFL</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 1             1     1 Y     Y</span></span>
<span><span class="co">#&gt; 2 1             2     8 N     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3 1             3    15 Y     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4 1             4    22 N     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5 2             1     1 Y     Y</span></span>
<span><span class="co">#&gt; 6 2             2     8 Y     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7 2             2    10 Y     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; Warning: Dataset `dataset` contains duplicate records with respect to `USUBJID` and</span></span>
<span><span class="co">#&gt; `AVISITN`</span></span>
<span><span class="co">#&gt; i Run `admiral::get_duplicates_dataset()` to access the duplicate records</span></span>
<span><span class="co">#&gt; Warning: Dataset `dataset_add` contains duplicate records with respect to `USUBJID` and</span></span>
<span><span class="co">#&gt; `AVISITN`</span></span>
<span><span class="co">#&gt; i Run `admiral::get_duplicates_dataset()` to access the duplicate records</span></span></code></pre><p></p></div>
<p>The records for <code>USUBJID == "2"</code> are not unique with respect to
<code>USUBJID</code> and <code>AVISITN</code>. Thus a warning is issued. The duplicates can be
accessed by calling <code><a href="get_duplicates_dataset.html">get_duplicates_dataset()</a></code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/get_duplicates_dataset.html">get_duplicates_dataset</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Duplicate records with respect to `USUBJID` and `AVISITN`.</span></span>
<span><span class="co">#&gt; # A tibble: 2 Ã— 4</span></span>
<span><span class="co">#&gt;   USUBJID AVISITN   ADY AVALC</span></span>
<span><span class="co">#&gt; * &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 2             2     8 Y</span></span>
<span><span class="co">#&gt; 2 2             2    10 Y    </span></span></code></pre><p></p></div>
<p>In this example, confirmation is required at a subsequent <em>visit</em>.
Please note that the first record for subject <code>"2"</code> at visit <code>2</code> is not
flagged. Thus the warning can be suppressed by specifying <code>check_type = "none"</code>.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">data</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">CONFFL</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVALC</span>, <span class="va">AVISITN</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">AVALC</span> <span class="op">==</span> <span class="st">"Y"</span> <span class="op">&amp;</span> <span class="va">AVALC.join</span> <span class="op">==</span> <span class="st">"Y"</span>,</span>
<span>  check_type <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 Ã— 5</span></span>
<span><span class="co">#&gt;   USUBJID AVISITN   ADY AVALC CONFFL</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 1             1     1 Y     Y</span></span>
<span><span class="co">#&gt; 2 1             2     8 N     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3 1             3    15 Y     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4 1             4    22 N     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5 2             1     1 Y     Y</span></span>
<span><span class="co">#&gt; 6 2             2     8 Y     &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7 2             2    10 Y     &lt;NA&gt;  </span></span></code></pre><p></p></div>
</div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by F. Hoffmann-La Roche AG, GlaxoSmithKline LLC, Ben Straub, Stefan Bundfuss, Arianna Cascone, Jeffrey Dickinson, Ross Farrugia, Fanny Gautier, G Gayatri, Solveig Holmgaard, Dinakar Kulkarni, Edoardo Mancini, Gordon Miller, Lina Patil, Jim Rothstein, Daniel Sjoberg, Stefan Thoma, Junze Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

