<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generic Derivations ‚Ä¢ admiral</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generic Derivations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">admiral</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started">
<li><a class="dropdown-item" href="../articles/admiral.html">Get Started</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/pharmaverse/admiral/blob/main/inst/cheatsheet/admiral_cheatsheet.pdf">Cheatsheet</a></li>
    <li><a class="dropdown-item" href="https://pharmaverse.github.io/admiraldiscovery/articles/presentation_archive.html">Presentation Archive</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides">
<li><h6 class="dropdown-header" data-toc-skip>General Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/concepts_conventions.html">Programming Concepts and Conventions</a></li>
    <li><a class="dropdown-item" href="../articles/generic.html">Generic Derivations</a></li>
    <li><a class="dropdown-item" href="../articles/higher_order.html">Higher Order Functions</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>ADaM Script Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/adsl.html">Creating a Basic ADSL</a></li>
    <li><a class="dropdown-item" href="../articles/occds.html">Creating an OCCDS ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_finding.html">Creating a BDS Findings ADAM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_exposure.html">Creating a BDS Exposure ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_tte.html">Creating a BDS Time-to-Event ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/questionnaires.html">Creating Questionnaire ADaMs</a></li>
    <li><a class="dropdown-item" href="../articles/pk_adnca.html">Creating a PK NCA or Population PK ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/hys_law.html">Hy's Law Implementation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Special Topics Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/imputation.html">Date and Time Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/visits_periods.html">Visit and Period Variables</a></li>
    <li><a class="dropdown-item" href="../articles/queries_dataset.html">Queries Dataset Documentation</a></li>
    <li><a class="dropdown-item" href="../articles/lab_grading.html">Lab Grading</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="https://pharmaverse.github.io/admiraldiscovery/articles/reactable.html">üîé Find my function</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      <div><li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.3.1-fix">v1.3.1-fix</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/cran-release">cran-release</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.3.1">v1.3.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.3.0">v1.3.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.2.0">v1.2.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.1.1">v1.1.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.1.0">v1.1.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.0.2">v1.0.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.0.1">v1.0.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.0.0">v1.0.0</a>
</div>
</li></div>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://pharmaverse.slack.com/" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/website-versions.html" aria-label="Previous Release Websites"><span class="fa fa-history"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/issues/new/choose" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="generic_files/core-js-2.5.3/shim.min.js"></script><script src="generic_files/react-18.2.0/react.min.js"></script><script src="generic_files/react-18.2.0/react-dom.min.js"></script><script src="generic_files/reactwidget-2.0.0/react-tools.js"></script><link href="generic_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="generic_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="generic_files/reactable-0.4.4/reactable.css" rel="stylesheet">
<script src="generic_files/reactable-binding-0.4.4/reactable.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Generic Derivations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiral/blob/main/vignettes/generic.Rmd" class="external-link"><code>vignettes/generic.Rmd</code></a></small>
      <div class="d-none name"><code>generic.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette provides an overview of the most important admiral
functions, the generic derivations. They do not derive a specific
variable or parameter in a specific dataset but can be used for many
different derivations in many different datasets. The most important
concepts and some examples are presented here. For full details and more
examples see the documentation of the functions.</p>
<div class="section level3">
<h3 id="required-packages">Required Packages<a class="anchor" aria-label="anchor" href="#required-packages"></a>
</h3>
<p>The examples in this vignette require the following packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pharmaverse.github.io/admiral/">admiral</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="characterization-of-derivations">Characterization of Derivations<a class="anchor" aria-label="anchor" href="#characterization-of-derivations"></a>
</h2>
<p>The generic functions can be characterized by the following three
properties:</p>
<ul>
<li>What should be added? There are two options:
<ul>
<li><em>Variables</em></li>
<li><em>Records/Parameters</em></li>
</ul>
</li>
<li>What is the source data? There are two options:
<ul>
<li>A <em>single</em> source dataset</li>
<li>
<em>Multiple</em> source datasets</li>
</ul>
</li>
<li>Which method should be used? There are three options:
<ul>
<li>
<em>Selection</em>: The new values are derived by selecting records,
e.g., the baseline records, the last exposure record, ‚Ä¶</li>
<li>
<em>Summary</em>: The new values are derived by summarizing values,
e.g., sum, average, concatenation, ‚Ä¶</li>
<li>
<em>Computation</em>: The new values are derived by a computation
with more than one value as input, e.g., deriving BMI or BSA from height
and weight</li>
</ul>
</li>
</ul>
<div class="section level3">
<h3 id="overview-of-derivations">Overview of Derivations<a class="anchor" aria-label="anchor" href="#overview-of-derivations"></a>
</h3>
<p>Using the three properties makes it easy to find the appropriate
function for a particular derivation. The following interactive table
lists all generic functions and their properties.</p>
<div class="reactable html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Derivation":["derive_var_extreme_flag()","derive_var_joined_exist_flag()","derive_var_merged_ef_msrc()","derive_var_merged_exist_flag()","derive_vars_merged_summary()","derive_vars_joined()","derive_vars_merged()","derive_vars_extreme_event()","derive_vars_computed()","derive_extreme_event()","derive_extreme_records()","derive_param_computed()","derive_param_exist_flag()","derive_summary_records()"],"What":["variables","variables","variables","variables","variables","variables","variables","variables","variables","records","records","records","records","records"],"Source":["single","single","multiple","single","single","single","single","multiple","single","multiple","single","single","single","single"],"Method":["selection","selection","selection","selection","summary","selection","selection","selection","computation","selection","selection","computation","selection","summary"]},"columns":[{"id":"Derivation","name":"Derivation","type":"character","cell":[{"name":"a","attribs":{"href":"../reference/derive_var_extreme_flag.html"},"children":["derive_var_extreme_flag()"]},{"name":"a","attribs":{"href":"../reference/derive_var_joined_exist_flag.html"},"children":["derive_var_joined_exist_flag()"]},{"name":"a","attribs":{"href":"../reference/derive_var_merged_ef_msrc.html"},"children":["derive_var_merged_ef_msrc()"]},{"name":"a","attribs":{"href":"../reference/derive_var_merged_exist_flag.html"},"children":["derive_var_merged_exist_flag()"]},{"name":"a","attribs":{"href":"../reference/derive_vars_merged_summary.html"},"children":["derive_vars_merged_summary()"]},{"name":"a","attribs":{"href":"../reference/derive_vars_joined.html"},"children":["derive_vars_joined()"]},{"name":"a","attribs":{"href":"../reference/derive_vars_merged.html"},"children":["derive_vars_merged()"]},{"name":"a","attribs":{"href":"../reference/derive_vars_extreme_event.html"},"children":["derive_vars_extreme_event()"]},{"name":"a","attribs":{"href":"../reference/derive_vars_computed.html"},"children":["derive_vars_computed()"]},{"name":"a","attribs":{"href":"../reference/derive_extreme_event.html"},"children":["derive_extreme_event()"]},{"name":"a","attribs":{"href":"../reference/derive_extreme_records.html"},"children":["derive_extreme_records()"]},{"name":"a","attribs":{"href":"../reference/derive_param_computed.html"},"children":["derive_param_computed()"]},{"name":"a","attribs":{"href":"../reference/derive_param_exist_flag.html"},"children":["derive_param_exist_flag()"]},{"name":"a","attribs":{"href":"../reference/derive_summary_records.html"},"children":["derive_summary_records()"]}],"minWidth":200},{"id":"What","name":"What","type":"character"},{"id":"Source","name":"Source","type":"character"},{"id":"Method","name":"Method","type":"character"}],"resizable":true,"filterable":true,"defaultSorted":[{"id":"What","desc":true},{"id":"Source","desc":true},{"id":"Method","desc":false}],"defaultPageSize":20,"dataKey":"8383f76a9765c2c406378b916117fb99"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="section level2">
<h2 id="source-data">Source Data<a class="anchor" aria-label="anchor" href="#source-data"></a>
</h2>
<p>Most derivation functions expect a single source dataset. For some
multiple source datasets can be specified. In both cases the way how to
specify the source datasets is the same across all generic
functions.</p>
<div class="section level3">
<h3 id="single-source-dataset">Single Source Dataset<a class="anchor" aria-label="anchor" href="#single-source-dataset"></a>
</h3>
<p>For functions expecting a single source dataset the data is provided
by the <code>dataset_add</code> argument. This is a mandatory argument.
The data provided by the <code>dataset</code> argument is not used<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;code&gt;&lt;a href="../reference/derive_param_computed.html"&gt;derive_param_computed()&lt;/a&gt;&lt;/code&gt; is an exception. It
uses the data from both arguments.&lt;/p&gt;'><sup>1</sup></a>.</p>
<p>If the <code>dataset_add</code> argument is not provided, the data
from <code>dataset</code> is used
(<code><a href="../reference/derive_var_extreme_flag.html">derive_var_extreme_flag()</a></code>).</p>
</div>
<div class="section level3">
<h3 id="multiple-source-datasets">Multiple Source Datasets<a class="anchor" aria-label="anchor" href="#multiple-source-datasets"></a>
</h3>
<p>For functions expecting multiple source datasets the data is provided
by the <code>source_datasets</code> argument. The datasets are referred
to by the <code>dataset_name</code> element of the source objects.</p>
<p>For example, consider the derivation of a response parameter. The
three possible responses are defined by <code><a href="../reference/event.html">event()</a></code> objects.
These objects define the events but do not include any data. Instead the
<code>dataset_name</code> field is set to a (character) id. This id is
used in the <code>source_datasets</code> argument of the derivation
function to link the data to the events. I.e., for the first two events
(<code>complete_response</code> and <code>partial_response</code>) the
dataset <code>adrs_ovr</code> is used while for the last event the
dataset <code>myadsl</code> is used.</p>
<pre><code>complete_response &lt;- event(
  description = "Define complete response",
  dataset_name = "ovr",
  condition = AVALC == "CR",
  set_values_to = exprs(AVALC = "COMPLETE RESPONSE")
)

partial_response &lt;- event(
  description = "Define partial response",
  dataset_name = "ovr",
  condition = AVALC == "PR",
  set_values_to = exprs(AVALC = "PARTIAL RESPONSE")
)

no_response &lt;- event(
  description = "Define no response for all patients in adsl",
  dataset_name = "adsl",
  condition = TRUE,
  set_values_to = exprs(AVALC = "NO RESPONSE")
)

derive_extreme_event(
  ...
  events = list(complete_response, partial_response, no_response),
  source_datasets = list(ovr = adrs_ovr, adsl = myadsl),
  ...
)</code></pre>
<p>This allows to define the source objects independent of the data.
I.e., the same source object can be used for different source datasets.
For example, the parameter above could be derived for data from a second
reporter by just changing <code>source_dataset</code>:</p>
<pre><code>derive_extreme_event(
  ...
  events = list(complete_response, partial_response, no_response),
  source_datasets = list(ovr = adrs_ovr_reporter2, adsl = myadsl),
  ...
)</code></pre>
<p>For some source objects the <code>dataset_name</code> element is
optional, e.g., <code><a href="../reference/event.html">event()</a></code>. If it is not specified, the input
dataset (<code>dataset</code>) is used.</p>
</div>
</div>
<div class="section level2">
<h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<p>The generic derivations use three different methods for deriving the
values of the new variables or records. Usually the derivation applies
the method several times, once for each group in the input or source
data. The groups are defined by the <code>by_vars</code> argument, e.g.,
<code>by_vars = exprs(USUBJID)</code> for ‚Äúeach subject‚Äù or
<code>by_vars = exprs(USUBJID, PARAMCD)</code> for ‚Äúeach subject and
parameter‚Äù.</p>
<div class="section level3">
<h3 id="selection">Selection<a class="anchor" aria-label="anchor" href="#selection"></a>
</h3>
<p>The most common method is the selection method. It selects a record
from the source dataset(s) and adds information from the selected record
to the input dataset. This information could be just a flag indicating
that a record exists, one or more variables from the selected records,
or new variables created from the selected record.</p>
<div class="section level4">
<h4 id="options-for-selection">Options for Selection<a class="anchor" aria-label="anchor" href="#options-for-selection"></a>
</h4>
<p>In the simplest case the record is selected by a condition. The
condition is specified by the <code>filter_add</code> or
<code>filter</code> argument. In the following example baseline weight
is added to <code>ADSL</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>,</span>
<span>  <span class="st">"1"</span>,</span>
<span>  <span class="st">"2"</span>,</span>
<span>  <span class="st">"3"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">PARAMCD</span>, <span class="op">~</span><span class="va">AVISIT</span>,    <span class="op">~</span><span class="va">ABLFL</span>, <span class="op">~</span><span class="va">AVAL</span>, <span class="op">~</span><span class="va">AVALU</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"WEIGHT"</span>, <span class="st">"BASELINE"</span>, <span class="st">"Y"</span>,     <span class="fl">58.7</span>, <span class="st">"kg"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"HEIGHT"</span>, <span class="st">"BASELINE"</span>, <span class="st">"Y"</span>,    <span class="fl">169.2</span>, <span class="st">"cm"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"WEIGHT"</span>, <span class="st">"WEEK 3"</span>,   <span class="cn">NA</span>,      <span class="fl">59.3</span>, <span class="st">"kg"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"WEIGHT"</span>, <span class="st">"BASELINE"</span>, <span class="st">"Y"</span>,     <span class="fl">72.5</span>, <span class="st">"kg"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"WEIGHT"</span>, <span class="st">"WEKK 3"</span>,   <span class="cn">NA</span>,      <span class="fl">71.9</span>, <span class="st">"kg"</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_vars_merged.html">derive_vars_merged</a></span><span class="op">(</span></span>
<span>  <span class="va">adsl</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">advs</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  filter_add <span class="op">=</span> <span class="va">PARAMCD</span> <span class="op">==</span> <span class="st">"WEIGHT"</span> <span class="op">&amp;</span> <span class="va">ABLFL</span> <span class="op">==</span> <span class="st">"Y"</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>WGTBL <span class="op">=</span> <span class="va">AVAL</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 √ó 2</span></span></span>
<span><span class="co">#&gt;   USUBJID WGTBL</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1        58.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2        72.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3        <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>Sometimes it is not possible to select the record of interest by a
condition, e.g., if the first, last, best, worst, lowest, highest, ‚Ä¶
value should be derived. In this case the <code>mode</code> and
<code>order</code> argument can be specified to select the first or last
record with respect to the variables specified for <code>order</code>.
Below the day of the last valid dose is added to <code>ADSL</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>,</span>
<span>  <span class="st">"1"</span>,</span>
<span>  <span class="st">"2"</span>,</span>
<span>  <span class="st">"3"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">EXSTDY</span>, <span class="op">~</span><span class="va">EXDOSE</span>,</span>
<span>  <span class="st">"1"</span>,            <span class="fl">1</span>,      <span class="fl">50</span>,</span>
<span>  <span class="st">"1"</span>,            <span class="fl">7</span>,      <span class="fl">70</span>,</span>
<span>  <span class="st">"1"</span>,           <span class="fl">14</span>,       <span class="fl">0</span>,</span>
<span>  <span class="st">"2"</span>,            <span class="fl">1</span>,      <span class="fl">75</span>,</span>
<span>  <span class="st">"2"</span>,            <span class="fl">9</span>,      <span class="fl">70</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_vars_merged.html">derive_vars_merged</a></span><span class="op">(</span></span>
<span>  <span class="va">adsl</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">ex</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  filter_add <span class="op">=</span> <span class="va">EXDOSE</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">EXSTDY</span><span class="op">)</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>TRTEDY <span class="op">=</span> <span class="va">EXSTDY</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 √ó 2</span></span></span>
<span><span class="co">#&gt;   USUBJID TRTEDY</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1            7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2            9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3           <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>It is also possible to select the record based on records of the
input <em>and</em> the source dataset. For this type of selection
<a href="https://pharmaverse.github.io/admiral/">admiral</a> provides the functions
<code><a href="../reference/derive_vars_joined.html">derive_vars_joined()</a></code>,
<code><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag()</a></code>, and
<code><a href="../reference/derive_extreme_event.html">derive_extreme_event()</a></code>. They provide the
<code>filter_join</code> argument which accepts conditions with
variables from both the input dataset (<code>dataset</code>) and the
additional dataset (<code>dataset_add</code>). As an example consider
deriving the day and dose of the last study treatment before an adverse
event:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ASTDY</span>, <span class="op">~</span><span class="va">AESEQ</span>,</span>
<span>  <span class="st">"1"</span>,           <span class="fl">3</span>,      <span class="fl">1</span>,</span>
<span>  <span class="st">"1"</span>,           <span class="fl">3</span>,      <span class="fl">2</span>,</span>
<span>  <span class="st">"1"</span>,          <span class="fl">15</span>,      <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">EXSTDY</span>, <span class="op">~</span><span class="va">EXDOSE</span>,</span>
<span>  <span class="st">"1"</span>,            <span class="fl">1</span>,      <span class="fl">50</span>,</span>
<span>  <span class="st">"1"</span>,            <span class="fl">7</span>,      <span class="fl">70</span>,</span>
<span>  <span class="st">"1"</span>,           <span class="fl">14</span>,       <span class="fl">0</span>,</span>
<span>  <span class="st">"2"</span>,            <span class="fl">1</span>,      <span class="fl">75</span>,</span>
<span>  <span class="st">"2"</span>,            <span class="fl">9</span>,      <span class="fl">70</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_vars_joined.html">derive_vars_joined</a></span><span class="op">(</span></span>
<span>  <span class="va">adae</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">ex</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  filter_add <span class="op">=</span> <span class="va">EXDOSE</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">EXSTDY</span> <span class="op">&lt;=</span> <span class="va">ASTDY</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">EXSTDY</span><span class="op">)</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>LSTDOSDY <span class="op">=</span> <span class="va">EXSTDY</span>, LASTDOS <span class="op">=</span> <span class="va">EXDOSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 √ó 5</span></span></span>
<span><span class="co">#&gt;   USUBJID ASTDY AESEQ LSTDOSDY LASTDOS</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1           3     1        1      50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1           3     2        1      50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1          15     3        7      70</span></span></code></pre></div>
<p>The <code>filter_join</code> condition is applied on a temporary
dataset created by left joining the input dataset and the additional
dataset (restricted by <code>filter_add</code>):</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 √ó 5</span></span></span>
<span><span class="co">#&gt;   USUBJID ASTDY AESEQ EXSTDY EXDOSE</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1           3     1      1     50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1           3     1      7     70</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1           3     2      1     50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1           3     2      7     70</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1          15     3      1     50</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1          15     3      7     70</span></span></code></pre>
<p>The ‚Äújoined‚Äù function can also be used when the condition for
selecting depends on previous or subsequent records in the dataset. In
this case the same dataset is specified for <code>dataset</code> and
<code>dataest_add</code>. Consider the following example where
<code>"HIGH"</code> results should be flagged which are confirmed by a
second <code>"HIGH"</code> result at least ten days later.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adlb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">PARAMCD</span>, <span class="op">~</span><span class="va">ADY</span>, <span class="op">~</span><span class="va">ANRIND</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"AST"</span>,       <span class="fl">1</span>, <span class="st">"HIGH"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"AST"</span>,       <span class="fl">7</span>, <span class="st">"HIGH"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"AST"</span>,      <span class="fl">14</span>, <span class="st">"NORMAL"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"ALT"</span>,       <span class="fl">1</span>, <span class="st">"HIGH"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"ALT"</span>,       <span class="fl">7</span>, <span class="st">"NORMAL"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"ALT"</span>,      <span class="fl">14</span>, <span class="st">"HIGH"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"AST"</span>,       <span class="fl">1</span>, <span class="st">"HIGH"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"AST"</span>,      <span class="fl">15</span>, <span class="st">"HIGH"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"AST"</span>,      <span class="fl">22</span>, <span class="st">"NORMAL"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"ALT"</span>,       <span class="fl">1</span>, <span class="st">"HIGH"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">adlb</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">adlb</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADY</span><span class="op">)</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADY</span>, <span class="va">ANRIND</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">ANRIND</span> <span class="op">==</span> <span class="st">"HIGH"</span> <span class="op">&amp;</span> <span class="va">ANRIND.join</span> <span class="op">==</span> <span class="st">"HIGH"</span> <span class="op">&amp;</span> <span class="va">ADY.join</span> <span class="op">&gt;</span> <span class="va">ADY</span> <span class="op">+</span> <span class="fl">10</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">HICONFFL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 √ó 5</span></span></span>
<span><span class="co">#&gt;    USUBJID PARAMCD   ADY ANRIND HICONFFL</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1       AST         1 HIGH   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1       AST         7 HIGH   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1       AST        14 NORMAL <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1       ALT         1 HIGH   Y       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1       ALT         7 NORMAL <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1       ALT        14 HIGH   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2       AST         1 HIGH   Y       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2       AST        15 HIGH   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2       AST        22 NORMAL <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2       ALT         1 HIGH   <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>The <code>join_type</code> argument is set to <code>"after"</code> to
restrict the joined records to subsequent results.</p>
<p>As the same variables are included in <code>dataset</code> and
<code>dataset_add</code>, those from <code>dataset_add</code> are
renamed by adding the suffix ‚Äú.join‚Äù. The variables from
<code>dataset_add</code> which are used in <code>filter_join</code> must
be specified for <code>join_vars</code>. So the temporary dataset for
applying <code>filter_join</code> is:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 √ó 6</span></span></span>
<span><span class="co">#&gt;   USUBJID PARAMCD   ADY ANRIND ADY.join ANRIND.join</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1       ALT         1 HIGH          7 NORMAL     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1       ALT         1 HIGH         14 HIGH       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1       ALT         7 NORMAL       14 HIGH       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1       AST         1 HIGH          7 HIGH       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1       AST         1 HIGH         14 NORMAL     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1       AST         7 HIGH         14 NORMAL     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 2       AST         1 HIGH         15 HIGH       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> 2       AST         1 HIGH         22 NORMAL     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> 2       AST        15 HIGH         22 NORMAL</span></span></code></pre>
<p>It is possible to use summary functions like <code><a href="https://rdrr.io/r/base/all.html" class="external-link">all()</a></code> or
<code><a href="https://rdrr.io/r/base/any.html" class="external-link">any()</a></code> in <code>filter_join</code>. Assume that in the
previous example records should be flagged only if all results between
the flagged record and the confirmation record were <code>"HIGH"</code>.
This can be achieved by specifying the <code>first_cond_upper</code>
argument and set it to the condition for confirmation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">adlb</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">adlb</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADY</span><span class="op">)</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">ADY</span>, <span class="va">ANRIND</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"after"</span>,</span>
<span>  first_cond_upper <span class="op">=</span> <span class="va">ANRIND.join</span> <span class="op">==</span> <span class="st">"HIGH"</span> <span class="op">&amp;</span> <span class="va">ADY.join</span> <span class="op">&gt;</span> <span class="va">ADY</span> <span class="op">+</span> <span class="fl">10</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">ANRIND</span> <span class="op">==</span> <span class="st">"HIGH"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">ANRIND.join</span> <span class="op">==</span> <span class="st">"HIGH"</span><span class="op">)</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">HICONFFL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 √ó 5</span></span></span>
<span><span class="co">#&gt;    USUBJID PARAMCD   ADY ANRIND HICONFFL</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1       AST         1 HIGH   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1       AST         7 HIGH   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1       AST        14 NORMAL <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1       ALT         1 HIGH   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1       ALT         7 NORMAL <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1       ALT        14 HIGH   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2       AST         1 HIGH   Y       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2       AST        15 HIGH   <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2       AST        22 NORMAL <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2       ALT         1 HIGH   <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>If the <code>first_cond_upper</code> argument is specified the
records in the joined dataset are restricted up to the first records
where the condition is fulfilled:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 √ó 6</span></span></span>
<span><span class="co">#&gt;   USUBJID PARAMCD   ADY ANRIND ADY.join ANRIND.join</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1       ALT         1 HIGH          7 NORMAL     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1       ALT         1 HIGH         14 HIGH       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2       AST         1 HIGH         15 HIGH</span></span></code></pre>
<p>Thereafter <code>filter_join</code> is applied to the restricted
joined dataset. I.e., the <code><a href="https://rdrr.io/r/base/all.html" class="external-link">all()</a></code> function considers only the
results up to the confirmation records and ignores subsequent
results.</p>
<p><strong>Note:</strong> In principle, we actually could achieve every
result from <code><a href="../reference/derive_vars_merged.html">derive_vars_merged()</a></code> and
<code><a href="../reference/derive_var_merged_exist_flag.html">derive_var_merged_exist_flag()</a></code> by using
<code><a href="../reference/derive_vars_joined.html">derive_vars_joined()</a></code> or
<code><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag()</a></code> respectively. However, the
‚Äújoined‚Äù functions require much more resources (time and memory), hence
it is recommended to use them only if it is really required, i.e., the
condition for selecting records depends on variables from <em>both</em>
datasets.</p>
</div>
<div class="section level4">
<h4 id="sort_order">Sort Order<a class="anchor" aria-label="anchor" href="#sort_order"></a>
</h4>
<p>The <a href="https://pharmaverse.github.io/admiral/">admiral</a> functions use
<code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">dplyr::arrange()</a></code> for sorting, i.e., <code>NA</code>s are
always sorted to the end (regardless whether <code><a href="../reference/reexport-desc.html">desc()</a></code> is used
or not).</p>
<p>Consider for example the following derivation of a last visit flag.
The record with <code>AVISITN == NA</code> is flagged because
<code>NA</code> is sorted to the end.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">PARAMCD</span>, <span class="op">~</span><span class="va">AVISITN</span>, <span class="op">~</span><span class="va">AVAL</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"WEIGHT"</span>,       <span class="cn">NA</span>,  <span class="fl">62.1</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"WEIGHT"</span>,        <span class="fl">1</span>,  <span class="fl">62.3</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"WEIGHT"</span>,        <span class="fl">2</span>,  <span class="fl">62.5</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"WEIGHT"</span>,        <span class="fl">3</span>,  <span class="fl">62.4</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_extreme_flag.html">derive_var_extreme_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">advs</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">LSTVISFL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 √ó 5</span></span></span>
<span><span class="co">#&gt;   USUBJID PARAMCD AVISITN  AVAL LSTVISFL</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1       WEIGHT        1  62.3 <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1       WEIGHT        2  62.5 <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1       WEIGHT        3  62.4 <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1       WEIGHT       <span style="color: #BB0000;">NA</span>  62.1 Y</span></span></code></pre></div>
<p>The <code>order</code> argument accepts expressions. This allows to
specify how <code>NA</code>s should be handled. For example, the
following sorts the <code>NA</code> to the start. Thus the
<code>AVISITN == 3</code> record is flagged.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/derive_var_extreme_flag.html">derive_var_extreme_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">advs</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>, <span class="op">-</span><span class="cn">Inf</span>, <span class="va">AVISITN</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">LSTVISFL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 √ó 5</span></span></span>
<span><span class="co">#&gt;   USUBJID PARAMCD AVISITN  AVAL LSTVISFL</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1       WEIGHT       <span style="color: #BB0000;">NA</span>  62.1 <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1       WEIGHT        1  62.3 <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1       WEIGHT        2  62.5 <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1       WEIGHT        3  62.4 Y</span></span></code></pre></div>
<p>The same can achieved with the following, which also works for
character variables.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/derive_var_extreme_flag.html">derive_var_extreme_flag</a></span><span class="op">(</span></span>
<span>  <span class="va">advs</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">PARAMCD</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">AVISITN</span><span class="op">)</span>, <span class="va">AVISITN</span><span class="op">)</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"last"</span>,</span>
<span>  new_var <span class="op">=</span> <span class="va">LSTVISFL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 √ó 5</span></span></span>
<span><span class="co">#&gt;   USUBJID PARAMCD AVISITN  AVAL LSTVISFL</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1       WEIGHT       <span style="color: #BB0000;">NA</span>  62.1 <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1       WEIGHT        1  62.3 <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1       WEIGHT        2  62.5 <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1       WEIGHT        3  62.4 Y</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="new-values">New Values<a class="anchor" aria-label="anchor" href="#new-values"></a>
</h4>
<p>How the (new) variables are set depends on whether variables, a flag,
or records are added by the derivation.</p>
<ul>
<li>If only a flag needs to be added, the flag functions
(<code><a href="../reference/derive_var_merged_exist_flag.html">derive_var_merged_exist_flag()</a></code>,
<code><a href="../reference/derive_var_joined_exist_flag.html">derive_var_joined_exist_flag()</a></code>) can be used. The name of
the new variable is specified by the <code>new_var</code> argument and
the values of the flag by <code>true_value</code> and
<code>false_value</code>.</li>
<li>If new variables from the selected record needs to be added, the
name of the new variables and their values are specified by the
<code>new_vars</code> argument. If in addition a flag should be added,
the <code>exist_flag</code> argument and the <code>true_value</code> and
<code>false_value</code> argument can be used.</li>
<li>If new records are added, the variables and their values are defined
by the <code>set_values_to</code> argument.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>If the new values should be derived by summarizing values, e.g., sum,
average, concatenation, ‚Ä¶, the functions
<code><a href="../reference/derive_summary_records.html">derive_summary_records()</a></code> or
<code><a href="../reference/derive_var_merged_summary.html">derive_var_merged_summary()</a></code> can be used. For example,
adding an average dose parameter to <code>ADEX</code> can be done by the
following:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ASTDY</span>, <span class="op">~</span><span class="va">AVAL</span>, <span class="op">~</span><span class="va">PARAMCD</span>,</span>
<span>  <span class="st">"1"</span>,           <span class="fl">1</span>,    <span class="fl">50</span>, <span class="st">"DOSE"</span>,</span>
<span>  <span class="st">"1"</span>,           <span class="fl">7</span>,    <span class="fl">70</span>, <span class="st">"DOSE"</span>,</span>
<span>  <span class="st">"1"</span>,          <span class="fl">14</span>,     <span class="fl">0</span>, <span class="st">"DOSE"</span>,</span>
<span>  <span class="st">"2"</span>,           <span class="fl">1</span>,    <span class="fl">75</span>, <span class="st">"DOSE"</span>,</span>
<span>  <span class="st">"2"</span>,           <span class="fl">9</span>,    <span class="fl">70</span>, <span class="st">"DOSE"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_summary_records.html">derive_summary_records</a></span><span class="op">(</span></span>
<span>  <span class="va">adex</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">adex</span>,</span>
<span>  filter_add <span class="op">=</span> <span class="va">AVAL</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  set_values_to <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span></span>
<span>    AVAL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">AVAL</span><span class="op">)</span>,</span>
<span>    PARAMCD <span class="op">=</span> <span class="st">"AVERAGE DOSE"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 √ó 4</span></span></span>
<span><span class="co">#&gt;   USUBJID ASTDY  AVAL PARAMCD     </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1           1  50   DOSE        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1           7  70   DOSE        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1          14   0   DOSE        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2           1  75   DOSE        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2           9  70   DOSE        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1          <span style="color: #BB0000;">NA</span>  60   AVERAGE DOSE</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 2          <span style="color: #BB0000;">NA</span>  72.5 AVERAGE DOSE</span></span></code></pre></div>
<p>The summary function, the source variable, and the new variable can
be specified by the <code>set_values_to</code> argument. Variables which
are not specified by <code>set_values_to</code> or <code>by_vars</code>
are set to <code>NA</code> for the new records.</p>
<p>If the average dose should be added as a variable to
<code>ADSL</code>, consider the following:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>,</span>
<span>  <span class="st">"1"</span>,</span>
<span>  <span class="st">"2"</span>,</span>
<span>  <span class="st">"3"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_var_merged_summary.html">derive_var_merged_summary</a></span><span class="op">(</span></span>
<span>  <span class="va">adsl</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">adex</span>,</span>
<span>  filter_add <span class="op">=</span> <span class="va">AVAL</span> <span class="op">&gt;</span> <span class="fl">0</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span></span>
<span>    AVERDOSE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">AVAL</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  missing_values <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>AVERDOSE <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 √ó 2</span></span></span>
<span><span class="co">#&gt;   USUBJID AVERDOSE</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1           60  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2           72.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3            0</span></span></code></pre></div>
<p>Here the summary function, the source variable, and the new variable
are specified by the <code>new_vars</code> argument. For subjects
without exposure observations the value of the new variable can be
defined by the <code>missing_values</code> argument.</p>
</div>
<div class="section level3">
<h3 id="computed">Computed<a class="anchor" aria-label="anchor" href="#computed"></a>
</h3>
<p>If the new values should be computed from different parameters of the
source dataset, <code><a href="../reference/derive_param_computed.html">derive_param_computed()</a></code> can be used. The
computed value can be specified by the <code>set_values_to</code>
argument. The values of the source variable for a parameter can be
referred to by temporary variables of the form
<code>&lt;variable name&gt;.&lt;parameter name&gt;</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">AVISIT</span>,    <span class="op">~</span><span class="va">PARAMCD</span>, <span class="op">~</span><span class="va">AVAL</span>, <span class="op">~</span><span class="va">AVALU</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"BASELINE"</span>, <span class="st">"WEIGHT"</span>,  <span class="fl">32.6</span>, <span class="st">"kg"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"BASELINE"</span>, <span class="st">"HEIGHT"</span>, <span class="fl">155.4</span>, <span class="st">"cm"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"MONTH 6"</span>,  <span class="st">"WEIGHT"</span>,  <span class="fl">33.2</span>, <span class="st">"kg"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"MONTH 6"</span>,  <span class="st">"HEIGHT"</span>, <span class="fl">155.8</span>, <span class="st">"cm"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"BASELINE"</span>, <span class="st">"WEIGHT"</span>,  <span class="fl">44.2</span>, <span class="st">"kg"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"BASELINE"</span>, <span class="st">"HEIGHT"</span>, <span class="fl">145.3</span>, <span class="st">"cm"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"MONTH 6"</span>,  <span class="st">"WEIGHT"</span>,  <span class="fl">42.0</span>, <span class="st">"kg"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"MONTH 6"</span>,  <span class="st">"HEIGHT"</span>, <span class="fl">146.4</span>, <span class="st">"cm"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_param_computed.html">derive_param_computed</a></span><span class="op">(</span></span>
<span>  <span class="va">advs</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">AVISIT</span><span class="op">)</span>,</span>
<span>  parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WEIGHT"</span>, <span class="st">"HEIGHT"</span><span class="op">)</span>,</span>
<span>  set_values_to <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span></span>
<span>    AVAL <span class="op">=</span> <span class="va">AVAL.WEIGHT</span> <span class="op">/</span> <span class="op">(</span><span class="va">AVAL.HEIGHT</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>    PARAMCD <span class="op">=</span> <span class="st">"BMI"</span>,</span>
<span>    AVALU <span class="op">=</span> <span class="st">"kg/m^2"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 √ó 5</span></span></span>
<span><span class="co">#&gt;    USUBJID AVISIT   PARAMCD  AVAL AVALU </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1       BASELINE WEIGHT   32.6 kg    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1       BASELINE HEIGHT  155.  cm    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1       MONTH 6  WEIGHT   33.2 kg    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1       MONTH 6  HEIGHT  156.  cm    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2       BASELINE WEIGHT   44.2 kg    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2       BASELINE HEIGHT  145.  cm    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2       MONTH 6  WEIGHT   42   kg    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2       MONTH 6  HEIGHT  146.  cm    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1       BASELINE BMI      13.5 kg/m^2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1       MONTH 6  BMI      13.7 kg/m^2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 2       BASELINE BMI      20.9 kg/m^2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 2       MONTH 6  BMI      19.6 kg/m^2</span></span></code></pre></div>
<p>For common computations like BMI <a href="https://pharmaverse.github.io/admiral/">admiral</a> offers <a href="../reference/#computation-functions-for-vectors">computation
functions</a>. In the previous example <code><a href="../reference/compute_bmi.html">compute_bmi()</a></code> could
be used instead of the formula for BMI:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/derive_param_computed.html">derive_param_computed</a></span><span class="op">(</span></span>
<span>  <span class="va">advs</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">USUBJID</span>, <span class="va">AVISIT</span><span class="op">)</span>,</span>
<span>  parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WEIGHT"</span>, <span class="st">"HEIGHT"</span><span class="op">)</span>,</span>
<span>  set_values_to <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span></span>
<span>    AVAL <span class="op">=</span> <span class="fu"><a href="../reference/compute_bmi.html">compute_bmi</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="va">AVAL.WEIGHT</span>, height <span class="op">=</span> <span class="va">AVAL.HEIGHT</span><span class="op">)</span>,</span>
<span>    PARAMCD <span class="op">=</span> <span class="st">"BMI"</span>,</span>
<span>    AVALU <span class="op">=</span> <span class="st">"kg/m^2"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 √ó 5</span></span></span>
<span><span class="co">#&gt;    USUBJID AVISIT   PARAMCD  AVAL AVALU </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1       BASELINE WEIGHT   32.6 kg    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1       BASELINE HEIGHT  155.  cm    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1       MONTH 6  WEIGHT   33.2 kg    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1       MONTH 6  HEIGHT  156.  cm    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2       BASELINE WEIGHT   44.2 kg    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2       BASELINE HEIGHT  145.  cm    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2       MONTH 6  WEIGHT   42   kg    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2       MONTH 6  HEIGHT  146.  cm    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1       BASELINE BMI      13.5 kg/m^2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1       MONTH 6  BMI      13.7 kg/m^2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 2       BASELINE BMI      20.9 kg/m^2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 2       MONTH 6  BMI      19.6 kg/m^2</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Straub, Stefan Bundfuss, Jeffrey Dickinson, Ross Farrugia, Fanny Gautier, Dinakar Kulkarni, Edoardo Mancini, Sadchla Mascary, Gordon Miller, Jim Rothstein, Sophie Shapcott, Eric Simms, Daniel Sjoberg, Stefan Thoma, Phillip Webster, Zelos Zhu, F. Hoffmann-La Roche AG, GlaxoSmithKline LLC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
