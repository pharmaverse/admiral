<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Visit and Period Variables • admiral</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Visit and Period Variables">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">admiral</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started">
<li><a class="dropdown-item" href="../articles/admiral.html">Simple ADSL Walkthrough</a></li>
    <li><a class="dropdown-item" href="https://pharmaverse.github.io/admiraldiscovery/articles/reactable.html">CDISC Variables mapped to admiral functions</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/pharmaverse/admiral/blob/main/inst/cheatsheet/admiral_cheatsheet.pdf">Cheatsheet</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides">
<li><a class="dropdown-item" href="../articles/adsl.html">Creating a Basic ADSL</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Deep Dives on ADaMs</h6></li>
    <li><a class="dropdown-item" href="../articles/occds.html">Creating an OCCDS ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_finding.html">Creating a BDS Findings ADAM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_exposure.html">Creating a BDS Exposure ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/bds_tte.html">Creating a BDS Time-to-Event ADaM</a></li>
    <li><a class="dropdown-item" href="../articles/questionnaires.html">Creating Questionnaire ADaMs</a></li>
    <li><a class="dropdown-item" href="../articles/pk_adnca.html">Creating a PK NCA or Population PK ADaM</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced User Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/imputation.html">Date and Time Imputation</a></li>
    <li><a class="dropdown-item" href="../articles/visits_periods.html">Visit and Period Variables</a></li>
    <li><a class="dropdown-item" href="../articles/generic.html">Generic Derivations</a></li>
    <li><a class="dropdown-item" href="../articles/higher_order.html">Higher Order Functions</a></li>
    <li><a class="dropdown-item" href="../articles/queries_dataset.html">Queries Dataset Documentation</a></li>
    <li><a class="dropdown-item" href="../articles/lab_grading.html">Lab Grading</a></li>
    <li><a class="dropdown-item" href="../articles/hys_law.html">Hy's Law Implementation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      <div><li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/cran-release">cran-release</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.3.1">v1.3.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.3.0">v1.3.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.2.0">v1.2.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.1.1">v1.1.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.1.0">v1.1.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.0.2">v1.0.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.0.1">v1.0.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://pharmaverse.github.io/admiral/v1.0.0">v1.0.0</a>
</div>
</li></div>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://app.slack.com/client/T028PB489D3/C02M8KN8269" aria-label="Slack"><span class="fa fa-slack"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/website-versions.html" aria-label="Previous Release Websites"><span class="fa fa-history"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/issues/new/choose" aria-label="New Issue"><span class="fa fa-bug"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaverse/admiral/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Visit and Period Variables</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/admiral/blob/main/vignettes/visits_periods.Rmd" class="external-link"><code>vignettes/visits_periods.Rmd</code></a></small>
      <div class="d-none name"><code>visits_periods.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The derivation of visit variables like <code>AVISIT</code>,
<code>AVISITN</code>, <code>AWLO</code>, <code>AWHI</code>, … or period,
subperiod, or phase variables like <code>APERIOD</code>,
<code>TRT01A</code>, <code>TRT02A</code>, <code>ASPER</code>,
<code>PHSDTM</code>, <code>PHEDTM</code>, … is highly study-specific.
Therefore admiral cannot provide functions which derive these variables.
However, for common scenarios like visit assignments based on time
windows or deriving BDS period variables from ADSL period variables,
functions are provided which support those derivations.</p>
<div class="section level3">
<h3 id="required-packages">Required Packages<a class="anchor" aria-label="anchor" href="#required-packages"></a>
</h3>
<p>The examples of this vignette require the following packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pharmaverse.github.io/admiral/">admiral</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="visits">Visit variables (<code>AVISIT</code>, <code>AVISITN</code>,
<code>AWLO</code>, <code>AWHI</code>, …)<a class="anchor" aria-label="anchor" href="#visits"></a>
</h2>
<p>The most common ways of deriving <code>AVISIT</code> and
<code>AVISITN</code> are:</p>
<ul>
<li>The variables are set to the collected visits (<code>VISIT</code>
and <code>VISITNUM</code>).</li>
<li>The variables are set based on time windows.</li>
</ul>
<p>The former can be achieved simply by calling <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>,
like in the vignettes and the template scripts.</p>
<p>For the latter a (study-specific) reference dataset needs to be
created which provides for each visit the start and end day
(<code>AWLO</code> and <code>AWHI</code>) and the values of other visit
related variables (<code>AVISIT</code>, <code>AVISITN</code>,
<code>AWTARGET</code>, …).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">windows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">AVISIT</span>,    <span class="op">~</span><span class="va">AWLO</span>, <span class="op">~</span><span class="va">AWHI</span>, <span class="op">~</span><span class="va">AVISITN</span>, <span class="op">~</span><span class="va">AWTARGET</span>,</span>
<span>  <span class="st">"BASELINE"</span>,   <span class="op">-</span><span class="fl">30</span>,     <span class="fl">1</span>,        <span class="fl">0</span>,         <span class="fl">1</span>,</span>
<span>  <span class="st">"WEEK 1"</span>,       <span class="fl">2</span>,     <span class="fl">7</span>,        <span class="fl">1</span>,         <span class="fl">5</span>,</span>
<span>  <span class="st">"WEEK 2"</span>,       <span class="fl">8</span>,    <span class="fl">15</span>,        <span class="fl">2</span>,        <span class="fl">11</span>,</span>
<span>  <span class="st">"WEEK 3"</span>,      <span class="fl">16</span>,    <span class="fl">22</span>,        <span class="fl">3</span>,        <span class="fl">19</span>,</span>
<span>  <span class="st">"WEEK 4"</span>,      <span class="fl">23</span>,    <span class="fl">30</span>,        <span class="fl">4</span>,        <span class="fl">26</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then the visits can be assigned based on the analysis day
(<code>ADY</code>) by calling <code><a href="../reference/derive_vars_joined.html">derive_vars_joined()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adbds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ADY</span>,</span>
<span>  <span class="st">"1"</span>,       <span class="op">-</span><span class="fl">33</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="op">-</span><span class="fl">2</span>,</span>
<span>  <span class="st">"1"</span>,         <span class="fl">3</span>,</span>
<span>  <span class="st">"1"</span>,        <span class="fl">24</span>,</span>
<span>  <span class="st">"2"</span>,        <span class="cn">NA</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_vars_joined.html">derive_vars_joined</a></span><span class="op">(</span></span>
<span>  <span class="va">adbds</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">windows</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">AWLO</span> <span class="op">&lt;=</span> <span class="va">ADY</span> <span class="op">&amp;</span> <span class="va">ADY</span> <span class="op">&lt;=</span> <span class="va">AWHI</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 7</span></span></span>
<span><span class="co">#&gt;   USUBJID   ADY AVISIT    AWLO  AWHI AVISITN AWTARGET</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1         -<span style="color: #BB0000;">33</span> <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1          -<span style="color: #BB0000;">2</span> BASELINE   -<span style="color: #BB0000;">30</span>     1       0        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1           3 WEEK 1       2     7       1        5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1          24 WEEK 4      23    30       4       26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2          <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="period-subperiod-and-phase-variables">Period, Subperiod, and Phase Variables<a class="anchor" aria-label="anchor" href="#period-subperiod-and-phase-variables"></a>
</h2>
<p>If periods, subperiods, or phases are used, the corresponding
variables have to be consistent across all datasets. This can be
achieved by defining the periods, subperiods, or phases once and then
use this definition for all datasets. The definition can be stored in
ADSL or in a separate dataset. In the following examples, this separate
dataset is called period reference dataset.</p>
<div class="section level3">
<h3 id="reference">Period Reference Dataset<a class="anchor" aria-label="anchor" href="#reference"></a>
</h3>
<p>The period reference dataset contains one observation per subject and
period, subperiod, or phase. For example:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">#&gt;   STUDYID USUBJID APHASEN PHSDT      PHEDT      APHASE   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> xyz     1             1 2021-01-04 2021-02-06 TREATMENT</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> xyz     1             2 2021-02-07 2021-03-07 FUP      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> xyz     2             1 2021-02-02 2021-03-02 TREATMENT</span></span></code></pre>
<p>The admiral functions expect separate datasets for periods,
subperiods, and phases. For periods the numeric variable
<code>APERIOD</code> is expected, for subperiods the numeric variables
<code>APERIOD</code> and <code>ASPER</code>, and for phases the numeric
variable <code>APHASEN</code>.</p>
</div>
<div class="section level3">
<h3 id="periods_adsl">Creating ADSL Period, Subperiod, or Phase Variables<a class="anchor" aria-label="anchor" href="#periods_adsl"></a>
</h3>
<p>If a period reference dataset is available, the ADSL variables for
periods, subperiods, or phases can be created from this dataset by
calling <code><a href="../reference/derive_vars_period.html">derive_vars_period()</a></code>.</p>
<p>For example the period reference dataset from the previous section
can be used to add the phase variables (<code>PHwSDT</code>,
<code>PHwEDT</code>, and <code>APHASEw</code>) to ADSL:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>STUDYID <span class="op">=</span> <span class="st">"xyz"</span>, USUBJID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/derive_vars_period.html">derive_vars_period</a></span><span class="op">(</span></span>
<span>  <span class="va">adsl</span>,</span>
<span>  dataset_ref <span class="op">=</span> <span class="va">phase_ref</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>PHwSDT <span class="op">=</span> <span class="va">PHSDT</span>, PHwEDT <span class="op">=</span> <span class="va">PHEDT</span>, APHASEw <span class="op">=</span> <span class="va">APHASE</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span>, <span class="va">PH1SDT</span>, <span class="va">PH1EDT</span>, <span class="va">PH2SDT</span>, <span class="va">PH2EDT</span>, <span class="va">APHASE1</span>, <span class="va">APHASE2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adsl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 8</span></span></span>
<span><span class="co">#&gt;   STUDYID USUBJID PH1SDT     PH1EDT     PH2SDT     PH2EDT     APHASE1   APHASE2</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> xyz     1       2021-01-04 2021-02-06 2021-02-07 2021-03-07 TREATMENT FUP    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> xyz     2       2021-02-02 2021-03-02 <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         TREATMENT <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="periods_bds">Creating BDS and OCCDS Period, Subperiod, or Phase Variables<a class="anchor" aria-label="anchor" href="#periods_bds"></a>
</h3>
<p>If a period reference dataset is available, BDS and OCCDS variables
for periods, subperiods, or phases can be created by calling
<code><a href="../reference/derive_vars_joined.html">derive_vars_joined()</a></code>.</p>
<p>For example the variables <code>APHASEN</code>, <code>PHSDT</code>,
<code>PHEDT</code>, <code>APHASE</code> can be derived from the period
reference dataset defined above.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ASTDT</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"2021-01-01"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"2021-01-05"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"2021-02-05"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"2021-03-05"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"2021-04-05"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"2021-02-15"</span>,</span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    STUDYID <span class="op">=</span> <span class="st">"xyz"</span>,</span>
<span>    .before <span class="op">=</span> <span class="va">USUBJID</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ASTDT <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="va">ASTDT</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_vars_joined.html">derive_vars_joined</a></span><span class="op">(</span></span>
<span>  <span class="va">adae</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">phase_ref</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">PHSDT</span> <span class="op">&lt;=</span> <span class="va">ASTDT</span> <span class="op">&amp;</span> <span class="va">ASTDT</span> <span class="op">&lt;=</span> <span class="va">PHEDT</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;   STUDYID USUBJID ASTDT      APHASEN PHSDT      PHEDT      APHASE   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> xyz     1       2021-01-01      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> xyz     1       2021-01-05       1 2021-01-04 2021-02-06 TREATMENT</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> xyz     1       2021-02-05       1 2021-01-04 2021-02-06 TREATMENT</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> xyz     1       2021-03-05       2 2021-02-07 2021-03-07 FUP      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> xyz     1       2021-04-05      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> xyz     2       2021-02-15       1 2021-02-02 2021-03-02 TREATMENT</span></span></code></pre></div>
<p>If no period reference dataset is available but period variables are
in ADSL, the period reference dataset can be created from ADSL by
calling <code><a href="../reference/create_period_dataset.html">create_period_dataset()</a></code>.</p>
<p>For <span id="adsl_example">example</span>, a period reference
dataset for phases can be created from the ADSL dataset created
above:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_period_dataset.html">create_period_dataset</a></span><span class="op">(</span></span>
<span>  <span class="va">adsl</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>PHSDT <span class="op">=</span> <span class="va">PHwSDT</span>, PHEDT <span class="op">=</span> <span class="va">PHwEDT</span>, APHASE <span class="op">=</span> <span class="va">APHASEw</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">#&gt;   STUDYID USUBJID APHASEN PHSDT      PHEDT      APHASE   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> xyz     1             1 2021-01-04 2021-02-06 TREATMENT</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> xyz     1             2 2021-02-07 2021-03-07 FUP      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> xyz     2             1 2021-02-02 2021-03-02 TREATMENT</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="treatment-variables-trtxxp-trtxxa-trtp-trta">Treatment Variables (<code>TRTxxP</code>, <code>TRTxxA</code>,
<code>TRTP</code>, <code>TRTA</code>, …)<a class="anchor" aria-label="anchor" href="#treatment-variables-trtxxp-trtxxa-trtp-trta"></a>
</h2>
<p>In studies with multiple periods the treatment can differ by period,
e.g. for a crossover trial. CDISC defines variables for planned and
actual treatments in ADSL (<code>TRTxxP</code>, <code>TRTxxA</code>,
<code>TRxxPGy</code>, <code>TRxxAGy</code>, …) and corresponding
variables in BDS and OCCDS datasets (<code>TRTP</code>,
<code>TRTA</code>, <code>TRTPGy</code>, <code>TRTAGy</code>, …). They
can be derived in the same way (and same step) as the period, subperiod,
and phase variables.</p>
<div class="section level3">
<h3 id="treatment_adsl">Creating ADSL Treatment Variables<a class="anchor" aria-label="anchor" href="#treatment_adsl"></a>
</h3>
<p>If the treatment information is included in the period reference
dataset, the treatment ADSL variables can be created by calling
<code><a href="../reference/derive_vars_period.html">derive_vars_period()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add period variables to ADSL</span></span>
<span><span class="va">period_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">APERIOD</span>, <span class="op">~</span><span class="va">APERSDT</span>,     <span class="op">~</span><span class="va">APEREDT</span>,     <span class="op">~</span><span class="va">TRTA</span>,</span>
<span>  <span class="st">"1"</span>,             <span class="fl">1</span>, <span class="st">"2021-01-04"</span>, <span class="st">"2021-02-06"</span>, <span class="st">"DRUG A"</span>,</span>
<span>  <span class="st">"1"</span>,             <span class="fl">2</span>, <span class="st">"2021-02-07"</span>, <span class="st">"2021-03-07"</span>, <span class="st">"DRUG B"</span>,</span>
<span>  <span class="st">"2"</span>,             <span class="fl">1</span>, <span class="st">"2021-02-02"</span>, <span class="st">"2021-03-02"</span>, <span class="st">"DRUG B"</span>,</span>
<span>  <span class="st">"2"</span>,             <span class="fl">2</span>, <span class="st">"2021-03-03"</span>, <span class="st">"2021-04-01"</span>, <span class="st">"DRUG B"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    STUDYID <span class="op">=</span> <span class="st">"xyz"</span>,</span>
<span>    APERIOD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">APERIOD</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"DT"</span><span class="op">)</span>, <span class="va">ymd</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/derive_vars_period.html">derive_vars_period</a></span><span class="op">(</span></span>
<span>  <span class="va">adsl</span>,</span>
<span>  dataset_ref <span class="op">=</span> <span class="va">period_ref</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span></span>
<span>    APxxSDT <span class="op">=</span> <span class="va">APERSDT</span>,</span>
<span>    APxxEDT <span class="op">=</span> <span class="va">APEREDT</span>,</span>
<span>    TRTxxA <span class="op">=</span> <span class="va">TRTA</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">STUDYID</span>, <span class="va">USUBJID</span>,</span>
<span>    <span class="va">TRT01A</span>, <span class="va">TRT02A</span>,</span>
<span>    <span class="va">AP01SDT</span>, <span class="va">AP01EDT</span>, <span class="va">AP02SDT</span>, <span class="va">AP02EDT</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">adsl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 8</span></span></span>
<span><span class="co">#&gt;   STUDYID USUBJID TRT01A TRT02A AP01SDT    AP01EDT    AP02SDT    AP02EDT   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> xyz     1       DRUG A DRUG B 2021-01-04 2021-02-06 2021-02-07 2021-03-07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> xyz     2       DRUG B DRUG B 2021-02-02 2021-03-02 2021-03-03 2021-04-01</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="treatment_bds">Creating BDS and OCCDS Treatment Variables<a class="anchor" aria-label="anchor" href="#treatment_bds"></a>
</h3>
<p>If a period reference dataset is available, BDS and OCCDS variables
for treatment can be created by calling
<code><a href="../reference/derive_vars_joined.html">derive_vars_joined()</a></code>.</p>
<p>For example the variables <code>APERIOD</code> and <code>TRTA</code>
can be derived from the period reference dataset defined above.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">USUBJID</span>, <span class="op">~</span><span class="va">ASTDT</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"2021-01-05"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"2021-02-05"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"2021-03-05"</span>,</span>
<span>  <span class="st">"1"</span>,      <span class="st">"2021-04-05"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"2021-02-15"</span>,</span>
<span>  <span class="st">"2"</span>,      <span class="st">"2021-03-10"</span>,</span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ASTDT <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="va">ASTDT</span><span class="op">)</span>,</span>
<span>    STUDYID <span class="op">=</span> <span class="st">"xyz"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/derive_vars_joined.html">derive_vars_joined</a></span><span class="op">(</span></span>
<span>  <span class="va">adae</span>,</span>
<span>  dataset_add <span class="op">=</span> <span class="va">period_ref</span>,</span>
<span>  by_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">STUDYID</span>, <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">APERIOD</span>, <span class="va">TRTA</span><span class="op">)</span>,</span>
<span>  join_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span><span class="va">APERSDT</span>, <span class="va">APEREDT</span><span class="op">)</span>,</span>
<span>  join_type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  filter_join <span class="op">=</span> <span class="va">APERSDT</span> <span class="op">&lt;=</span> <span class="va">ASTDT</span> <span class="op">&amp;</span> <span class="va">ASTDT</span> <span class="op">&lt;=</span> <span class="va">APEREDT</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   USUBJID ASTDT      STUDYID APERIOD TRTA  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1       2021-01-05 xyz           1 DRUG A</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1       2021-02-05 xyz           1 DRUG A</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1       2021-03-05 xyz           2 DRUG B</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1       2021-04-05 xyz          <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2       2021-02-15 xyz           1 DRUG B</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2       2021-03-10 xyz           2 DRUG B</span></span></code></pre></div>
<p>If no period reference dataset is available but period variables are
in ADSL, the period reference dataset can be created from ADSL by
calling <code><a href="../reference/create_period_dataset.html">create_period_dataset()</a></code>.</p>
<p>For example, a period reference dataset for periods and treatments
can be created from the ADSL dataset created above:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_period_dataset.html">create_period_dataset</a></span><span class="op">(</span></span>
<span>  <span class="va">adsl</span>,</span>
<span>  new_vars <span class="op">=</span> <span class="fu"><a href="../reference/reexport-exprs.html">exprs</a></span><span class="op">(</span>APERSDT <span class="op">=</span> <span class="va">APxxSDT</span>, APEREDT <span class="op">=</span> <span class="va">APxxEDT</span>, TRTA <span class="op">=</span> <span class="va">TRTxxA</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">#&gt;   STUDYID USUBJID APERIOD APERSDT    APEREDT    TRTA  </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> xyz     1             1 2021-01-04 2021-02-06 DRUG A</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> xyz     1             2 2021-02-07 2021-03-07 DRUG B</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> xyz     2             1 2021-02-02 2021-03-02 DRUG B</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> xyz     2             2 2021-03-03 2021-04-01 DRUG B</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="study-specific-code">Study Specific Code<a class="anchor" aria-label="anchor" href="#study-specific-code"></a>
</h2>
<p>At some point study specific code is required to derive
period/subperiod variables. There are two options:</p>
<ul>
<li><p>Study specific code is used to derive the variables
<code>PxxSwSDT</code> and <code>PxxSwEDT</code> in ADSL. Then
<code><a href="../reference/create_period_dataset.html">create_period_dataset()</a></code> and
<code><a href="../reference/derive_vars_joined.html">derive_vars_joined()</a></code> can be used to derive period/subperiod
variables like <code>ASPER</code> or <code>ASPRSDT</code> in BDS and
OCCDS datasets. (See <a href="#adsl_example">example</a>.)</p></li>
<li><p>Study specific code is used to derive a dataset with one
observations per patient, period, and subperiod (see <a href="#reference">period reference dataset</a> ). Then
<code><a href="../reference/derive_vars_period.html">derive_vars_period()</a></code> can be used to derive
<code>PxxSwSDT</code> and <code>PxxSwEDT</code> in ADSL and
<code><a href="../reference/derive_vars_joined.html">derive_vars_joined()</a></code> can be used to derive period/subperiod
variables like <code>ASPER</code> or <code>ASPRSDT</code> in BDS and
OCCDS datasets.</p></li>
</ul>
<p>It depends on the specific definition of the periods/subperiods which
option works best. If the definition is based on other ADSL variables,
the first option would work best. If the definition is based on
vertically structured data like exposure data (EX dataset), the second
option should be used.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Straub, Stefan Bundfuss, Jeffrey Dickinson, Ross Farrugia, Adam Forys, G Gayatri, Daphne Grasselly, Dinakar Kulkarni, Edoardo Mancini, Sadchla Mascary, Gordon Miller, Sophie Shapcott, Eric Simms, Daniel Sjoberg, Stefan Thoma, Kangjie Zhang, Zelos Zhu, Thomas Neitmann, F. Hoffmann-La Roche AG, GlaxoSmithKline LLC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
